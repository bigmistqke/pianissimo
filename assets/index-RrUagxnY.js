(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();const bo=(t,e)=>t===e,jt=Symbol("solid-proxy"),rr=Symbol("solid-track"),sr={equals:bo};let vo=ko;const et=1,ir=2,xo={owned:null,cleanups:null,context:null,owner:null},Br={};var de=null;let jr=null,Du=null,pe=null,Oe=null,at=null,xr=0;function Et(t,e){const n=pe,r=de,s=t.length===0,i=e===void 0?r:e,o=s?xo:{owned:null,cleanups:null,context:i?i.context:null,owner:i},a=s?t:()=>t(()=>je(()=>bn(o)));de=o,pe=null;try{return bt(a,!0)}finally{pe=n,de=r}}function be(t,e){e=e?Object.assign({},sr,e):sr;const n={value:t,observers:null,observerSlots:null,comparator:e.equals||void 0},r=s=>(typeof s=="function"&&(s=s(n.value)),Eo(n,s));return[So.bind(n),r]}function $u(t,e,n){const r=In(t,e,!0,et);Nt(r)}function le(t,e,n){const r=In(t,e,!1,et);Nt(r)}function Gt(t,e,n){vo=Wu;const r=In(t,e,!1,et);r.user=!0,at?at.push(r):Nt(r)}function Xe(t,e,n){n=n?Object.assign({},sr,n):sr;const r=In(t,e,!0,0);return r.observers=null,r.observerSlots=null,r.comparator=n.equals||void 0,Nt(r),So.bind(r)}function Bu(t){return t&&typeof t=="object"&&"then"in t}function ju(t,e,n){let r,s,i;arguments.length===2&&typeof e=="object"||arguments.length===1?(r=!0,s=t,i=e):(r=t,s=e,i={});let o=null,a=Br,c=!1,u="initialValue"in i,f=typeof r=="function"&&Xe(r);const l=new Set,[d,h]=(i.storage||be)(i.initialValue),[g,w]=be(void 0),[x,v]=be(void 0,{equals:!1}),[M,k]=be(u?"ready":"unresolved");function F(U,H,V,I){return o===U&&(o=null,I!==void 0&&(u=!0),(U===a||H===a)&&i.onHydrated&&queueMicrotask(()=>i.onHydrated(I,{value:H})),a=Br,A(H,V)),H}function A(U,H){bt(()=>{H===void 0&&h(()=>U),k(H!==void 0?"errored":u?"ready":"unresolved"),w(H);for(const V of l.keys())V.decrement();l.clear()},!1)}function q(){const U=qu,H=d(),V=g();if(V!==void 0&&!o)throw V;return pe&&pe.user,H}function Y(U=!0){if(U!==!1&&c)return;c=!1;const H=f?f():r;if(H==null||H===!1){F(o,je(d));return}const V=a!==Br?a:je(()=>s(H,{value:d(),refetching:U}));return Bu(V)?(o=V,"value"in V?(V.status==="success"?F(o,V.value,void 0,H):F(o,void 0,ds(V.value),H),V):(c=!0,queueMicrotask(()=>c=!1),bt(()=>{k(u?"refreshing":"pending"),v()},!1),V.then(I=>F(V,I,void 0,H),I=>F(V,void 0,ds(I),H)))):(F(o,V,void 0,H),V)}return Object.defineProperties(q,{state:{get:()=>M()},error:{get:()=>g()},loading:{get(){const U=M();return U==="pending"||U==="refreshing"}},latest:{get(){if(!u)return q();const U=g();if(U&&!o)throw U;return d()}}}),f?$u(()=>Y(!1)):Y(!1),[q,{refetch:Y,mutate:h}]}function Lr(t,e=bo,n){const r=new Map,s=In(i=>{const o=t();for(const[a,c]of r.entries())if(e(a,o)!==e(a,i))for(const u of c.values())u.state=et,u.pure?Oe.push(u):at.push(u);return o},void 0,!0,et);return Nt(s),i=>{const o=pe;if(o){let a;(a=r.get(i))?a.add(o):r.set(i,a=new Set([o])),Qt(()=>{a.delete(o),!a.size&&r.delete(i)})}return e(i,s.value)}}function zs(t){return bt(t,!1)}function je(t){if(pe===null)return t();const e=pe;pe=null;try{return t()}finally{pe=e}}function us(t,e,n){const r=Array.isArray(t);let s;return i=>{let o;if(r){o=Array(t.length);for(let c=0;c<t.length;c++)o[c]=t[c]()}else o=t();const a=je(()=>e(o,s,i));return s=o,a}}function ls(t){Gt(()=>je(t))}function Qt(t){return de===null||(de.cleanups===null?de.cleanups=[t]:de.cleanups.push(t)),t}function fs(){return pe}function Lu(){return de}function Uu(t,e){const n=de,r=pe;de=t,pe=null;try{return bt(e,!0)}catch(s){Ws(s)}finally{de=n,pe=r}}function Nu(t,e){const n=Symbol("context");return{id:n,Provider:Gu(n),defaultValue:t}}function Hu(t){let e;return de&&de.context&&(e=de.context[t.id])!==void 0?e:t.defaultValue}function Fu(t){const e=Xe(t),n=Xe(()=>hs(e()));return n.toArray=()=>{const r=n();return Array.isArray(r)?r:r!=null?[r]:[]},n}let qu;function So(){if(this.sources&&this.state)if(this.state===et)Nt(this);else{const t=Oe;Oe=null,bt(()=>ar(this),!1),Oe=t}if(pe){const t=this.observers?this.observers.length:0;pe.sources?(pe.sources.push(this),pe.sourceSlots.push(t)):(pe.sources=[this],pe.sourceSlots=[t]),this.observers?(this.observers.push(pe),this.observerSlots.push(pe.sources.length-1)):(this.observers=[pe],this.observerSlots=[pe.sources.length-1])}return this.value}function Eo(t,e,n){let r=t.value;return(!t.comparator||!t.comparator(r,e))&&(t.value=e,t.observers&&t.observers.length&&bt(()=>{for(let s=0;s<t.observers.length;s+=1){const i=t.observers[s],o=jr&&jr.running;o&&jr.disposed.has(i),(o?!i.tState:!i.state)&&(i.pure?Oe.push(i):at.push(i),i.observers&&Ao(i)),o||(i.state=et)}if(Oe.length>1e6)throw Oe=[],new Error},!1)),e}function Nt(t){if(!t.fn)return;bn(t);const e=xr;Vu(t,t.value,e)}function Vu(t,e,n){let r;const s=de,i=pe;pe=de=t;try{r=t.fn(e)}catch(o){return t.pure&&(t.state=et,t.owned&&t.owned.forEach(bn),t.owned=null),t.updatedAt=n+1,Ws(o)}finally{pe=i,de=s}(!t.updatedAt||t.updatedAt<=n)&&(t.updatedAt!=null&&"observers"in t?Eo(t,r):t.value=r,t.updatedAt=n)}function In(t,e,n,r=et,s){const i={fn:t,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:de,context:de?de.context:null,pure:n};return de===null||de!==xo&&(de.owned?de.owned.push(i):de.owned=[i]),i}function or(t){if(t.state===0)return;if(t.state===ir)return ar(t);if(t.suspense&&je(t.suspense.inFallback))return t.suspense.effects.push(t);const e=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<xr);)t.state&&e.push(t);for(let n=e.length-1;n>=0;n--)if(t=e[n],t.state===et)Nt(t);else if(t.state===ir){const r=Oe;Oe=null,bt(()=>ar(t,e[0]),!1),Oe=r}}function bt(t,e){if(Oe)return t();let n=!1;e||(Oe=[]),at?n=!0:at=[],xr++;try{const r=t();return zu(n),r}catch(r){n||(at=null),Oe=null,Ws(r)}}function zu(t){if(Oe&&(ko(Oe),Oe=null),t)return;const e=at;at=null,e.length&&bt(()=>vo(e),!1)}function ko(t){for(let e=0;e<t.length;e++)or(t[e])}function Wu(t){let e,n=0;for(e=0;e<t.length;e++){const r=t[e];r.user?t[n++]=r:or(r)}for(e=0;e<n;e++)or(t[e])}function ar(t,e){t.state=0;for(let n=0;n<t.sources.length;n+=1){const r=t.sources[n];if(r.sources){const s=r.state;s===et?r!==e&&(!r.updatedAt||r.updatedAt<xr)&&or(r):s===ir&&ar(r,e)}}}function Ao(t){for(let e=0;e<t.observers.length;e+=1){const n=t.observers[e];n.state||(n.state=ir,n.pure?Oe.push(n):at.push(n),n.observers&&Ao(n))}}function bn(t){let e;if(t.sources)for(;t.sources.length;){const n=t.sources.pop(),r=t.sourceSlots.pop(),s=n.observers;if(s&&s.length){const i=s.pop(),o=n.observerSlots.pop();r<s.length&&(i.sourceSlots[o]=r,s[r]=i,n.observerSlots[r]=o)}}if(t.tOwned){for(e=t.tOwned.length-1;e>=0;e--)bn(t.tOwned[e]);delete t.tOwned}if(t.owned){for(e=t.owned.length-1;e>=0;e--)bn(t.owned[e]);t.owned=null}if(t.cleanups){for(e=t.cleanups.length-1;e>=0;e--)t.cleanups[e]();t.cleanups=null}t.state=0}function ds(t){return t instanceof Error?t:new Error(typeof t=="string"?t:"Unknown error",{cause:t})}function Ws(t,e=de){throw ds(t)}function hs(t){if(typeof t=="function"&&!t.length)return hs(t());if(Array.isArray(t)){const e=[];for(let n=0;n<t.length;n++){const r=hs(t[n]);Array.isArray(r)?e.push.apply(e,r):e.push(r)}return e}return t}function Gu(t,e){return function(r){let s;return le(()=>s=je(()=>(de.context={...de.context,[t]:r.value},Fu(()=>r.children))),void 0),s}}const gs=Symbol("fallback");function cr(t){for(let e=0;e<t.length;e++)t[e]()}function Co(t,e,n={}){let r=[],s=[],i=[],o=0,a=e.length>1?[]:null;return Qt(()=>cr(i)),()=>{let c=t()||[],u=c.length,f,l;return c[rr],je(()=>{let h,g,w,x,v,M,k,F,A;if(u===0)o!==0&&(cr(i),i=[],r=[],s=[],o=0,a&&(a=[])),n.fallback&&(r=[gs],s[0]=Et(q=>(i[0]=q,n.fallback())),o=1);else if(o===0){for(s=new Array(u),l=0;l<u;l++)r[l]=c[l],s[l]=Et(d);o=u}else{for(w=new Array(u),x=new Array(u),a&&(v=new Array(u)),M=0,k=Math.min(o,u);M<k&&r[M]===c[M];M++);for(k=o-1,F=u-1;k>=M&&F>=M&&r[k]===c[F];k--,F--)w[F]=s[k],x[F]=i[k],a&&(v[F]=a[k]);for(h=new Map,g=new Array(F+1),l=F;l>=M;l--)A=c[l],f=h.get(A),g[l]=f===void 0?-1:f,h.set(A,l);for(f=M;f<=k;f++)A=r[f],l=h.get(A),l!==void 0&&l!==-1?(w[l]=s[f],x[l]=i[f],a&&(v[l]=a[f]),l=g[l],h.set(A,l)):i[f]();for(l=M;l<u;l++)l in w?(s[l]=w[l],i[l]=x[l],a&&(a[l]=v[l],a[l](l))):s[l]=Et(d);s=s.slice(0,o=u),r=c.slice(0)}return s});function d(h){if(i[l]=h,a){const[g,w]=be(l);return a[l]=w,e(c[l],g)}return e(c[l])}}}function Ku(t,e,n={}){let r=[],s=[],i=[],o=[],a=0,c;return Qt(()=>cr(i)),()=>{const u=t()||[],f=u.length;return u[rr],je(()=>{if(f===0)return a!==0&&(cr(i),i=[],r=[],s=[],a=0,o=[]),n.fallback&&(r=[gs],s[0]=Et(d=>(i[0]=d,n.fallback())),a=1),s;for(r[0]===gs&&(i[0](),i=[],r=[],s=[],a=0),c=0;c<f;c++)c<r.length&&r[c]!==u[c]?o[c](()=>u[c]):c>=r.length&&(s[c]=Et(l));for(;c<r.length;c++)i[c]();return a=o.length=i.length=f,r=u.slice(0),s=s.slice(0,a)});function l(d){i[c]=d;const[h,g]=be(u[c]);return o[c]=g,e(h,c)}}}function X(t,e){return je(()=>t(e||{}))}const Xu=t=>`Stale read from <${t}>.`;function Ju(t){const e="fallback"in t&&{fallback:()=>t.fallback};return Xe(Co(()=>t.each,t.children,e||void 0))}function Lt(t){const e="fallback"in t&&{fallback:()=>t.fallback};return Xe(Ku(()=>t.each,t.children,e||void 0))}function St(t){const e=t.keyed,n=Xe(()=>t.when,void 0,{equals:(r,s)=>e?r===s:!r==!s});return Xe(()=>{const r=n();if(r){const s=t.children;return typeof s=="function"&&s.length>0?je(()=>s(e?r:()=>{if(!je(n))throw Xu("Show");return t.when})):s}return t.fallback},void 0,void 0)}const Yu=new Set(["innerHTML","textContent","innerText","children"]),Zu=Object.assign(Object.create(null),{className:"class",htmlFor:"for"}),Qu=new Set(["beforeinput","click","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"]),el={xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"};function tl(t,e,n){let r=n.length,s=e.length,i=r,o=0,a=0,c=e[s-1].nextSibling,u=null;for(;o<s||a<i;){if(e[o]===n[a]){o++,a++;continue}for(;e[s-1]===n[i-1];)s--,i--;if(s===o){const f=i<r?a?n[a-1].nextSibling:n[i-a]:c;for(;a<i;)t.insertBefore(n[a++],f)}else if(i===a)for(;o<s;)(!u||!u.has(e[o]))&&e[o].remove(),o++;else if(e[o]===n[i-1]&&n[a]===e[s-1]){const f=e[--s].nextSibling;t.insertBefore(n[a++],e[o++].nextSibling),t.insertBefore(n[--i],f),e[s]=n[i]}else{if(!u){u=new Map;let l=a;for(;l<i;)u.set(n[l],l++)}const f=u.get(e[o]);if(f!=null)if(a<f&&f<i){let l=o,d=1,h;for(;++l<s&&l<i&&!((h=u.get(e[l]))==null||h!==f+d);)d++;if(d>f-a){const g=e[o];for(;a<f;)t.insertBefore(n[a++],g)}else t.replaceChild(n[a++],e[o++])}else o++;else e[o++].remove()}}}const mi="_$DX_DELEGATE";function nl(t,e,n,r={}){let s;return Et(i=>{s=i,e===document?t():oe(e,t(),e.firstChild?null:void 0,n)},r.owner),()=>{s(),e.textContent=""}}function ie(t,e,n){let r;const s=()=>{const o=document.createElement("template");return o.innerHTML=t,n?o.content.firstChild.firstChild:o.content.firstChild},i=e?()=>je(()=>document.importNode(r||(r=s()),!0)):()=>(r||(r=s())).cloneNode(!0);return i.cloneNode=i,i}function To(t,e=window.document){const n=e[mi]||(e[mi]=new Set);for(let r=0,s=t.length;r<s;r++){const i=t[r];n.has(i)||(n.add(i),e.addEventListener(i,cl))}}function J(t,e,n){n==null?t.removeAttribute(e):t.setAttribute(e,n)}function rl(t,e,n,r){r==null?t.removeAttributeNS(e,n):t.setAttributeNS(e,n,r)}function sl(t,e,n){n?t.setAttribute(e,""):t.removeAttribute(e)}function qe(t,e){e==null?t.removeAttribute("class"):t.className=e}function Io(t,e,n,r){if(r)Array.isArray(n)?(t[`$$${e}`]=n[0],t[`$$${e}Data`]=n[1]):t[`$$${e}`]=n;else if(Array.isArray(n)){const s=n[0];t.addEventListener(e,n[0]=i=>s.call(t,n[1],i))}else t.addEventListener(e,n,typeof n!="function"&&n)}function il(t,e,n={}){const r=Object.keys(e||{}),s=Object.keys(n);let i,o;for(i=0,o=s.length;i<o;i++){const a=s[i];!a||a==="undefined"||e[a]||(bi(t,a,!1),delete n[a])}for(i=0,o=r.length;i<o;i++){const a=r[i],c=!!e[a];!a||a==="undefined"||n[a]===c||!c||(bi(t,a,!0),n[a]=c)}return n}function Mo(t,e,n){if(!e)return n?J(t,"style"):e;const r=t.style;if(typeof e=="string")return r.cssText=e;typeof n=="string"&&(r.cssText=n=void 0),n||(n={}),e||(e={});let s,i;for(i in n)e[i]==null&&r.removeProperty(i),delete n[i];for(i in e)s=e[i],s!==n[i]&&(r.setProperty(i,s),n[i]=s);return n}function Te(t,e={},n,r){const s={};return le(()=>typeof e.ref=="function"&&Oo(e.ref,t)),le(()=>ol(t,e,n,!0,s,!0)),s}function Oo(t,e,n){return je(()=>t(e,n))}function oe(t,e,n,r){if(n!==void 0&&!r&&(r=[]),typeof e!="function")return ur(t,e,r,n);le(s=>ur(t,e(),s,n),r)}function ol(t,e,n,r,s={},i=!1){e||(e={});for(const o in s)if(!(o in e)){if(o==="children")continue;s[o]=vi(t,o,null,s[o],n,i,e)}for(const o in e){if(o==="children")continue;const a=e[o];s[o]=vi(t,o,a,s[o],n,i,e)}}function al(t){return t.toLowerCase().replace(/-([a-z])/g,(e,n)=>n.toUpperCase())}function bi(t,e,n){const r=e.trim().split(/\s+/);for(let s=0,i=r.length;s<i;s++)t.classList.toggle(r[s],n)}function vi(t,e,n,r,s,i,o){let a,c,u,f;if(e==="style")return Mo(t,n,r);if(e==="classList")return il(t,n,r);if(n===r)return r;if(e==="ref")i||n(t);else if(e.slice(0,3)==="on:"){const l=e.slice(3);r&&t.removeEventListener(l,r,typeof r!="function"&&r),n&&t.addEventListener(l,n,typeof n!="function"&&n)}else if(e.slice(0,10)==="oncapture:"){const l=e.slice(10);r&&t.removeEventListener(l,r,!0),n&&t.addEventListener(l,n,!0)}else if(e.slice(0,2)==="on"){const l=e.slice(2).toLowerCase(),d=Qu.has(l);if(!d&&r){const h=Array.isArray(r)?r[0]:r;t.removeEventListener(l,h)}(d||n)&&(Io(t,l,n,d),d&&To([l]))}else if(e.slice(0,5)==="attr:")J(t,e.slice(5),n);else if(e.slice(0,5)==="bool:")sl(t,e.slice(5),n);else if((f=e.slice(0,5)==="prop:")||(u=Yu.has(e))||!s||(a=t.nodeName.includes("-")||"is"in o))f&&(e=e.slice(5),c=!0),e==="class"||e==="className"?qe(t,n):a&&!c&&!u?t[al(e)]=n:t[e]=n;else{const l=e.indexOf(":")>-1&&el[e.split(":")[0]];l?rl(t,l,e,n):J(t,Zu[e]||e,n)}return n}function cl(t){let e=t.target;const n=`$$${t.type}`,r=t.target,s=t.currentTarget,i=c=>Object.defineProperty(t,"target",{configurable:!0,value:c}),o=()=>{const c=e[n];if(c&&!e.disabled){const u=e[`${n}Data`];if(u!==void 0?c.call(e,u,t):c.call(e,t),t.cancelBubble)return}return e.host&&typeof e.host!="string"&&!e.host._$host&&e.contains(t.target)&&i(e.host),!0},a=()=>{for(;o()&&(e=e._$host||e.parentNode||e.host););};if(Object.defineProperty(t,"currentTarget",{configurable:!0,get(){return e||document}}),t.composedPath){const c=t.composedPath();i(c[0]);for(let u=0;u<c.length-2&&(e=c[u],!!o());u++){if(e._$host){e=e._$host,a();break}if(e.parentNode===s)break}}else a();i(r)}function ur(t,e,n,r,s){for(;typeof n=="function";)n=n();if(e===n)return n;const i=typeof e,o=r!==void 0;if(t=o&&n[0]&&n[0].parentNode||t,i==="string"||i==="number"){if(i==="number"&&(e=e.toString(),e===n))return n;if(o){let a=n[0];a&&a.nodeType===3?a.data!==e&&(a.data=e):a=document.createTextNode(e),n=Ht(t,n,r,a)}else n!==""&&typeof n=="string"?n=t.firstChild.data=e:n=t.textContent=e}else if(e==null||i==="boolean")n=Ht(t,n,r);else{if(i==="function")return le(()=>{let a=e();for(;typeof a=="function";)a=a();n=ur(t,a,n,r)}),()=>n;if(Array.isArray(e)){const a=[],c=n&&Array.isArray(n);if(_s(a,e,n,s))return le(()=>n=ur(t,a,n,r,!0)),()=>n;if(a.length===0){if(n=Ht(t,n,r),o)return n}else c?n.length===0?xi(t,a,r):tl(t,n,a):(n&&Ht(t),xi(t,a));n=a}else if(e.nodeType){if(Array.isArray(n)){if(o)return n=Ht(t,n,r,e);Ht(t,n,null,e)}else n==null||n===""||!t.firstChild?t.appendChild(e):t.replaceChild(e,t.firstChild);n=e}}return n}function _s(t,e,n,r){let s=!1;for(let i=0,o=e.length;i<o;i++){let a=e[i],c=n&&n[t.length],u;if(!(a==null||a===!0||a===!1))if((u=typeof a)=="object"&&a.nodeType)t.push(a);else if(Array.isArray(a))s=_s(t,a,c)||s;else if(u==="function")if(r){for(;typeof a=="function";)a=a();s=_s(t,Array.isArray(a)?a:[a],Array.isArray(c)?c:[c])||s}else t.push(a),s=!0;else{const f=String(a);c&&c.nodeType===3&&c.data===f?t.push(c):t.push(document.createTextNode(f))}}return s}function xi(t,e,n=null){for(let r=0,s=e.length;r<s;r++)t.insertBefore(e[r],n)}function Ht(t,e,n,r){if(n===void 0)return t.textContent="";const s=r||document.createTextNode("");if(e.length){let i=!1;for(let o=e.length-1;o>=0;o--){const a=e[o];if(s!==a){const c=a.parentNode===t;!i&&!o?c?t.replaceChild(s,a):t.insertBefore(s,n):c&&a.remove()}else i=!0}}else t.insertBefore(s,n);return[s]}function Ro(t){var e,n,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var s=t.length;for(e=0;e<s;e++)t[e]&&(n=Ro(t[e]))&&(r&&(r+=" "),r+=n)}else for(n in t)t[n]&&(r&&(r+=" "),r+=n);return r}function Po(){for(var t,e,n=0,r="",s=arguments.length;n<s;n++)(t=arguments[n])&&(e=Ro(t))&&(r&&(r+=" "),r+=e);return r}function Sr(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ur,Si;function ul(){if(Si)return Ur;Si=1;var t={VERSION:"3.1.1",HEADER_CHUNK_TYPE:[77,84,104,100],HEADER_CHUNK_LENGTH:[0,0,0,6],HEADER_CHUNK_FORMAT0:[0,0],HEADER_CHUNK_FORMAT1:[0,1],HEADER_CHUNK_DIVISION:[0,128],TRACK_CHUNK_TYPE:[77,84,114,107],META_EVENT_ID:255,META_SMTPE_OFFSET:84},e=(C,_)=>Array(Math.abs(_)+1).join(C);function n(C){return C!==null&&typeof C=="object"&&typeof C.name=="string"}function r(C){return C!==null&&typeof C=="object"&&typeof C.step=="number"&&typeof C.alt=="number"}var s=[0,2,4,-1,1,3,5],i=s.map(C=>Math.floor(C*7/12));function o(C){const{step:_,alt:T,oct:$,dir:z=1}=C,ee=s[_]+7*T;if($===void 0)return[z*ee];const K=$-i[_]-4*T;return[z*ee,z*K]}var a={empty:!0,name:"",pc:"",acc:""},c=new Map,u=C=>"CDEFGAB".charAt(C),f=C=>C<0?e("b",-C):e("#",C),l=C=>C[0]==="b"?-C.length:C.length;function d(C){const _=JSON.stringify(C),T=c.get(_);if(T)return T;const $=typeof C=="string"?v(C):r(C)?d(M(C)):n(C)?d(C.name):a;return c.set(_,$),$}var h=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function g(C){const _=h.exec(C);return[_[1].toUpperCase(),_[2].replace(/x/g,"##"),_[3],_[4]]}var w=(C,_)=>(C%_+_)%_,x=[0,2,4,5,7,9,11];function v(C){const _=g(C);if(_[0]===""||_[3]!=="")return a;const T=_[0],$=_[1],z=_[2],ee=(T.charCodeAt(0)+3)%7,K=l($),me=z.length?+z:void 0,He=o({step:ee,alt:K,oct:me}),Bn=T+$+z,Dr=T+$,jn=(x[ee]+K+120)%12,It=me===void 0?w(x[ee]+K,12)-12*99:x[ee]+K+12*(me+1),$r=It>=0&&It<=127?It:null,Pu=me===void 0?null:Math.pow(2,(It-69)/12)*440;return{empty:!1,acc:$,alt:K,chroma:jn,coord:He,freq:Pu,height:It,letter:T,midi:$r,name:Bn,oct:me,pc:Dr,step:ee}}function M(C){const{step:_,alt:T,oct:$}=C,z=u(_);if(!z)return"";const ee=z+f(T);return $||$===0?ee+$:ee}function k(C){return+C>=0&&+C<=127}function F(C){if(k(C))return+C;const _=d(C);return _.empty?null:_.midi}var A=function(){function C(){}return C.version=function(){return t.VERSION},C.stringToBytes=function(_){return _.split("").map(function(T){return T.charCodeAt(0)})},C.isNumeric=function(_){return!isNaN(parseFloat(_))&&isFinite(_)},C.getPitch=function(_,T){return T===void 0&&(T="C4"),60-F(T)+F(_)},C.numberToVariableLength=function(_){_=Math.round(_);for(var T=_&127;_=_>>7;)T<<=8,T|=_&127|128;for(var $=[];$.push(T&255),T&128;)T>>=8;return $},C.stringByteCount=function(_){return encodeURI(_).split(/%..|./).length-1},C.numberFromBytes=function(_){var T="",$;return _.forEach(function(z){$=z.toString(16),$.length==1&&($="0"+$),T+=$}),parseInt(T,16)},C.numberToBytes=function(_,T){T=T||1;var $=_.toString(16);$.length&1&&($="0"+$);var z=$.match(/.{2}/g),ee=z.map(function(K){return parseInt(K,16)});if(ee.length<T)for(;T-ee.length>0;)ee.unshift(0);return ee},C.toArray=function(_){return Array.isArray(_)?_:[_]},C.convertVelocity=function(_){return _=_>100?100:_,Math.round(_/100*127)},C.getTickDuration=function(_){if(Array.isArray(_))return _.map(function(ee){return C.getTickDuration(ee)}).reduce(function(ee,K){return ee+K},0);if(_=_.toString(),_.toLowerCase().charAt(0)==="t"){var T=parseInt(_.substring(1));if(isNaN(T)||T<0)throw new Error(_+" is not a valid duration.");return T}var $=C.numberFromBytes(t.HEADER_CHUNK_DIVISION),z=$*C.getDurationMultiplier(_);return C.getRoundedIfClose(z)},C.getRoundedIfClose=function(_){var T=Math.round(_);return Math.abs(T-_)<1e-6?T:_},C.getPrecisionLoss=function(_){var T=Math.round(_);return T-_},C.getDurationMultiplier=function(_){if(_==="0")return 0;var T=_.match(/^(?<dotted>d+)?(?<base>\d+)(?:t(?<tuplet>\d*))?/);if(T){var $=Number(T.groups.base),z=$===1||($&$-1)===0;if(z){var ee=$/4,K=1/ee,me=T.groups,He=me.dotted,Bn=me.tuplet;if(He){var Dr=He.length,jn=Math.pow(2,Dr);K=K+K*((jn-1)/jn)}if(typeof Bn=="string"){var It=K*2,$r=Number(Bn||"3");K=It/$r}return K}}throw new Error(_+" is not a valid duration.")},C}(),q=function(){function C(_){this.channel=_.channel-1||0,this.controllerValue=_.controllerValue,this.controllerNumber=_.controllerNumber,this.delta=_.delta||0,this.name="ControllerChangeEvent",this.status=176,this.data=A.numberToVariableLength(_.delta).concat(this.status|this.channel,this.controllerNumber,this.controllerValue)}return C}(),Y=function(){function C(_){this.delta=_.delta||0,this.name="CopyrightEvent",this.text=_.text,this.type=2;var T=A.stringToBytes(this.text);this.data=A.numberToVariableLength(this.delta).concat(t.META_EVENT_ID,this.type,A.numberToVariableLength(T.length),T)}return C}(),U=function(){function C(_){this.delta=_.delta||0,this.name="CuePointEvent",this.text=_.text,this.type=7;var T=A.stringToBytes(this.text);this.data=A.numberToVariableLength(this.delta).concat(t.META_EVENT_ID,this.type,A.numberToVariableLength(T.length),T)}return C}(),H=function(){function C(_){this.delta=_?.delta||0,this.name="EndTrackEvent",this.type=[47,0],this.data=A.numberToVariableLength(this.delta).concat(t.META_EVENT_ID,this.type)}return C}(),V=function(){function C(_){this.delta=_.delta||0,this.name="InstrumentNameEvent",this.text=_.text,this.type=4;var T=A.stringToBytes(this.text);this.data=A.numberToVariableLength(this.delta).concat(t.META_EVENT_ID,this.type,A.numberToVariableLength(T.length),T)}return C}(),I=function(){function C(_,T){this.name="KeySignatureEvent",this.type=89;var $=T||0;if(_=_||0,typeof T>"u"){var z=[["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"],["ab","eb","bb","f","c","g","d","a","e","b","f#","c#","g#","d#","a#"]],ee=_.length,K=_||"C";if(_[0]===_[0].toLowerCase()&&($=1),ee>1)switch(_.charAt(ee-1)){case"m":$=1,K=_.charAt(0).toLowerCase(),K=K.concat(_.substring(1,ee-1));break;case"-":$=1,K=_.charAt(0).toLowerCase(),K=K.concat(_.substring(1,ee-1));break;case"M":$=0,K=_.charAt(0).toUpperCase(),K=K.concat(_.substring(1,ee-1));break;case"+":$=0,K=_.charAt(0).toUpperCase(),K=K.concat(_.substring(1,ee-1));break}var me=z[$].indexOf(K);_=me===-1?0:me-7}this.data=A.numberToVariableLength(0).concat(t.META_EVENT_ID,this.type,[2],A.numberToBytes(_,1),A.numberToBytes($,1))}return C}(),W=function(){function C(_){this.delta=_.delta||0,this.name="LyricEvent",this.text=_.text,this.type=5;var T=A.stringToBytes(this.text);this.data=A.numberToVariableLength(this.delta).concat(t.META_EVENT_ID,this.type,A.numberToVariableLength(T.length),T)}return C}(),m=function(){function C(_){this.delta=_.delta||0,this.name="MarkerEvent",this.text=_.text,this.type=6;var T=A.stringToBytes(this.text);this.data=A.numberToVariableLength(this.delta).concat(t.META_EVENT_ID,this.type,A.numberToVariableLength(T.length),T)}return C}(),j=function(){function C(_){this.name="NoteOnEvent",this.channel=_.channel||1,this.pitch=_.pitch,this.wait=_.wait||0,this.velocity=_.velocity||50,this.tick=_.tick||null,this.delta=null,this.data=_.data,this.status=144}return C.prototype.buildData=function(_,T,$){return $===void 0&&($={}),this.data=[],this.tick?(this.tick=A.getRoundedIfClose(this.tick),_.tickPointer==0&&(this.delta=this.tick)):(this.delta=A.getTickDuration(this.wait),this.tick=A.getRoundedIfClose(_.tickPointer+this.delta)),this.deltaWithPrecisionCorrection=A.getRoundedIfClose(this.delta-T),this.data=A.numberToVariableLength(this.deltaWithPrecisionCorrection).concat(this.status|this.channel-1,A.getPitch(this.pitch,$.middleC),A.convertVelocity(this.velocity)),this},C}(),O=function(){function C(_){this.name="NoteOffEvent",this.channel=_.channel||1,this.pitch=_.pitch,this.velocity=_.velocity||50,this.tick=_.tick||null,this.data=_.data,this.delta=_.delta||A.getTickDuration(_.duration),this.status=128}return C.prototype.buildData=function(_,T,$){return $===void 0&&($={}),this.tick===null&&(this.tick=A.getRoundedIfClose(this.delta+_.tickPointer)),this.deltaWithPrecisionCorrection=A.getRoundedIfClose(this.delta-T),this.data=A.numberToVariableLength(this.deltaWithPrecisionCorrection).concat(this.status|this.channel-1,A.getPitch(this.pitch,$.middleC),A.convertVelocity(this.velocity)),this},C}(),D=function(){function C(_){this.data=[],this.name="NoteEvent",this.pitch=A.toArray(_.pitch),this.channel=_.channel||1,this.duration=_.duration||"4",this.grace=_.grace,this.repeat=_.repeat||1,this.sequential=_.sequential||!1,this.tick=_.startTick||_.tick||null,this.velocity=_.velocity||50,this.wait=_.wait||0,this.tickDuration=A.getTickDuration(this.duration),this.restDuration=A.getTickDuration(this.wait),this.events=[]}return C.prototype.buildData=function(){var _=this;if(this.data=[],this.grace){var T=1;this.grace=A.toArray(this.grace),this.grace.forEach(function(){var z=new C({pitch:_.grace,duration:"T"+T});_.data=_.data.concat(z.data)})}if(this.sequential)for(var $=0;$<this.repeat;$++)this.pitch.forEach(function(ee,K){var me=new j({channel:_.channel,wait:K>0?0:_.wait,delta:K>0?0:A.getTickDuration(_.wait),velocity:_.velocity,pitch:ee,tick:_.tick}),He=new O({channel:_.channel,duration:_.duration,velocity:_.velocity,pitch:ee});_.events.push(me,He)});else for(var $=0;$<this.repeat;$++)this.pitch.forEach(function(z,ee){var K;ee==0?K=new j({channel:_.channel,wait:_.wait,delta:A.getTickDuration(_.wait),velocity:_.velocity,pitch:z,tick:_.tick}):K=new j({channel:_.channel,wait:0,delta:0,velocity:_.velocity,pitch:z,tick:_.tick}),_.events.push(K)}),this.pitch.forEach(function(z,ee){var K;ee==0?K=new O({channel:_.channel,duration:_.duration,velocity:_.velocity,pitch:z,tick:_.tick!==null?A.getTickDuration(_.duration)+_.tick:null}):K=new O({channel:_.channel,duration:0,velocity:_.velocity,pitch:z,tick:_.tick!==null?A.getTickDuration(_.duration)+_.tick:null}),_.events.push(K)});return this},C}(),B=function(){function C(_){this.channel=_.channel||0,this.delta=_.delta||0,this.name="PitchBendEvent",this.status=224;var T=this.scale14bits(_.bend),$=T&127,z=T>>7&127;this.data=A.numberToVariableLength(this.delta).concat(this.status|this.channel,$,z)}return C.prototype.scale14bits=function(_){return _<=0?Math.floor(16384*(_+1)/2):Math.floor(16383*(_+1)/2)},C}(),Q=function(){function C(_){this.channel=_.channel||0,this.delta=_.delta||0,this.instrument=_.instrument,this.status=192,this.name="ProgramChangeEvent",this.data=A.numberToVariableLength(this.delta).concat(this.status|this.channel,this.instrument)}return C}(),te=function(){function C(_){this.bpm=_.bpm,this.delta=_.delta||0,this.tick=_.tick,this.name="TempoEvent",this.type=81;var T=Math.round(6e7/this.bpm);this.data=A.numberToVariableLength(this.delta).concat(t.META_EVENT_ID,this.type,[3],A.numberToBytes(T,3))}return C}(),ne=function(){function C(_){this.delta=_.delta||0,this.text=_.text,this.name="TextEvent",this.type=1;var T=A.stringToBytes(this.text);this.data=A.numberToVariableLength(_.delta).concat(t.META_EVENT_ID,this.type,A.numberToVariableLength(T.length),T)}return C}(),re=function(){function C(_,T,$,z){this.name="TimeSignatureEvent",this.type=88,this.data=A.numberToVariableLength(0).concat(t.META_EVENT_ID,this.type,[4],A.numberToBytes(_,1),A.numberToBytes(Math.log2(T),1),A.numberToBytes($||24,1),A.numberToBytes(z||8,1))}return C}(),ae=function(){function C(_){this.delta=_.delta||0,this.name="TrackNameEvent",this.text=_.text,this.type=3;var T=A.stringToBytes(this.text);this.data=A.numberToVariableLength(this.delta).concat(t.META_EVENT_ID,this.type,A.numberToVariableLength(T.length),T)}return C}(),fn=function(){function C(){this.type=t.TRACK_CHUNK_TYPE,this.data=[],this.size=[],this.events=[],this.explicitTickEvents=[],this.tickPointer=0}return C.prototype.addEvent=function(_,T){var $=this;return A.toArray(_).forEach(function(z,ee){if(z instanceof D){if(typeof T=="function"){var K=T(ee,z);typeof K=="object"&&Object.assign(z,K)}z.tick!==null?$.explicitTickEvents.push(z):z.buildData().events.forEach(function(me){return $.events.push(me)})}else $.events.push(z)}),this},C.prototype.buildData=function(_){var T=this;_===void 0&&(_={}),this.data=[],this.size=[],this.tickPointer=0;var $=0;return this.events.forEach(function(z){if(z instanceof j||z instanceof O){var ee=z.buildData(T,$,_);$=A.getPrecisionLoss(z.deltaWithPrecisionCorrection||0),T.data=T.data.concat(ee.data),T.tickPointer=A.getRoundedIfClose(z.tick)}else z instanceof te&&(T.tickPointer=A.getRoundedIfClose(z.tick)),T.data=T.data.concat(z.data)}),this.mergeExplicitTickEvents(),(!this.events.length||!(this.events[this.events.length-1]instanceof H))&&(this.data=this.data.concat(new H().data)),this.size=A.numberToBytes(this.data.length,4),this},C.prototype.mergeExplicitTickEvents=function(){var _=this;this.explicitTickEvents.length&&(this.explicitTickEvents.sort(function(T,$){return T.tick-$.tick}),this.explicitTickEvents.forEach(function(T){T.buildData().events.forEach(function($){return $.buildData(_)}),T.events.forEach(function($){return _.mergeSingleEvent($)})}),this.explicitTickEvents=[],this.buildData())},C.prototype.mergeTrack=function(_){var T=this;return this.buildData(),_.buildData().events.forEach(function($){return T.mergeSingleEvent($)}),this},C.prototype.mergeSingleEvent=function(_){if(!this.events.length){this.addEvent(_);return}for(var T,$=0;$<this.events.length&&!(this.events[$].tick>_.tick);$++)T=$;var z=T+1;_.delta=_.tick-this.events[T].tick,this.events.splice(z,0,_);for(var $=z+1;$<this.events.length;$++)this.events[$].delta=this.events[$].tick-this.events[$-1].tick},C.prototype.removeEventsByName=function(_){var T=this;return this.events.forEach(function($,z){$.name===_&&T.events.splice(z,1)}),this},C.prototype.setTempo=function(_,T){return T===void 0&&(T=0),this.addEvent(new te({bpm:_,tick:T}))},C.prototype.setTimeSignature=function(_,T,$,z){return this.addEvent(new re(_,T,$,z))},C.prototype.setKeySignature=function(_,T){return this.addEvent(new I(_,T))},C.prototype.addText=function(_){return this.addEvent(new ne({text:_}))},C.prototype.addCopyright=function(_){return this.addEvent(new Y({text:_}))},C.prototype.addTrackName=function(_){return this.addEvent(new ae({text:_}))},C.prototype.addInstrumentName=function(_){return this.addEvent(new V({text:_}))},C.prototype.addMarker=function(_){return this.addEvent(new m({text:_}))},C.prototype.addCuePoint=function(_){return this.addEvent(new U({text:_}))},C.prototype.addLyric=function(_){return this.addEvent(new W({text:_}))},C.prototype.polyModeOn=function(){var _=new j({data:[0,176,126,0]});return this.addEvent(_)},C.prototype.setPitchBend=function(_){return this.addEvent(new B({bend:_}))},C.prototype.controllerChange=function(_,T,$,z){return this.addEvent(new q({controllerNumber:_,controllerValue:T,channel:$,delta:z}))},C}(),Iu=function(){function C(){}return C.prototype.trackFromVoice=function(_,T){var $=this;T===void 0&&(T={addRenderedAccidentals:!1});var z=new fn,ee=[];return _.tickables.forEach(function(K){K.noteType==="n"?(z.addEvent(new D({pitch:K.keys.map(function(me,He){return $.convertPitch(me,He,K,T.addRenderedAccidentals)}),duration:$.convertDuration(K),wait:ee})),ee=[]):K.noteType==="r"&&ee.push($.convertDuration(K))}),ee.length>0&&z.addEvent(new D({pitch:"[c4]",duration:"0",wait:ee,velocity:"0"})),z},C.prototype.convertPitch=function(_,T,$,z){var ee;z===void 0&&(z=!1);var K=_.split("/"),me=K[0].substring(1).replace("n","");return z&&((ee=$.getAccidentals())===null||ee===void 0||ee.forEach(function(He){He.index===T&&(He.type==="n"?me="":me+=He.type)})),K[0][0]+me+K[1]},C.prototype.convertDuration=function(_){return"d".repeat(_.dots)+this.convertBaseDuration(_.duration)+(_.tuplet?"t"+_.tuplet.num_notes:"")},C.prototype.convertBaseDuration=function(_){switch(_){case"w":return"1";case"h":return"2";case"q":return"4";default:return _}},C}(),Mu=function(){function C(_){this.type=t.HEADER_CHUNK_TYPE;var T=_>1?t.HEADER_CHUNK_FORMAT1:t.HEADER_CHUNK_FORMAT0;this.data=T.concat(A.numberToBytes(_,2),t.HEADER_CHUNK_DIVISION),this.size=[0,0,0,this.data.length]}return C}(),Ou=function(){function C(_,T){T===void 0&&(T={}),this.tracks=A.toArray(_),this.options=T}return C.prototype.buildData=function(){var _=this,T=[];return T.push(new Mu(this.tracks.length)),this.tracks.forEach(function($){T.push($.buildData(_.options))}),T},C.prototype.buildFile=function(){var _=[];return this.buildData().forEach(function(T){return _=_.concat(T.type,T.size,T.data)}),new Uint8Array(_)},C.prototype.base64=function(){if(typeof btoa=="function"){for(var _="",T=this.buildFile(),$=T.byteLength,z=0;z<$;z++)_+=String.fromCharCode(T[z]);return btoa(_)}return Buffer.from(this.buildFile()).toString("base64")},C.prototype.dataUri=function(){return"data:audio/midi;base64,"+this.base64()},C.prototype.setOption=function(_,T){return this.options[_]=T,this},C.prototype.stdout=function(){return process.stdout.write(Buffer.from(this.buildFile()))},C}(),Ru={Constants:t,ControllerChangeEvent:q,CopyrightEvent:Y,CuePointEvent:U,EndTrackEvent:H,InstrumentNameEvent:V,KeySignatureEvent:I,LyricEvent:W,MarkerEvent:m,NoteOnEvent:j,NoteOffEvent:O,NoteEvent:D,PitchBendEvent:B,ProgramChangeEvent:Q,TempoEvent:te,TextEvent:ne,TimeSignatureEvent:re,Track:fn,TrackNameEvent:ae,Utils:A,VexFlow:Iu,Writer:Ou};return Ur=Ru,Ur}ul();const ll=crypto;function dn(t){let e,n=0;return()=>((!e||n===e.length)&&(e=new t(65536/(t.BYTES_PER_ELEMENT*8)),n=0,ll.getRandomValues(e)),e[n++])}function fl(t,e){let n=0,r=e;return()=>(r===e&&(n=t(),r=0),n&1<<r++?1:0)}const dl={get1:fl(dn(Uint8Array),8),get8:dn(Uint8Array),get16:dn(Uint16Array),get32:dn(Uint32Array),get64:dn(BigUint64Array)},Ln=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0")),Mn=()=>{let t="";for(let e=0;e<4;e++){const n=dl.get32();t+=Ln[n>>>24&255],t+=Ln[n>>>16&255],t+=Ln[n>>>8&255],t+=Ln[n&255]}return t},hl="_active_ozla5_41",gl="_trigger_ozla5_46",_l="_numberButton_ozla5_52",pl="_topRightHud_ozla5_70",yl="_topLeftHud_ozla5_71",wl="_bottomLeftHud_ozla5_72",ml="_bottomRightHud_ozla5_115",bl="_note_ozla5_164",vl="_selected_ozla5_166",xl="_now_ozla5_171",Ce={active:hl,trigger:gl,numberButton:_l,topRightHud:pl,topLeftHud:yl,bottomLeftHud:wl,bottomRightHud:ml,note:bl,selected:vl,now:xl},kt=Symbol.for("_am_meta"),en=Symbol.for("_am_trace"),tn=Symbol.for("_am_objectId"),Er=Symbol.for("_am_isProxy"),Do=Symbol.for("_am_clearCache"),Sl=Symbol.for("_am_uint"),El=Symbol.for("_am_int"),kl=Symbol.for("_am_f64"),$o=Symbol.for("_am_counter"),Al=Symbol.for("_am_text");class mt{constructor(e){if(typeof e=="string")this.elems=[...e];else if(Array.isArray(e))this.elems=e;else if(e===void 0)this.elems=[];else throw new TypeError(`Unsupported initial value for Text: ${e}`);Reflect.defineProperty(this,Al,{value:!0})}get length(){return this.elems.length}get(e){return this.elems[e]}[Symbol.iterator](){const e=this.elems;let n=-1;return{next(){return n+=1,n<e.length?{done:!1,value:e[n]}:{done:!0}}}}toString(){if(!this.str){this.str="";for(const e of this.elems)typeof e=="string"?this.str+=e:this.str+="￼"}return this.str}toSpans(){if(!this.spans){this.spans=[];let e="";for(const n of this.elems)typeof n=="string"?e+=n:(e.length>0&&(this.spans.push(e),e=""),this.spans.push(n));e.length>0&&this.spans.push(e)}return this.spans}toJSON(){return this.toString()}set(e,n){if(this[kt])throw new RangeError("object cannot be modified outside of a change block");this.elems[e]=n}insertAt(e,...n){if(this[kt])throw new RangeError("object cannot be modified outside of a change block");n.every(r=>typeof r=="string")?this.elems.splice(e,0,...n.join("")):this.elems.splice(e,0,...n)}deleteAt(e,n=1){if(this[kt])throw new RangeError("object cannot be modified outside of a change block");this.elems.splice(e,n)}map(e){this.elems.map(e)}lastIndexOf(e,n){this.elems.lastIndexOf(e,n)}concat(e){return new mt(this.elems.concat(e.elems))}every(e){return this.elems.every(e)}filter(e){return new mt(this.elems.filter(e))}find(e){return this.elems.find(e)}findIndex(e){return this.elems.findIndex(e)}forEach(e){this.elems.forEach(e)}includes(e){return this.elems.includes(e)}indexOf(e){return this.elems.indexOf(e)}join(e){return this.elems.join(e)}reduce(e){this.elems.reduce(e)}reduceRight(e){this.elems.reduceRight(e)}slice(e,n){return new mt(this.elems.slice(e,n))}some(e){return this.elems.some(e)}toLocaleString(){this.toString()}}class ps{constructor(e){this.value=e||0,Reflect.defineProperty(this,$o,{value:!0})}valueOf(){return this.value}toString(){return this.valueOf().toString()}toJSON(){return this.value}increment(e){throw new Error("Counters should not be incremented outside of a change callback")}decrement(e){throw new Error("Counters should not be decremented outside of a change callback")}}class Cl extends ps{constructor(e,n,r,s,i){super(e),this.context=n,this.path=r,this.objectId=s,this.key=i}increment(e){return e=typeof e=="number"?e:1,this.context.increment(this.objectId,this.key,e),this.value+=e,this.value}decrement(e){return this.increment(typeof e=="number"?-e:-1)}}function Tl(t,e,n,r,s){return new Cl(t,e,n,r,s)}class ys{constructor(e){this.val=e}toString(){return this.val}toJSON(){return this.val}}function it(t){if(typeof t=="string"&&/^[0-9]+$/.test(t)&&(t=parseInt(t,10)),typeof t!="number")return t;if(t<0||isNaN(t)||t===1/0||t===-1/0)throw new RangeError("A list index must be positive, but you passed "+t);return t}function Fe(t,e){const{context:n,objectId:r,path:s,textV2:i}=t,o=n.getWithType(r,e);if(o===null)return;const a=o[0],c=o[1];switch(a){case void 0:return;case"map":return On(n,c,i,[...s,e]);case"list":return Ar(n,c,i,[...s,e]);case"text":return i?n.text(c):vn(n,c,[...s,e]);case"str":return c;case"uint":return c;case"int":return c;case"f64":return c;case"boolean":return c;case"null":return null;case"bytes":return c;case"timestamp":return c;case"counter":return Tl(c,n,s,r,e);default:throw RangeError(`datatype ${a} unimplemented`)}}function lr(t,e,n,r){const s=typeof t;switch(s){case"object":if(t==null)return[null,"null"];if(t[Sl])return[t.value,"uint"];if(t[El])return[t.value,"int"];if(t[kl])return[t.value,"f64"];if(t[$o])return[t.value,"counter"];if(t instanceof Date)return[t.getTime(),"timestamp"];if(t instanceof ys)return[t.toString(),"str"];if(t instanceof mt)return[t,"text"];if(t instanceof Uint8Array)return[t,"bytes"];if(t instanceof Array)return[t,"list"];if(Object.prototype.toString.call(t)==="[object Object]")return[t,"map"];throw kr(t,r)?new RangeError("Cannot create a reference to an existing document object"):new RangeError(`Cannot assign unknown object: ${t}`);case"boolean":return[t,"boolean"];case"number":return Number.isInteger(t)?[t,"int"]:[t,"f64"];case"string":return e?[t,"text"]:[t,"str"];case"undefined":throw new RangeError([`Cannot assign undefined value at ${Ei(n)}, `,"because `undefined` is not a valid JSON data type. ","You might consider setting the property's value to `null`, ","or using `delete` to remove it altogether."].join(""));default:throw new RangeError([`Cannot assign ${s} value at ${Ei(n)}. `,"All JSON primitive datatypes (object, array, string, number, boolean, null) ",`are supported in an Automerge document; ${s} values are not. `].join(""))}}function kr(t,e){var n,r;return t instanceof Date?!1:!!(t&&((r=(n=t[kt])===null||n===void 0?void 0:n.handle)===null||r===void 0?void 0:r.__wbg_ptr)===e.__wbg_ptr)}const Il={get(t,e){const{context:n,objectId:r,cache:s}=t;return e===Symbol.toStringTag?t[Symbol.toStringTag]:e===tn?r:e===Er?!0:e===en?t.trace:e===kt?{handle:n,textV2:t.textV2}:(s[e]||(s[e]=Fe(t,e)),s[e])},set(t,e,n){const{context:r,objectId:s,path:i,textV2:o}=t;if(t.cache={},kr(n,r))throw new RangeError("Cannot create a reference to an existing document object");if(e===en)return t.trace=n,!0;if(e===Do)return!0;const[a,c]=lr(n,o,[...i,e],r);switch(c){case"list":{const u=r.putObject(s,e,[]),f=Ar(r,u,o,[...i,e]);for(let l=0;l<a.length;l++)f[l]=a[l];break}case"text":{if(o)fr(a),r.putObject(s,e,a);else{Ks(a);const u=r.putObject(s,e,"");vn(r,u,[...i,e]).splice(0,0,...a)}break}case"map":{const u=r.putObject(s,e,{}),f=On(r,u,o,[...i,e]);for(const l in a)f[l]=a[l];break}default:r.put(s,e,a,c)}return!0},deleteProperty(t,e){const{context:n,objectId:r}=t;return t.cache={},n.delete(r,e),!0},has(t,e){return this.get(t,e)!==void 0},getOwnPropertyDescriptor(t,e){const n=this.get(t,e);if(typeof n<"u")return{configurable:!0,enumerable:!0,value:n}},ownKeys(t){const{context:e,objectId:n}=t,r=e.keys(n);return[...new Set(r)]}},Bo={get(t,e){const{context:n,objectId:r}=t;return e=it(e),e===Symbol.hasInstance?s=>Array.isArray(s):e===Symbol.toStringTag?t[Symbol.toStringTag]:e===tn?r:e===Er?!0:e===en?t.trace:e===kt?{handle:n}:e==="length"?n.length(r):typeof e=="number"?Fe(t,e):Gs(t)[e]},set(t,e,n){const{context:r,objectId:s,path:i,textV2:o}=t;if(e=it(e),kr(n,r))throw new RangeError("Cannot create a reference to an existing document object");if(e===Do)return!0;if(e===en)return t.trace=n,!0;if(typeof e=="string")throw new RangeError("list index must be a number");const[a,c]=lr(n,o,[...i,e],r);switch(c){case"list":{let u;e>=r.length(s)?u=r.insertObject(s,e,[]):u=r.putObject(s,e,[]),Ar(r,u,o,[...i,e]).splice(0,0,...a);break}case"text":{if(o)fr(a),e>=r.length(s)?r.insertObject(s,e,a):r.putObject(s,e,a);else{let u;Ks(a),e>=r.length(s)?u=r.insertObject(s,e,""):u=r.putObject(s,e,""),vn(r,u,[...i,e]).splice(0,0,...a)}break}case"map":{let u;e>=r.length(s)?u=r.insertObject(s,e,{}):u=r.putObject(s,e,{});const f=On(r,u,o,[...i,e]);for(const l in a)f[l]=a[l];break}default:e>=r.length(s)?r.insert(s,e,a,c):r.put(s,e,a,c)}return!0},deleteProperty(t,e){const{context:n,objectId:r}=t;e=it(e);const s=n.get(r,e);if(s!=null&&s[0]=="counter")throw new TypeError("Unsupported operation: deleting a counter from a list");return n.delete(r,e),!0},has(t,e){const{context:n,objectId:r}=t;return e=it(e),typeof e=="number"?e<n.length(r):e==="length"},getOwnPropertyDescriptor(t,e){const{context:n,objectId:r}=t;return e==="length"?{writable:!0,value:n.length(r)}:e===tn?{configurable:!1,enumerable:!1,value:r}:(e=it(e),{configurable:!0,enumerable:!0,value:Fe(t,e)})},getPrototypeOf(t){return Object.getPrototypeOf(t)},ownKeys(){const t=[];return t.push("length"),t}},Ml=Object.assign({},Bo,{get(t,e){const{context:n,objectId:r}=t;return e=it(e),e===Symbol.hasInstance?s=>Array.isArray(s):e===Symbol.toStringTag?t[Symbol.toStringTag]:e===tn?r:e===Er?!0:e===en?t.trace:e===kt?{handle:n}:e==="length"?n.length(r):typeof e=="number"?Fe(t,e):Rl(t)[e]||Gs(t)[e]},getPrototypeOf(){return Object.getPrototypeOf(new mt)}});function On(t,e,n,r){const s={context:t,objectId:e,path:r||[],cache:{},textV2:n},i={};return Object.assign(i,s),new Proxy(i,Il)}function Ar(t,e,n,r){const s={context:t,objectId:e,path:r||[],cache:{},textV2:n},i=[];return Object.assign(i,s),new Proxy(i,Bo)}function vn(t,e,n){const r={context:t,objectId:e,path:n||[],cache:{},textV2:!1},s={};return Object.assign(s,r),new Proxy(s,Ml)}function Ol(t,e){return On(t,"_root",e,[])}function Gs(t){const{context:e,objectId:n,path:r,textV2:s}=t;return{deleteAt(o,a){return typeof a=="number"?e.splice(n,o,a):e.delete(n,o),this},fill(o,a,c){const[u,f]=lr(o,s,[...r,a],e),l=e.length(n);a=it(a||0),c=it(c||l);for(let d=a;d<Math.min(c,l);d++)if(f==="list"||f==="map")e.putObject(n,d,u);else if(f==="text")if(s)fr(u),e.putObject(n,d,u);else{Ks(u);const h=e.putObject(n,d,""),g=vn(e,h,[...r,d]);for(let w=0;w<u.length;w++)g[w]=u.get(w)}else e.put(n,d,u,f);return this},indexOf(o,a=0){const c=e.length(n);for(let u=a;u<c;u++){const f=e.getWithType(n,u);if(f&&(f[1]===o[tn]||f[1]===o))return u}return-1},insertAt(o,...a){return this.splice(o,0,...a),this},pop(){const o=e.length(n);if(o==0)return;const a=Fe(t,o-1);return e.delete(n,o-1),a},push(...o){const a=e.length(n);return this.splice(a,0,...o),e.length(n)},shift(){if(e.length(n)==0)return;const o=Fe(t,0);return e.delete(n,0),o},splice(o,a,...c){o=it(o),typeof a!="number"&&(a=e.length(n)-o),a=it(a);for(const l of c)if(kr(l,e))throw new RangeError("Cannot create a reference to an existing document object");const u=[];for(let l=0;l<a;l++){const d=Fe(t,o);d!==void 0&&u.push(d),e.delete(n,o)}const f=c.map((l,d)=>{try{return lr(l,s,[...r],e)}catch(h){throw h instanceof RangeError?new RangeError(`${h.message} (at index ${d} in the input)`):h}});for(const[l,d]of f){switch(d){case"list":{const h=e.insertObject(n,o,[]);Ar(e,h,s,[...r,o]).splice(0,0,...l);break}case"text":{if(s)fr(l),e.insertObject(n,o,l);else{const h=e.insertObject(n,o,"");vn(e,h,[...r,o]).splice(0,0,...l)}break}case"map":{const h=e.insertObject(n,o,{}),g=On(e,h,s,[...r,o]);for(const w in l)g[w]=l[w];break}default:e.insert(n,o,l,d)}o+=1}return u},unshift(...o){return this.splice(0,0,...o),e.length(n)},entries(){let o=0;return{next:()=>{const c=Fe(t,o);return c===void 0?{value:void 0,done:!0}:{value:[o++,c],done:!1}},[Symbol.iterator](){return this}}},keys(){let o=0;const a=e.length(n);return{next:()=>o<a?{value:o++,done:!1}:{value:void 0,done:!0},[Symbol.iterator](){return this}}},values(){let o=0;return{next:()=>{const c=Fe(t,o++);return c===void 0?{value:void 0,done:!0}:{value:c,done:!1}},[Symbol.iterator](){return this}}},toArray(){const o=[];let a;do a=Fe(t,o.length),a!==void 0&&o.push(a);while(a!==void 0);return o},map(o){return this.toArray().map(o)},toString(){return this.toArray().toString()},toLocaleString(){return this.toArray().toLocaleString()},forEach(o){return this.toArray().forEach(o)},concat(o){return this.toArray().concat(o)},every(o){return this.toArray().every(o)},filter(o){return this.toArray().filter(o)},find(o){let a=0;for(const c of this){if(o(c,a))return c;a+=1}},findIndex(o){let a=0;for(const c of this){if(o(c,a))return a;a+=1}return-1},includes(o){return this.find(a=>a===o)!==void 0},join(o){return this.toArray().join(o)},reduce(o,a){return this.toArray().reduce(o,a)},reduceRight(o,a){return this.toArray().reduceRight(o,a)},lastIndexOf(o,a=1/0){return this.toArray().lastIndexOf(o,a)},slice(o,a){return this.toArray().slice(o,a)},some(o){let a=0;for(const c of this){if(o(c,a))return!0;a+=1}return!1},[Symbol.iterator]:function*(){let o=0,a=Fe(t,o);for(;a!==void 0;)yield a,o+=1,a=Fe(t,o)}}}function Rl(t){const{context:e,objectId:n}=t;return{set(s,i){return this[s]=i},get(s){return this[s]},toString(){return e.text(n).replace(/￼/g,"")},toSpans(){const s=[];let i="";const o=e.length(n);for(let a=0;a<o;a++){const c=this[a];typeof c=="string"?i+=c:(i.length>0&&(s.push(i),i=""),s.push(c))}return i.length>0&&s.push(i),s},toJSON(){return this.toString()},indexOf(s,i=0){return e.text(n).indexOf(s,i)},insertAt(s,...i){i.every(o=>typeof o=="string")?e.splice(n,s,0,i.join("")):Gs(t).insertAt(s,...i)}}}function Ks(t){if(!(t instanceof mt))throw new Error("value was not a Text instance")}function fr(t){if(typeof t!="string")throw new Error("value was not a string")}function Ei(t){const e=t.map(n=>{if(typeof n=="number")return n.toString();if(typeof n=="string")return n.replace(/~/g,"~0").replace(/\//g,"~1")});return t.length===0?"":"/"+e.join("/")}let Un;const Pl=new Uint8Array(16);function Dl(){if(!Un&&(Un=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Un))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Un(Pl)}const $l=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Cr(t){return typeof t=="string"&&$l.test(t)}const Ie=[];for(let t=0;t<256;++t)Ie.push((t+256).toString(16).slice(1));function jo(t,e=0){return Ie[t[e+0]]+Ie[t[e+1]]+Ie[t[e+2]]+Ie[t[e+3]]+"-"+Ie[t[e+4]]+Ie[t[e+5]]+"-"+Ie[t[e+6]]+Ie[t[e+7]]+"-"+Ie[t[e+8]]+Ie[t[e+9]]+"-"+Ie[t[e+10]]+Ie[t[e+11]]+Ie[t[e+12]]+Ie[t[e+13]]+Ie[t[e+14]]+Ie[t[e+15]]}function Bl(t,e=0){const n=jo(t,e);if(!Cr(n))throw TypeError("Stringified UUID is invalid");return n}function jl(t){if(!Cr(t))throw TypeError("Invalid UUID");let e;const n=new Uint8Array(16);return n[0]=(e=parseInt(t.slice(0,8),16))>>>24,n[1]=e>>>16&255,n[2]=e>>>8&255,n[3]=e&255,n[4]=(e=parseInt(t.slice(9,13),16))>>>8,n[5]=e&255,n[6]=(e=parseInt(t.slice(14,18),16))>>>8,n[7]=e&255,n[8]=(e=parseInt(t.slice(19,23),16))>>>8,n[9]=e&255,n[10]=(e=parseInt(t.slice(24,36),16))/1099511627776&255,n[11]=e/4294967296&255,n[12]=e>>>24&255,n[13]=e>>>16&255,n[14]=e>>>8&255,n[15]=e&255,n}const Ll=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ki={randomUUID:Ll};function Lo(t,e,n){if(ki.randomUUID&&!e&&!t)return ki.randomUUID();t=t||{};const r=t.random||(t.rng||Dl)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){n=n||0;for(let s=0;s<16;++s)e[n+s]=r[s];return e}return jo(r)}let Uo;const No=new Array(128).fill(void 0);No.push(void 0,null,!0,!1);No.length;const Nr=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}};Nr.encodeInto;const Ul=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Ul.decode();typeof FinalizationRegistry>"u"||new FinalizationRegistry(t=>Uo.__wbg_automerge_free(t>>>0));typeof FinalizationRegistry>"u"||new FinalizationRegistry(t=>Uo.__wbg_syncstate_free(t>>>0));let Nl=[];function Hl(t){for(const e in t)Le[e]=t[e];for(const e of Nl)e()}const Le={create(t){throw new RangeError("Automerge.use() not called")},load(t,e){throw new RangeError("Automerge.use() not called (load)")},encodeChange(t){throw new RangeError("Automerge.use() not called (encodeChange)")},decodeChange(t){throw new RangeError("Automerge.use() not called (decodeChange)")},initSyncState(){throw new RangeError("Automerge.use() not called (initSyncState)")},encodeSyncMessage(t){throw new RangeError("Automerge.use() not called (encodeSyncMessage)")},decodeSyncMessage(t){throw new RangeError("Automerge.use() not called (decodeSyncMessage)")},encodeSyncState(t){throw new RangeError("Automerge.use() not called (encodeSyncState)")},decodeSyncState(t){throw new RangeError("Automerge.use() not called (decodeSyncState)")},exportSyncState(t){throw new RangeError("Automerge.use() not called (exportSyncState)")},importSyncState(t){throw new RangeError("Automerge.use() not called (importSyncState)")}};function Pe(t,e=!0){if(typeof t!="object")throw new RangeError("must be the document root");const n=Reflect.get(t,kt);if(n===void 0||n==null||e&&Fl(t)!=="_root")throw new RangeError("must be the document root");return n}function Ho(t){return Reflect.get(t,en)}function Fl(t){return typeof t!="object"||t===null?null:Reflect.get(t,tn)}function Tr(t){return!!Reflect.get(t,Er)}var ql=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]]);return n};function Xs(t){return typeof t=="object"?t:{actor:t}}function Js(t){const e=Xs(t),n=!!e.freeze,r=e.patchCallback,s=!e.enableTextV2,i=e.actor,o=Le.create({actor:i,text_v1:s});o.enableFreeze(!!e.freeze);const a=e.enableTextV2||!1;return Wo(o,a),o.materialize("/",void 0,{handle:o,heads:void 0,freeze:n,patchCallback:r,textV2:a})}function Vl(t,e){const n=Pe(t),r=n.heads,s=Xs(e),i=n.handle.fork(s.actor,r);i.updateDiffCursor();const o=ql(n,["heads"]);return o.patchCallback=s.patchCallback,i.applyPatches(t,Object.assign(Object.assign({},o),{handle:i}))}function zl(t,e){return xn(Js(e),"from",{},n=>Object.assign(n,t)).newDoc}function Wl(t,e,n){if(typeof e=="function")return xn(t,"change",{},e).newDoc;if(typeof n=="function")return typeof e=="string"&&(e={message:e}),xn(t,"change",e,n).newDoc;throw RangeError("Invalid args for change")}function Gl(t,e,n,r){if(typeof n=="function")return xn(t,"changeAt",{},n,e);if(typeof r=="function")return typeof n=="string"&&(n={message:n}),xn(t,"changeAt",n,r,e);throw RangeError("Invalid args for changeAt")}function Rn(t,e,n,r){if(n==null)return t;const s=Pe(t),i=Object.assign(Object.assign({},s),{heads:void 0}),{value:o,patches:a}=s.handle.applyAndReturnPatches(t,i);if(a.length>0){r?.(a,{before:t,after:o,source:e});const c=Pe(o);c.mostRecentPatch={before:Pe(t).heads,after:c.handle.getHeads(),patches:a}}return s.heads=n,o}function xn(t,e,n,r,s){if(typeof r!="function")throw new RangeError("invalid change function");const i=Pe(t);if(t===void 0||i===void 0)throw new RangeError("must be the document root");if(i.heads)throw new RangeError("Attempting to change an outdated document.  Use Automerge.clone() if you wish to make a writable copy.");if(Tr(t))throw new RangeError("Calls to Automerge.change cannot be nested");let o=i.handle.getHeads();s&&Zl(s,o)&&(s=void 0),s&&(i.handle.isolate(s),o=s),"time"in n||(n.time=Math.floor(Date.now()/1e3));try{i.heads=o;const a=Ol(i.handle,i.textV2);if(r(a),i.handle.pendingOps()===0)return i.heads=void 0,s&&i.handle.integrate(),{newDoc:t,newHeads:null};{const c=i.handle.commit(n.message,n.time);return i.handle.integrate(),{newDoc:Rn(t,e,o,n.patchCallback||i.patchCallback),newHeads:c!=null?[c]:null}}}catch(a){throw i.heads=void 0,i.handle.rollback(),a}}function Kl(t,e){e===void 0&&(e={}),typeof e=="string"&&(e={message:e}),"time"in e||(e.time=Math.floor(Date.now()/1e3));const n=Pe(t);if(n.heads)throw new RangeError("Attempting to change an outdated document.  Use Automerge.clone() if you wish to make a writable copy.");if(Tr(t))throw new RangeError("Calls to Automerge.change cannot be nested");const r=n.handle.getHeads();return n.handle.emptyChange(e.message,e.time),Rn(t,"emptyChange",r)}function Xl(t,e){const n=Xs(e),r=n.actor,s=n.patchCallback,i=!n.enableTextV2,o=n.unchecked||!1,a=n.allowMissingChanges||!1,c=n.convertRawStringsToText||!1,u=Le.load(t,{text_v1:i,actor:r,unchecked:o,allowMissingDeps:a,convertRawStringsToText:c});u.enableFreeze(!!n.freeze);const f=n.enableTextV2||!1;return Wo(u,f),u.materialize("/",void 0,{handle:u,heads:void 0,patchCallback:s,textV2:f})}function Fo(t,e,n){n||(n={});const r=Pe(t);if(r.heads)throw new RangeError("Attempting to change an out of date document - set at: "+Ho(t));if(Tr(t))throw new RangeError("Calls to Automerge.change cannot be nested");const s=r.handle.getHeads();return r.handle.loadIncremental(e),Rn(t,"loadIncremental",s,n.patchCallback||r.patchCallback)}function qo(t){return Pe(t).handle.save()}function Jl(t,e){const n=Pe(t);if(n.heads)throw new RangeError("Attempting to change an out of date document - set at: "+Ho(t));const r=n.handle.getHeads(),s=Pe(e),i=n.handle.getChangesAdded(s.handle);return n.handle.applyChanges(i),Rn(t,"merge",r,n.patchCallback)}function Yl(t,e,n){Ai(e,"before"),Ai(n,"after");const r=Pe(t);return r.mostRecentPatch&&ws(r.mostRecentPatch.before,e)&&ws(r.mostRecentPatch.after,n)?r.mostRecentPatch.patches:r.handle.diff(e,n)}function Zl(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Ai(t,e){if(!Array.isArray(t))throw new Error(`${e} must be an array`)}function ws(t,e){if(!Ci(t)||!Ci(e))return t===e;const n=Object.keys(t).sort(),r=Object.keys(e).sort();if(n.length!==r.length)return!1;for(let s=0;s<n.length;s++)if(n[s]!==r[s]||!ws(t[n[s]],e[r[s]]))return!1;return!0}function Vo(t){const e=Le.importSyncState(t),n=Le.encodeSyncState(e);return e.free(),n}function zo(t){const e=Le.decodeSyncState(t),n=Le.exportSyncState(e);return e.free(),n}function Ql(t,e){const n=Pe(t),r=Le.importSyncState(e),s=n.handle.generateSyncMessage(r);return[Le.exportSyncState(r),s]}function ef(t,e,n,r){const s=Le.importSyncState(e);r||(r={});const i=Pe(t);if(i.heads)throw new RangeError("Attempting to change an outdated document.  Use Automerge.clone() if you wish to make a writable copy.");if(Tr(t))throw new RangeError("Calls to Automerge.change cannot be nested");const o=i.handle.getHeads();i.handle.receiveSyncMessage(s,n);const a=Le.exportSyncState(s);return[Rn(t,"receiveSyncMessage",o,r.patchCallback||i.patchCallback),a,null]}function tf(){return Le.exportSyncState(Le.initSyncState())}function nf(t){return Le.decodeSyncMessage(t)}function Ye(t){const e=Pe(t);return e.heads||e.handle.getHeads()}function Ci(t){return typeof t=="object"&&t!==null}function rf(t,e){return Pe(t).handle.saveSince(e)}function Wo(t,e){t.registerDatatype("counter",n=>new ps(n),n=>{if(n instanceof ps)return n.value}),e?t.registerDatatype("str",n=>new ys(n),n=>{if(n instanceof ys)return n.val}):t.registerDatatype("text",n=>new mt(n),n=>{if(n instanceof mt)return n.join("")})}function Ir(t){const e=Mr(t);return e.enableTextV2=!0,Js(e)}function Ti(t,e){const n=Mr(e);return n.enableTextV2=!0,Vl(t,n)}function sf(t,e){const n=Mr(e);return n.enableTextV2=!0,zl(t,n)}function of(t,e){const n=Mr(e);return n.enableTextV2=!0,n.patchCallback?Fo(Js(n),t):Xl(t,n)}function Mr(t){return{actor:t}}var Nn={exports:{}},Hr,Ii;function af(){if(Ii)return Hr;Ii=1;var t=1e3,e=t*60,n=e*60,r=n*24,s=r*7,i=r*365.25;Hr=function(f,l){l=l||{};var d=typeof f;if(d==="string"&&f.length>0)return o(f);if(d==="number"&&isFinite(f))return l.long?c(f):a(f);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(f))};function o(f){if(f=String(f),!(f.length>100)){var l=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(f);if(l){var d=parseFloat(l[1]),h=(l[2]||"ms").toLowerCase();switch(h){case"years":case"year":case"yrs":case"yr":case"y":return d*i;case"weeks":case"week":case"w":return d*s;case"days":case"day":case"d":return d*r;case"hours":case"hour":case"hrs":case"hr":case"h":return d*n;case"minutes":case"minute":case"mins":case"min":case"m":return d*e;case"seconds":case"second":case"secs":case"sec":case"s":return d*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return d;default:return}}}}function a(f){var l=Math.abs(f);return l>=r?Math.round(f/r)+"d":l>=n?Math.round(f/n)+"h":l>=e?Math.round(f/e)+"m":l>=t?Math.round(f/t)+"s":f+"ms"}function c(f){var l=Math.abs(f);return l>=r?u(f,l,r,"day"):l>=n?u(f,l,n,"hour"):l>=e?u(f,l,e,"minute"):l>=t?u(f,l,t,"second"):f+" ms"}function u(f,l,d,h){var g=l>=d*1.5;return Math.round(f/d)+" "+h+(g?"s":"")}return Hr}var Fr,Mi;function cf(){if(Mi)return Fr;Mi=1;function t(e){r.debug=r,r.default=r,r.coerce=u,r.disable=a,r.enable=i,r.enabled=c,r.humanize=af(),r.destroy=f,Object.keys(e).forEach(l=>{r[l]=e[l]}),r.names=[],r.skips=[],r.formatters={};function n(l){let d=0;for(let h=0;h<l.length;h++)d=(d<<5)-d+l.charCodeAt(h),d|=0;return r.colors[Math.abs(d)%r.colors.length]}r.selectColor=n;function r(l){let d,h=null,g,w;function x(...v){if(!x.enabled)return;const M=x,k=Number(new Date),F=k-(d||k);M.diff=F,M.prev=d,M.curr=k,d=k,v[0]=r.coerce(v[0]),typeof v[0]!="string"&&v.unshift("%O");let A=0;v[0]=v[0].replace(/%([a-zA-Z%])/g,(Y,U)=>{if(Y==="%%")return"%";A++;const H=r.formatters[U];if(typeof H=="function"){const V=v[A];Y=H.call(M,V),v.splice(A,1),A--}return Y}),r.formatArgs.call(M,v),(M.log||r.log).apply(M,v)}return x.namespace=l,x.useColors=r.useColors(),x.color=r.selectColor(l),x.extend=s,x.destroy=r.destroy,Object.defineProperty(x,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(g!==r.namespaces&&(g=r.namespaces,w=r.enabled(l)),w),set:v=>{h=v}}),typeof r.init=="function"&&r.init(x),x}function s(l,d){const h=r(this.namespace+(typeof d>"u"?":":d)+l);return h.log=this.log,h}function i(l){r.save(l),r.namespaces=l,r.names=[],r.skips=[];const d=(typeof l=="string"?l:"").trim().replace(" ",",").split(",").filter(Boolean);for(const h of d)h[0]==="-"?r.skips.push(h.slice(1)):r.names.push(h)}function o(l,d){let h=0,g=0,w=-1,x=0;for(;h<l.length;)if(g<d.length&&(d[g]===l[h]||d[g]==="*"))d[g]==="*"?(w=g,x=h,g++):(h++,g++);else if(w!==-1)g=w+1,x++,h=x;else return!1;for(;g<d.length&&d[g]==="*";)g++;return g===d.length}function a(){const l=[...r.names,...r.skips.map(d=>"-"+d)].join(",");return r.enable(""),l}function c(l){for(const d of r.skips)if(o(l,d))return!1;for(const d of r.names)if(o(l,d))return!0;return!1}function u(l){return l instanceof Error?l.stack||l.message:l}function f(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}return Fr=t,Fr}var Oi;function uf(){return Oi||(Oi=1,function(t,e){var n={};e.formatArgs=s,e.save=i,e.load=o,e.useColors=r,e.storage=a(),e.destroy=(()=>{let u=!1;return()=>{u||(u=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let u;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(u=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(u[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function s(u){if(u[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+u[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const f="color: "+this.color;u.splice(1,0,f,"color: inherit");let l=0,d=0;u[0].replace(/%[a-zA-Z%]/g,h=>{h!=="%%"&&(l++,h==="%c"&&(d=l))}),u.splice(d,0,f)}e.log=console.debug||console.log||(()=>{});function i(u){try{u?e.storage.setItem("debug",u):e.storage.removeItem("debug")}catch{}}function o(){let u;try{u=e.storage.getItem("debug")}catch{}return!u&&typeof process<"u"&&"env"in process&&(u=n.DEBUG),u}function a(){try{return localStorage}catch{}}t.exports=cf()(e);const{formatters:c}=t.exports;c.j=function(u){try{return JSON.stringify(u)}catch(f){return"[UnexpectedJSONParseError]: "+f.message}}}(Nn,Nn.exports)),Nn.exports}var lf=uf();const vt=Sr(lf);var qr={exports:{}},Ri;function ff(){return Ri||(Ri=1,function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1));function s(c,u,f){this.fn=c,this.context=u,this.once=f||!1}function i(c,u,f,l,d){if(typeof f!="function")throw new TypeError("The listener must be a function");var h=new s(f,l||c,d),g=n?n+u:u;return c._events[g]?c._events[g].fn?c._events[g]=[c._events[g],h]:c._events[g].push(h):(c._events[g]=h,c._eventsCount++),c}function o(c,u){--c._eventsCount===0?c._events=new r:delete c._events[u]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var u=[],f,l;if(this._eventsCount===0)return u;for(l in f=this._events)e.call(f,l)&&u.push(n?l.slice(1):l);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(f)):u},a.prototype.listeners=function(u){var f=n?n+u:u,l=this._events[f];if(!l)return[];if(l.fn)return[l.fn];for(var d=0,h=l.length,g=new Array(h);d<h;d++)g[d]=l[d].fn;return g},a.prototype.listenerCount=function(u){var f=n?n+u:u,l=this._events[f];return l?l.fn?1:l.length:0},a.prototype.emit=function(u,f,l,d,h,g){var w=n?n+u:u;if(!this._events[w])return!1;var x=this._events[w],v=arguments.length,M,k;if(x.fn){switch(x.once&&this.removeListener(u,x.fn,void 0,!0),v){case 1:return x.fn.call(x.context),!0;case 2:return x.fn.call(x.context,f),!0;case 3:return x.fn.call(x.context,f,l),!0;case 4:return x.fn.call(x.context,f,l,d),!0;case 5:return x.fn.call(x.context,f,l,d,h),!0;case 6:return x.fn.call(x.context,f,l,d,h,g),!0}for(k=1,M=new Array(v-1);k<v;k++)M[k-1]=arguments[k];x.fn.apply(x.context,M)}else{var F=x.length,A;for(k=0;k<F;k++)switch(x[k].once&&this.removeListener(u,x[k].fn,void 0,!0),v){case 1:x[k].fn.call(x[k].context);break;case 2:x[k].fn.call(x[k].context,f);break;case 3:x[k].fn.call(x[k].context,f,l);break;case 4:x[k].fn.call(x[k].context,f,l,d);break;default:if(!M)for(A=1,M=new Array(v-1);A<v;A++)M[A-1]=arguments[A];x[k].fn.apply(x[k].context,M)}}return!0},a.prototype.on=function(u,f,l){return i(this,u,f,l,!1)},a.prototype.once=function(u,f,l){return i(this,u,f,l,!0)},a.prototype.removeListener=function(u,f,l,d){var h=n?n+u:u;if(!this._events[h])return this;if(!f)return o(this,h),this;var g=this._events[h];if(g.fn)g.fn===f&&(!d||g.once)&&(!l||g.context===l)&&o(this,h);else{for(var w=0,x=[],v=g.length;w<v;w++)(g[w].fn!==f||d&&!g[w].once||l&&g[w].context!==l)&&x.push(g[w]);x.length?this._events[h]=x.length===1?x[0]:x:o(this,h)}return this},a.prototype.removeAllListeners=function(u){var f;return u?(f=n?n+u:u,this._events[f]&&o(this,f)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,t.exports=a}(qr)),qr.exports}var df=ff();const un=Sr(df);function hf(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global}function gf(){const t=hf();if(t.__xstate__)return t.__xstate__}const _f=t=>{if(typeof window>"u")return;const e=gf();e&&e.register(t)};class Pi{constructor(e){this._process=e,this._active=!1,this._current=null,this._last=null}start(){this._active=!0,this.flush()}clear(){this._current&&(this._current.next=null,this._last=this._current)}enqueue(e){const n={value:e,next:null};if(this._current){this._last.next=n,this._last=n;return}this._current=n,this._last=n,this._active&&this.flush()}flush(){for(;this._current;){const e=this._current;this._process(e.value),this._current=e.next}this._last=null}}const Go=".",pf="",Ko="",yf="#",wf="*",Xo="xstate.init",ms="xstate.stop";function mf(t,e){return{type:`xstate.after.${t}.${e}`}}function bs(t,e){return{type:`xstate.done.state.${t}`,output:e}}function bf(t,e){return{type:`xstate.done.actor.${t}`,output:e,actorId:t}}function vf(t,e){return{type:`xstate.error.actor.${t}`,error:e,actorId:t}}function Jo(t){return{type:Xo,input:t}}function ct(t){setTimeout(()=>{throw t})}const xf=typeof Symbol=="function"&&Symbol.observable||"@@observable";function Yo(t,e){const n=Di(t),r=Di(e);return typeof r=="string"?typeof n=="string"?r===n:!1:typeof n=="string"?n in r:Object.keys(n).every(s=>s in r?Yo(n[s],r[s]):!1)}function Ys(t){if(Qo(t))return t;const e=[];let n="";for(let r=0;r<t.length;r++){switch(t.charCodeAt(r)){case 92:n+=t[r+1],r++;continue;case 46:e.push(n),n="";continue}n+=t[r]}return e.push(n),e}function Di(t){if(nd(t))return t.value;if(typeof t!="string")return t;const e=Ys(t);return Sf(e)}function Sf(t){if(t.length===1)return t[0];const e={};let n=e;for(let r=0;r<t.length-1;r++)if(r===t.length-2)n[t[r]]=t[r+1];else{const s=n;n={},s[t[r]]=n}return e}function $i(t,e){const n={},r=Object.keys(t);for(let s=0;s<r.length;s++){const i=r[s];n[i]=e(t[i],i,t,s)}return n}function Zo(t){return Qo(t)?t:[t]}function wt(t){return t===void 0?[]:Zo(t)}function vs(t,e,n,r){return typeof t=="function"?t({context:e,event:n,self:r}):t}function Qo(t){return Array.isArray(t)}function Ef(t){return t.type.startsWith("xstate.error.actor")}function zt(t){return Zo(t).map(e=>typeof e>"u"||typeof e=="string"?{target:e}:e)}function ea(t){if(!(t===void 0||t===pf))return wt(t)}function xs(t,e,n){const r=typeof t=="object",s=r?t:void 0;return{next:(r?t.next:t)?.bind(s),error:(r?t.error:e)?.bind(s),complete:(r?t.complete:n)?.bind(s)}}function Bi(t,e){return`${e}.${t}`}function Zs(t,e){const n=e.match(/^xstate\.invoke\.(\d+)\.(.*)/);if(!n)return t.implementations.actors[e];const[,r,s]=n,o=t.getStateNodeById(s).config.invoke;return(Array.isArray(o)?o[r]:o).src}function ji(t,e){return`${t.sessionId}.${e}`}let kf=0;function Af(t,e){const n=new Map,r=new Map,s=new WeakMap,i=new Set,o={},{clock:a,logger:c}=e,u={schedule:(d,h,g,w,x=Math.random().toString(36).slice(2))=>{const v={source:d,target:h,event:g,delay:w,id:x,startedAt:Date.now()},M=ji(d,x);l._snapshot._scheduledEvents[M]=v;const k=a.setTimeout(()=>{delete o[M],delete l._snapshot._scheduledEvents[M],l._relay(d,h,g)},w);o[M]=k},cancel:(d,h)=>{const g=ji(d,h),w=o[g];delete o[g],delete l._snapshot._scheduledEvents[g],w!==void 0&&a.clearTimeout(w)},cancelAll:d=>{for(const h in l._snapshot._scheduledEvents){const g=l._snapshot._scheduledEvents[h];g.source===d&&u.cancel(d,g.id)}}},f=d=>{if(!i.size)return;const h={...d,rootId:t.sessionId};i.forEach(g=>g.next?.(h))},l={_snapshot:{_scheduledEvents:(e?.snapshot&&e.snapshot.scheduler)??{}},_bookId:()=>`x:${kf++}`,_register:(d,h)=>(n.set(d,h),d),_unregister:d=>{n.delete(d.sessionId);const h=s.get(d);h!==void 0&&(r.delete(h),s.delete(d))},get:d=>r.get(d),_set:(d,h)=>{const g=r.get(d);if(g&&g!==h)throw new Error(`Actor with system ID '${d}' already exists.`);r.set(d,h),s.set(h,d)},inspect:d=>{const h=xs(d);return i.add(h),{unsubscribe(){i.delete(h)}}},_sendInspectionEvent:f,_relay:(d,h,g)=>{l._sendInspectionEvent({type:"@xstate.event",sourceRef:d,actorRef:h,event:g}),h._send(g)},scheduler:u,getSnapshot:()=>({_scheduledEvents:{...l._snapshot._scheduledEvents}}),start:()=>{const d=l._snapshot._scheduledEvents;l._snapshot._scheduledEvents={};for(const h in d){const{source:g,target:w,event:x,delay:v,id:M}=d[h];u.schedule(g,w,x,v,M)}},_clock:a,_logger:c};return l}let Vr=!1;const Qs=1;let $e=function(t){return t[t.NotStarted=0]="NotStarted",t[t.Running=1]="Running",t[t.Stopped=2]="Stopped",t}({});const Cf={clock:{setTimeout:(t,e)=>setTimeout(t,e),clearTimeout:t=>clearTimeout(t)},logger:console.log.bind(console),devTools:!1};class Tf{constructor(e,n){this.logic=e,this._snapshot=void 0,this.clock=void 0,this.options=void 0,this.id=void 0,this.mailbox=new Pi(this._process.bind(this)),this.observers=new Set,this.eventListeners=new Map,this.logger=void 0,this._processingStatus=$e.NotStarted,this._parent=void 0,this._syncSnapshot=void 0,this.ref=void 0,this._actorScope=void 0,this._systemId=void 0,this.sessionId=void 0,this.system=void 0,this._doneEvent=void 0,this.src=void 0,this._deferred=[];const r={...Cf,...n},{clock:s,logger:i,parent:o,syncSnapshot:a,id:c,systemId:u,inspect:f}=r;this.system=o?o.system:Af(this,{clock:s,logger:i}),f&&!o&&this.system.inspect(xs(f)),this.sessionId=this.system._bookId(),this.id=c??this.sessionId,this.logger=n?.logger??this.system._logger,this.clock=n?.clock??this.system._clock,this._parent=o,this._syncSnapshot=a,this.options=r,this.src=r.src??e,this.ref=this,this._actorScope={self:this,id:this.id,sessionId:this.sessionId,logger:this.logger,defer:l=>{this._deferred.push(l)},system:this.system,stopChild:l=>{if(l._parent!==this)throw new Error(`Cannot stop child actor ${l.id} of ${this.id} because it is not a child`);l._stop()},emit:l=>{const d=this.eventListeners.get(l.type),h=this.eventListeners.get("*");if(!d&&!h)return;const g=[...d?d.values():[],...h?h.values():[]];for(const w of g)w(l)},actionExecutor:l=>{const d=()=>{if(this._actorScope.system._sendInspectionEvent({type:"@xstate.action",actorRef:this,action:{type:l.type,params:l.params}}),!l.exec)return;const h=Vr;try{Vr=!0,l.exec(l.info,l.params)}finally{Vr=h}};this._processingStatus===$e.Running?d():this._deferred.push(d)}},this.send=this.send.bind(this),this.system._sendInspectionEvent({type:"@xstate.actor",actorRef:this}),u&&(this._systemId=u,this.system._set(u,this)),this._initState(n?.snapshot??n?.state),u&&this._snapshot.status!=="active"&&this.system._unregister(this)}_initState(e){try{this._snapshot=e?this.logic.restoreSnapshot?this.logic.restoreSnapshot(e,this._actorScope):e:this.logic.getInitialSnapshot(this._actorScope,this.options?.input)}catch(n){this._snapshot={status:"error",output:void 0,error:n}}}update(e,n){this._snapshot=e;let r;for(;r=this._deferred.shift();)try{r()}catch(s){this._deferred.length=0,this._snapshot={...e,status:"error",error:s}}switch(this._snapshot.status){case"active":for(const s of this.observers)try{s.next?.(e)}catch(i){ct(i)}break;case"done":for(const s of this.observers)try{s.next?.(e)}catch(i){ct(i)}this._stopProcedure(),this._complete(),this._doneEvent=bf(this.id,this._snapshot.output),this._parent&&this.system._relay(this,this._parent,this._doneEvent);break;case"error":this._error(this._snapshot.error);break}this.system._sendInspectionEvent({type:"@xstate.snapshot",actorRef:this,event:n,snapshot:e})}subscribe(e,n,r){const s=xs(e,n,r);if(this._processingStatus!==$e.Stopped)this.observers.add(s);else switch(this._snapshot.status){case"done":try{s.complete?.()}catch(i){ct(i)}break;case"error":{const i=this._snapshot.error;if(!s.error)ct(i);else try{s.error(i)}catch(o){ct(o)}break}}return{unsubscribe:()=>{this.observers.delete(s)}}}on(e,n){let r=this.eventListeners.get(e);r||(r=new Set,this.eventListeners.set(e,r));const s=n.bind(void 0);return r.add(s),{unsubscribe:()=>{r.delete(s)}}}start(){if(this._processingStatus===$e.Running)return this;this._syncSnapshot&&this.subscribe({next:r=>{r.status==="active"&&this.system._relay(this,this._parent,{type:`xstate.snapshot.${this.id}`,snapshot:r})},error:()=>{}}),this.system._register(this.sessionId,this),this._systemId&&this.system._set(this._systemId,this),this._processingStatus=$e.Running;const e=Jo(this.options.input);switch(this.system._sendInspectionEvent({type:"@xstate.event",sourceRef:this._parent,actorRef:this,event:e}),this._snapshot.status){case"done":return this.update(this._snapshot,e),this;case"error":return this._error(this._snapshot.error),this}if(this._parent||this.system.start(),this.logic.start)try{this.logic.start(this._snapshot,this._actorScope)}catch(r){return this._snapshot={...this._snapshot,status:"error",error:r},this._error(r),this}return this.update(this._snapshot,e),this.options.devTools&&this.attachDevTools(),this.mailbox.start(),this}_process(e){let n,r;try{n=this.logic.transition(this._snapshot,e,this._actorScope)}catch(s){r={err:s}}if(r){const{err:s}=r;this._snapshot={...this._snapshot,status:"error",error:s},this._error(s);return}this.update(n,e),e.type===ms&&(this._stopProcedure(),this._complete())}_stop(){return this._processingStatus===$e.Stopped?this:(this.mailbox.clear(),this._processingStatus===$e.NotStarted?(this._processingStatus=$e.Stopped,this):(this.mailbox.enqueue({type:ms}),this))}stop(){if(this._parent)throw new Error("A non-root actor cannot be stopped directly.");return this._stop()}_complete(){for(const e of this.observers)try{e.complete?.()}catch(n){ct(n)}this.observers.clear()}_reportError(e){if(!this.observers.size){this._parent||ct(e);return}let n=!1;for(const r of this.observers){const s=r.error;n||=!s;try{s?.(e)}catch(i){ct(i)}}this.observers.clear(),n&&ct(e)}_error(e){this._stopProcedure(),this._reportError(e),this._parent&&this.system._relay(this,this._parent,vf(this.id,e))}_stopProcedure(){return this._processingStatus!==$e.Running?this:(this.system.scheduler.cancelAll(this),this.mailbox.clear(),this.mailbox=new Pi(this._process.bind(this)),this._processingStatus=$e.Stopped,this.system._unregister(this),this)}_send(e){this._processingStatus!==$e.Stopped&&this.mailbox.enqueue(e)}send(e){this.system._relay(void 0,this,e)}attachDevTools(){const{devTools:e}=this.options;e&&(typeof e=="function"?e:_f)(this)}toJSON(){return{xstate$$type:Qs,id:this.id}}getPersistedSnapshot(e){return this.logic.getPersistedSnapshot(this._snapshot,e)}[xf](){return this}getSnapshot(){return this._snapshot}}function Sn(t,...[e]){return new Tf(t,e)}function If(t,e,n,r,{sendId:s}){const i=typeof s=="function"?s(n,r):s;return[e,{sendId:i},void 0]}function Mf(t,e){t.defer(()=>{t.system.scheduler.cancel(t.self,e.sendId)})}function Of(t){function e(n,r){}return e.type="xstate.cancel",e.sendId=t,e.resolve=If,e.execute=Mf,e}function Rf(t,e,n,r,{id:s,systemId:i,src:o,input:a,syncSnapshot:c}){const u=typeof o=="string"?Zs(e.machine,o):o,f=typeof s=="function"?s(n):s;let l,d;return u&&(d=typeof a=="function"?a({context:e.context,event:n.event,self:t.self}):a,l=Sn(u,{id:f,src:o,parent:t.self,syncSnapshot:c,systemId:i,input:d})),[Ut(e,{children:{...e.children,[f]:l}}),{id:s,systemId:i,actorRef:l,src:o,input:d},void 0]}function Pf(t,{actorRef:e}){e&&t.defer(()=>{e._processingStatus!==$e.Stopped&&e.start()})}function Df(...[t,{id:e,systemId:n,input:r,syncSnapshot:s=!1}={}]){function i(o,a){}return i.type="xstate.spawnChild",i.id=e,i.systemId=n,i.src=t,i.input=r,i.syncSnapshot=s,i.resolve=Rf,i.execute=Pf,i}function $f(t,e,n,r,{actorRef:s}){const i=typeof s=="function"?s(n,r):s,o=typeof i=="string"?e.children[i]:i;let a=e.children;return o&&(a={...a},delete a[o.id]),[Ut(e,{children:a}),o,void 0]}function Bf(t,e){if(e){if(t.system._unregister(e),e._processingStatus!==$e.Running){t.stopChild(e);return}t.defer(()=>{t.stopChild(e)})}}function ta(t){function e(n,r){}return e.type="xstate.stopChild",e.actorRef=t,e.resolve=$f,e.execute=Bf,e}function ei(t,e,n,r){const{machine:s}=r,i=typeof t=="function",o=i?t:s.implementations.guards[typeof t=="string"?t:t.type];if(!i&&!o)throw new Error(`Guard '${typeof t=="string"?t:t.type}' is not implemented.'.`);if(typeof o!="function")return ei(o,e,n,r);const a={context:e,event:n},c=i||typeof t=="string"?void 0:"params"in t?typeof t.params=="function"?t.params({context:e,event:n}):t.params:void 0;return"check"in o?o.check(r,a,o):o(a,c)}const ti=t=>t.type==="atomic"||t.type==="final";function nn(t){return Object.values(t.states).filter(e=>e.type!=="history")}function Pn(t,e){const n=[];if(e===t)return n;let r=t.parent;for(;r&&r!==e;)n.push(r),r=r.parent;return n}function dr(t){const e=new Set(t),n=ra(e);for(const r of e)if(r.type==="compound"&&(!n.get(r)||!n.get(r).length))Li(r).forEach(s=>e.add(s));else if(r.type==="parallel"){for(const s of nn(r))if(s.type!=="history"&&!e.has(s)){const i=Li(s);for(const o of i)e.add(o)}}for(const r of e){let s=r.parent;for(;s;)e.add(s),s=s.parent}return e}function na(t,e){const n=e.get(t);if(!n)return{};if(t.type==="compound"){const s=n[0];if(s){if(ti(s))return s.key}else return{}}const r={};for(const s of n)r[s.key]=na(s,e);return r}function ra(t){const e=new Map;for(const n of t)e.has(n)||e.set(n,[]),n.parent&&(e.has(n.parent)||e.set(n.parent,[]),e.get(n.parent).push(n));return e}function sa(t,e){const n=dr(e);return na(t,ra(n))}function ni(t,e){return e.type==="compound"?nn(e).some(n=>n.type==="final"&&t.has(n)):e.type==="parallel"?nn(e).every(n=>ni(t,n)):e.type==="final"}const Or=t=>t[0]===yf;function jf(t,e){return t.transitions.get(e)||[...t.transitions.keys()].filter(r=>{if(r===wf)return!0;if(!r.endsWith(".*"))return!1;const s=r.split("."),i=e.split(".");for(let o=0;o<s.length;o++){const a=s[o],c=i[o];if(a==="*")return o===s.length-1;if(a!==c)return!1}return!0}).sort((r,s)=>s.length-r.length).flatMap(r=>t.transitions.get(r))}function Lf(t){const e=t.config.after;if(!e)return[];const n=s=>{const i=mf(s,t.id),o=i.type;return t.entry.push(fd(i,{id:o,delay:s})),t.exit.push(Of(o)),o};return Object.keys(e).flatMap(s=>{const i=e[s],o=typeof i=="string"?{target:i}:i,a=Number.isNaN(+s)?s:+s,c=n(a);return wt(o).map(u=>({...u,event:c,delay:a}))}).map(s=>{const{delay:i}=s;return{...Rt(t,s.event,s),delay:i}})}function Rt(t,e,n){const r=ea(n.target),s=n.reenter??!1,i=Hf(t,r),o={...n,actions:wt(n.actions),guard:n.guard,target:i,source:t,reenter:s,eventType:e,toJSON:()=>({...o,source:`#${t.id}`,target:i?i.map(a=>`#${a.id}`):void 0})};return o}function Uf(t){const e=new Map;if(t.config.on)for(const n of Object.keys(t.config.on)){if(n===Ko)throw new Error('Null events ("") cannot be specified as a transition key. Use `always: { ... }` instead.');const r=t.config.on[n];e.set(n,zt(r).map(s=>Rt(t,n,s)))}if(t.config.onDone){const n=`xstate.done.state.${t.id}`;e.set(n,zt(t.config.onDone).map(r=>Rt(t,n,r)))}for(const n of t.invoke){if(n.onDone){const r=`xstate.done.actor.${n.id}`;e.set(r,zt(n.onDone).map(s=>Rt(t,r,s)))}if(n.onError){const r=`xstate.error.actor.${n.id}`;e.set(r,zt(n.onError).map(s=>Rt(t,r,s)))}if(n.onSnapshot){const r=`xstate.snapshot.${n.id}`;e.set(r,zt(n.onSnapshot).map(s=>Rt(t,r,s)))}}for(const n of t.after){let r=e.get(n.eventType);r||(r=[],e.set(n.eventType,r)),r.push(n)}return e}function Nf(t,e){const n=typeof e=="string"?t.states[e]:e?t.states[e.target]:void 0;if(!n&&e)throw new Error(`Initial state node "${e}" not found on parent state node #${t.id}`);const r={source:t,actions:!e||typeof e=="string"?[]:wt(e.actions),eventType:null,reenter:!1,target:n?[n]:[],toJSON:()=>({...r,source:`#${t.id}`,target:n?[`#${n.id}`]:[]})};return r}function Hf(t,e){if(e!==void 0)return e.map(n=>{if(typeof n!="string")return n;if(Or(n))return t.machine.getStateNodeById(n);const r=n[0]===Go;if(r&&!t.parent)return hr(t,n.slice(1));const s=r?t.key+n:n;if(t.parent)try{return hr(t.parent,s)}catch(i){throw new Error(`Invalid transition definition for state node '${t.id}':
${i.message}`)}else throw new Error(`Invalid target: "${n}" is not a valid target from the root node. Did you mean ".${n}"?`)})}function ia(t){const e=ea(t.config.target);return e?{target:e.map(n=>typeof n=="string"?hr(t.parent,n):n)}:t.parent.initial}function Dt(t){return t.type==="history"}function Li(t){const e=oa(t);for(const n of e)for(const r of Pn(n,t))e.add(r);return e}function oa(t){const e=new Set;function n(r){if(!e.has(r)){if(e.add(r),r.type==="compound")n(r.initial.target[0]);else if(r.type==="parallel")for(const s of nn(r))n(s)}}return n(t),e}function rn(t,e){if(Or(e))return t.machine.getStateNodeById(e);if(!t.states)throw new Error(`Unable to retrieve child state '${e}' from '${t.id}'; no child states exist.`);const n=t.states[e];if(!n)throw new Error(`Child state '${e}' does not exist on '${t.id}'`);return n}function hr(t,e){if(typeof e=="string"&&Or(e))try{return t.machine.getStateNodeById(e)}catch{}const n=Ys(e).slice();let r=t;for(;n.length;){const s=n.shift();if(!s.length)break;r=rn(r,s)}return r}function gr(t,e){if(typeof e=="string"){const s=t.states[e];if(!s)throw new Error(`State '${e}' does not exist on '${t.id}'`);return[t,s]}const n=Object.keys(e),r=n.map(s=>rn(t,s)).filter(Boolean);return[t.machine.root,t].concat(r,n.reduce((s,i)=>{const o=rn(t,i);if(!o)return s;const a=gr(o,e[i]);return s.concat(a)},[]))}function Ff(t,e,n,r){const i=rn(t,e).next(n,r);return!i||!i.length?t.next(n,r):i}function qf(t,e,n,r){const s=Object.keys(e),i=rn(t,s[0]),o=ri(i,e[s[0]],n,r);return!o||!o.length?t.next(n,r):o}function Vf(t,e,n,r){const s=[];for(const i of Object.keys(e)){const o=e[i];if(!o)continue;const a=rn(t,i),c=ri(a,o,n,r);c&&s.push(...c)}return s.length?s:t.next(n,r)}function ri(t,e,n,r){return typeof e=="string"?Ff(t,e,n,r):Object.keys(e).length===1?qf(t,e,n,r):Vf(t,e,n,r)}function zf(t){return Object.keys(t.states).map(e=>t.states[e]).filter(e=>e.type==="history")}function Ct(t,e){let n=t;for(;n.parent&&n.parent!==e;)n=n.parent;return n.parent===e}function Wf(t,e){const n=new Set(t),r=new Set(e);for(const s of n)if(r.has(s))return!0;for(const s of r)if(n.has(s))return!0;return!1}function aa(t,e,n){const r=new Set;for(const s of t){let i=!1;const o=new Set;for(const a of r)if(Wf(Ss([s],e,n),Ss([a],e,n)))if(Ct(s.source,a.source))o.add(a);else{i=!0;break}if(!i){for(const a of o)r.delete(a);r.add(s)}}return Array.from(r)}function Gf(t){const[e,...n]=t;for(const r of Pn(e,void 0))if(n.every(s=>Ct(s,r)))return r}function si(t,e){if(!t.target)return[];const n=new Set;for(const r of t.target)if(Dt(r))if(e[r.id])for(const s of e[r.id])n.add(s);else for(const s of si(ia(r),e))n.add(s);else n.add(r);return[...n]}function ca(t,e){const n=si(t,e);if(!n)return;if(!t.reenter&&n.every(s=>s===t.source||Ct(s,t.source)))return t.source;const r=Gf(n.concat(t.source));if(r)return r;if(!t.reenter)return t.source.machine.root}function Ss(t,e,n){const r=new Set;for(const s of t)if(s.target?.length){const i=ca(s,n);s.reenter&&s.source===i&&r.add(i);for(const o of e)Ct(o,i)&&r.add(o)}return[...r]}function Kf(t,e){if(t.length!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;return!0}function Es(t,e,n,r,s,i){if(!t.length)return e;const o=new Set(e._nodes);let a=e.historyValue;const c=aa(t,o,a);let u=e;s||([u,a]=Zf(u,r,n,c,o,a,i,n.actionExecutor)),u=sn(u,r,n,c.flatMap(l=>l.actions),i,void 0),u=Jf(u,r,n,c,o,i,a,s);const f=[...o];u.status==="done"&&(u=sn(u,r,n,f.sort((l,d)=>d.order-l.order).flatMap(l=>l.exit),i,void 0));try{return a===e.historyValue&&Kf(e._nodes,o)?u:Ut(u,{_nodes:f,historyValue:a})}catch(l){throw l}}function Xf(t,e,n,r,s){if(r.output===void 0)return;const i=bs(s.id,s.output!==void 0&&s.parent?vs(s.output,t.context,e,n.self):void 0);return vs(r.output,t.context,i,n.self)}function Jf(t,e,n,r,s,i,o,a){let c=t;const u=new Set,f=new Set;Yf(r,o,f,u),a&&f.add(t.machine.root);const l=new Set;for(const d of[...u].sort((h,g)=>h.order-g.order)){s.add(d);const h=[];h.push(...d.entry);for(const g of d.invoke)h.push(Df(g.src,{...g,syncSnapshot:!!g.onSnapshot}));if(f.has(d)){const g=d.initial.actions;h.push(...g)}if(c=sn(c,e,n,h,i,d.invoke.map(g=>g.id)),d.type==="final"){const g=d.parent;let w=g?.type==="parallel"?g:g?.parent,x=w||d;for(g?.type==="compound"&&i.push(bs(g.id,d.output!==void 0?vs(d.output,c.context,e,n.self):void 0));w?.type==="parallel"&&!l.has(w)&&ni(s,w);)l.add(w),i.push(bs(w.id)),x=w,w=w.parent;if(w)continue;c=Ut(c,{status:"done",output:Xf(c,e,n,c.machine.root,x)})}}return c}function Yf(t,e,n,r){for(const s of t){const i=ca(s,e);for(const a of s.target||[])!Dt(a)&&(s.source!==a||s.source!==i||s.reenter)&&(r.add(a),n.add(a)),Kt(a,e,n,r);const o=si(s,e);for(const a of o){const c=Pn(a,i);i?.type==="parallel"&&c.push(i),ua(r,e,n,c,!s.source.parent&&s.reenter?void 0:i)}}}function Kt(t,e,n,r){if(Dt(t))if(e[t.id]){const s=e[t.id];for(const i of s)r.add(i),Kt(i,e,n,r);for(const i of s)zr(i,t.parent,r,e,n)}else{const s=ia(t);for(const i of s.target)r.add(i),s===t.parent?.initial&&n.add(t.parent),Kt(i,e,n,r);for(const i of s.target)zr(i,t.parent,r,e,n)}else if(t.type==="compound"){const[s]=t.initial.target;Dt(s)||(r.add(s),n.add(s)),Kt(s,e,n,r),zr(s,t,r,e,n)}else if(t.type==="parallel")for(const s of nn(t).filter(i=>!Dt(i)))[...r].some(i=>Ct(i,s))||(Dt(s)||(r.add(s),n.add(s)),Kt(s,e,n,r))}function ua(t,e,n,r,s){for(const i of r)if((!s||Ct(i,s))&&t.add(i),i.type==="parallel")for(const o of nn(i).filter(a=>!Dt(a)))[...t].some(a=>Ct(a,o))||(t.add(o),Kt(o,e,n,t))}function zr(t,e,n,r,s){ua(n,r,s,Pn(t,e))}function Zf(t,e,n,r,s,i,o,a){let c=t;const u=Ss(r,s,i);u.sort((l,d)=>d.order-l.order);let f;for(const l of u)for(const d of zf(l)){let h;d.history==="deep"?h=g=>ti(g)&&Ct(g,l):h=g=>g.parent===l,f??={...i},f[d.id]=Array.from(s).filter(h)}for(const l of u)c=sn(c,e,n,[...l.exit,...l.invoke.map(d=>ta(d.id))],o,void 0),s.delete(l);return[c,f||i]}function Qf(t,e){return t.implementations.actions[e]}function la(t,e,n,r,s,i){const{machine:o}=t;let a=t;for(const c of r){const u=typeof c=="function",f=u?c:Qf(o,typeof c=="string"?c:c.type),l={context:a.context,event:e,self:n.self,system:n.system},d=u||typeof c=="string"?void 0:"params"in c?typeof c.params=="function"?c.params({context:a.context,event:e}):c.params:void 0;if(!f||!("resolve"in f)){n.actionExecutor({type:typeof c=="string"?c:typeof c=="object"?c.type:c.name||"(anonymous)",info:l,params:d,exec:f});continue}const h=f,[g,w,x]=h.resolve(n,a,l,d,f,s);a=g,"retryResolve"in h&&i?.push([h,w]),"execute"in h&&n.actionExecutor({type:h.type,info:l,params:w,exec:h.execute.bind(null,n,w)}),x&&(a=la(a,e,n,x,s,i))}return a}function sn(t,e,n,r,s,i){const o=i?[]:void 0,a=la(t,e,n,r,{internalQueue:s,deferredActorIds:i},o);return o?.forEach(([c,u])=>{c.retryResolve(n,a,u)}),a}function Wr(t,e,n,r){let s=t;const i=[];function o(u,f,l){n.system._sendInspectionEvent({type:"@xstate.microstep",actorRef:n.self,event:f,snapshot:u,_transitions:l}),i.push(u)}if(e.type===ms)return s=Ut(Ui(s,e,n),{status:"stopped"}),o(s,e,[]),{snapshot:s,microstates:i};let a=e;if(a.type!==Xo){const u=a,f=Ef(u),l=Ni(u,s);if(f&&!l.length)return s=Ut(t,{status:"error",error:u.error}),o(s,u,[]),{snapshot:s,microstates:i};s=Es(l,t,n,a,!1,r),o(s,u,l)}let c=!0;for(;s.status==="active";){let u=c?ed(s,a):[];const f=u.length?s:void 0;if(!u.length){if(!r.length)break;a=r.shift(),u=Ni(a,s)}s=Es(u,s,n,a,!1,r),c=s!==f,o(s,a,u)}return s.status!=="active"&&Ui(s,a,n),{snapshot:s,microstates:i}}function Ui(t,e,n){return sn(t,e,n,Object.values(t.children).map(r=>ta(r)),[],void 0)}function Ni(t,e){return e.machine.getTransitionData(e,t)}function ed(t,e){const n=new Set,r=t._nodes.filter(ti);for(const s of r)e:for(const i of[s].concat(Pn(s,void 0)))if(i.always){for(const o of i.always)if(o.guard===void 0||ei(o.guard,t.context,e,t)){n.add(o);break e}}return aa(Array.from(n),new Set(t._nodes),t.historyValue)}function td(t,e){const n=dr(gr(t,e));return sa(t,[...n])}function nd(t){return!!t&&typeof t=="object"&&"machine"in t&&"value"in t}const rd=function(e){return Yo(e,this.value)},sd=function(e){return this.tags.has(e)},id=function(e){const n=this.machine.getTransitionData(this,e);return!!n?.length&&n.some(r=>r.target!==void 0||r.actions.length)},od=function(){const{_nodes:e,tags:n,machine:r,getMeta:s,toJSON:i,can:o,hasTag:a,matches:c,...u}=this;return{...u,tags:Array.from(n)}},ad=function(){return this._nodes.reduce((e,n)=>(n.meta!==void 0&&(e[n.id]=n.meta),e),{})};function Xn(t,e){return{status:t.status,output:t.output,error:t.error,machine:e,context:t.context,_nodes:t._nodes,value:sa(e.root,t._nodes),tags:new Set(t._nodes.flatMap(n=>n.tags)),children:t.children,historyValue:t.historyValue||{},matches:rd,hasTag:sd,can:id,getMeta:ad,toJSON:od}}function Ut(t,e={}){return Xn({...t,...e},t.machine)}function cd(t,e){const{_nodes:n,tags:r,machine:s,children:i,context:o,can:a,hasTag:c,matches:u,getMeta:f,toJSON:l,...d}=t,h={};for(const w in i){const x=i[w];h[w]={snapshot:x.getPersistedSnapshot(e),src:x.src,systemId:x._systemId,syncSnapshot:x._syncSnapshot}}return{...d,context:fa(o),children:h}}function fa(t){let e;for(const n in t){const r=t[n];if(r&&typeof r=="object")if("sessionId"in r&&"send"in r&&"ref"in r)e??=Array.isArray(t)?t.slice():{...t},e[n]={xstate$$type:Qs,id:r.id};else{const s=fa(r);s!==r&&(e??=Array.isArray(t)?t.slice():{...t},e[n]=s)}}return e??t}function ud(t,e,n,r,{event:s,id:i,delay:o},{internalQueue:a}){const c=e.machine.implementations.delays;if(typeof s=="string")throw new Error(`Only event objects may be used with raise; use raise({ type: "${s}" }) instead`);const u=typeof s=="function"?s(n,r):s;let f;if(typeof o=="string"){const l=c&&c[o];f=typeof l=="function"?l(n,r):l}else f=typeof o=="function"?o(n,r):o;return typeof f!="number"&&a.push(u),[e,{event:u,id:i,delay:f},void 0]}function ld(t,e){const{event:n,delay:r,id:s}=e;if(typeof r=="number"){t.defer(()=>{const i=t.self;t.system.scheduler.schedule(i,i,n,r,s)});return}}function fd(t,e){function n(r,s){}return n.type="xstate.raise",n.event=t,n.id=e?.id,n.delay=e?.delay,n.resolve=ud,n.execute=ld,n}function dd(t,{machine:e,context:n},r,s){const i=(o,a)=>{if(typeof o=="string"){const c=Zs(e,o);if(!c)throw new Error(`Actor logic '${o}' not implemented in machine '${e.id}'`);const u=Sn(c,{id:a?.id,parent:t.self,syncSnapshot:a?.syncSnapshot,input:typeof a?.input=="function"?a.input({context:n,event:r,self:t.self}):a?.input,src:o,systemId:a?.systemId});return s[u.id]=u,u}else return Sn(o,{id:a?.id,parent:t.self,syncSnapshot:a?.syncSnapshot,input:a?.input,src:o,systemId:a?.systemId})};return(o,a)=>{const c=i(o,a);return s[c.id]=c,t.defer(()=>{c._processingStatus!==$e.Stopped&&c.start()}),c}}function hd(t,e,n,r,{assignment:s}){if(!e.context)throw new Error("Cannot assign to undefined `context`. Ensure that `context` is defined in the machine config.");const i={},o={context:e.context,event:n.event,spawn:dd(t,e,n.event,i),self:t.self,system:t.system};let a={};if(typeof s=="function")a=s(o,r);else for(const u of Object.keys(s)){const f=s[u];a[u]=typeof f=="function"?f(o,r):f}const c=Object.assign({},e.context,a);return[Ut(e,{context:c,children:Object.keys(i).length?{...e.children,...i}:e.children}),void 0,void 0]}function ks(t){function e(n,r){}return e.type="xstate.assign",e.assignment=t,e.resolve=hd,e}function gd(t,e){const n=wt(e);if(!n.includes(t.type)){const r=n.length===1?`type "${n[0]}"`:`one of types "${n.join('", "')}"`;throw new Error(`Expected event ${JSON.stringify(t)} to have ${r}`)}}const Hi=new WeakMap;function Ft(t,e,n){let r=Hi.get(t);return r?e in r||(r[e]=n()):(r={[e]:n()},Hi.set(t,r)),r[e]}const _d={},hn=t=>typeof t=="string"?{type:t}:typeof t=="function"?"resolve"in t?{type:t.type}:{type:t.name}:t;class ii{constructor(e,n){if(this.config=e,this.key=void 0,this.id=void 0,this.type=void 0,this.path=void 0,this.states=void 0,this.history=void 0,this.entry=void 0,this.exit=void 0,this.parent=void 0,this.machine=void 0,this.meta=void 0,this.output=void 0,this.order=-1,this.description=void 0,this.tags=[],this.transitions=void 0,this.always=void 0,this.parent=n._parent,this.key=n._key,this.machine=n._machine,this.path=this.parent?this.parent.path.concat(this.key):[],this.id=this.config.id||[this.machine.id,...this.path].join(Go),this.type=this.config.type||(this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.description=this.config.description,this.order=this.machine.idMap.size,this.machine.idMap.set(this.id,this),this.states=this.config.states?$i(this.config.states,(r,s)=>new ii(r,{_parent:this,_key:s,_machine:this.machine})):_d,this.type==="compound"&&!this.config.initial)throw new Error(`No initial state specified for compound state node "#${this.id}". Try adding { initial: "${Object.keys(this.states)[0]}" } to the state config.`);this.history=this.config.history===!0?"shallow":this.config.history||!1,this.entry=wt(this.config.entry).slice(),this.exit=wt(this.config.exit).slice(),this.meta=this.config.meta,this.output=this.type==="final"||!this.parent?this.config.output:void 0,this.tags=wt(e.tags).slice()}_initialize(){this.transitions=Uf(this),this.config.always&&(this.always=zt(this.config.always).map(e=>Rt(this,Ko,e))),Object.keys(this.states).forEach(e=>{this.states[e]._initialize()})}get definition(){return{id:this.id,key:this.key,version:this.machine.version,type:this.type,initial:this.initial?{target:this.initial.target,source:this,actions:this.initial.actions.map(hn),eventType:null,reenter:!1,toJSON:()=>({target:this.initial.target.map(e=>`#${e.id}`),source:`#${this.id}`,actions:this.initial.actions.map(hn),eventType:null})}:void 0,history:this.history,states:$i(this.states,e=>e.definition),on:this.on,transitions:[...this.transitions.values()].flat().map(e=>({...e,actions:e.actions.map(hn)})),entry:this.entry.map(hn),exit:this.exit.map(hn),meta:this.meta,order:this.order||-1,output:this.output,invoke:this.invoke,description:this.description,tags:this.tags}}toJSON(){return this.definition}get invoke(){return Ft(this,"invoke",()=>wt(this.config.invoke).map((e,n)=>{const{src:r,systemId:s}=e,i=e.id??Bi(this.id,n),o=typeof r=="string"?r:`xstate.invoke.${Bi(this.id,n)}`;return{...e,src:o,id:i,systemId:s,toJSON(){const{onDone:a,onError:c,...u}=e;return{...u,type:"xstate.invoke",src:o,id:i}}}}))}get on(){return Ft(this,"on",()=>[...this.transitions].flatMap(([n,r])=>r.map(s=>[n,s])).reduce((n,[r,s])=>(n[r]=n[r]||[],n[r].push(s),n),{}))}get after(){return Ft(this,"delayedTransitions",()=>Lf(this))}get initial(){return Ft(this,"initial",()=>Nf(this,this.config.initial))}next(e,n){const r=n.type,s=[];let i;const o=Ft(this,`candidates-${r}`,()=>jf(this,r));for(const a of o){const{guard:c}=a,u=e.context;let f=!1;try{f=!c||ei(c,u,n,e)}catch(l){const d=typeof c=="string"?c:typeof c=="object"?c.type:void 0;throw new Error(`Unable to evaluate guard ${d?`'${d}' `:""}in transition for event '${r}' in state node '${this.id}':
${l.message}`)}if(f){s.push(...a.actions),i=a;break}}return i?[i]:void 0}get events(){return Ft(this,"events",()=>{const{states:e}=this,n=new Set(this.ownEvents);if(e)for(const r of Object.keys(e)){const s=e[r];if(s.states)for(const i of s.events)n.add(`${i}`)}return Array.from(n)})}get ownEvents(){const e=new Set([...this.transitions.keys()].filter(n=>this.transitions.get(n).some(r=>!(!r.target&&!r.actions.length&&!r.reenter))));return Array.from(e)}}const pd="#";class oi{constructor(e,n){this.config=e,this.version=void 0,this.schemas=void 0,this.implementations=void 0,this.__xstatenode=!0,this.idMap=new Map,this.root=void 0,this.id=void 0,this.states=void 0,this.events=void 0,this.id=e.id||"(machine)",this.implementations={actors:n?.actors??{},actions:n?.actions??{},delays:n?.delays??{},guards:n?.guards??{}},this.version=this.config.version,this.schemas=this.config.schemas,this.transition=this.transition.bind(this),this.getInitialSnapshot=this.getInitialSnapshot.bind(this),this.getPersistedSnapshot=this.getPersistedSnapshot.bind(this),this.restoreSnapshot=this.restoreSnapshot.bind(this),this.start=this.start.bind(this),this.root=new ii(e,{_key:this.id,_machine:this}),this.root._initialize(),this.states=this.root.states,this.events=this.root.events}provide(e){const{actions:n,guards:r,actors:s,delays:i}=this.implementations;return new oi(this.config,{actions:{...n,...e.actions},guards:{...r,...e.guards},actors:{...s,...e.actors},delays:{...i,...e.delays}})}resolveState(e){const n=td(this.root,e.value),r=dr(gr(this.root,n));return Xn({_nodes:[...r],context:e.context||{},children:{},status:ni(r,this.root)?"done":e.status||"active",output:e.output,error:e.error,historyValue:e.historyValue},this)}transition(e,n,r){return Wr(e,n,r,[]).snapshot}microstep(e,n,r){return Wr(e,n,r,[]).microstates}getTransitionData(e,n){return ri(this.root,e.value,e,n)||[]}getPreInitialState(e,n,r){const{context:s}=this.config,i=Xn({context:typeof s!="function"&&s?s:{},_nodes:[this.root],children:{},status:"active"},this);return typeof s=="function"?sn(i,n,e,[ks(({spawn:a,event:c,self:u})=>s({spawn:a,input:c.input,self:u}))],r,void 0):i}getInitialSnapshot(e,n){const r=Jo(n),s=[],i=this.getPreInitialState(e,r,s),o=Es([{target:[...oa(this.root)],source:this.root,reenter:!0,actions:[],eventType:null,toJSON:null}],i,e,r,!0,s),{snapshot:a}=Wr(o,r,e,s);return a}start(e){Object.values(e.children).forEach(n=>{n.getSnapshot().status==="active"&&n.start()})}getStateNodeById(e){const n=Ys(e),r=n.slice(1),s=Or(n[0])?n[0].slice(pd.length):n[0],i=this.idMap.get(s);if(!i)throw new Error(`Child state node '#${s}' does not exist on machine '${this.id}'`);return hr(i,r)}get definition(){return this.root.definition}toJSON(){return this.definition}getPersistedSnapshot(e,n){return cd(e,n)}restoreSnapshot(e,n){const r={},s=e.children;Object.keys(s).forEach(c=>{const u=s[c],f=u.snapshot,l=u.src,d=typeof l=="string"?Zs(this,l):l;if(!d)return;const h=Sn(d,{id:c,parent:n.self,syncSnapshot:u.syncSnapshot,snapshot:f,src:l,systemId:u.systemId});r[c]=h});const i=Xn({...e,children:r,_nodes:Array.from(dr(gr(this.root,e.value)))},this),o=new Set;function a(c,u){if(!o.has(c)){o.add(c);for(const f in c){const l=c[f];if(l&&typeof l=="object"){if("xstate$$type"in l&&l.xstate$$type===Qs){c[f]=u[l.id];continue}a(l,u)}}}}return a(i.context,r),i}}function yd(t,e){return new oi(t,e)}function wd({schemas:t,actors:e,actions:n,guards:r,delays:s}){return{createMachine:i=>yd({...i,schemas:t},{actors:e,actions:n,guards:r,delays:s})}}const md={timeout:1/0};function bd(t,e,n){const r={...md,...n};return new Promise((s,i)=>{const{signal:o}=r;if(o?.aborted){i(o.reason);return}let a=!1;const c=r.timeout===1/0?void 0:setTimeout(()=>{u(),i(new Error(`Timeout of ${r.timeout} ms exceeded`))},r.timeout),u=()=>{clearTimeout(c),a=!0,d?.unsubscribe(),l&&o.removeEventListener("abort",l)};function f(h){e(h)&&(u(),s(h))}let l,d;f(t.getSnapshot()),!a&&(o&&(l=()=>{u(),i(o.reason)},o.addEventListener("abort",l)),d=t.subscribe({next:f,error:h=>{u(),i(h)},complete:()=>{u(),i(new Error("Actor terminated without satisfying predicate"))}}),a&&d.unsubscribe())})}var ut={},lt={},Je={},Fi;function da(){if(Fi)return Je;Fi=1,Object.defineProperty(Je,"__esModule",{value:!0}),Je.anumber=t,Je.number=t,Je.abytes=n,Je.bytes=n,Je.ahash=r,Je.aexists=s,Je.aoutput=i;function t(a){if(!Number.isSafeInteger(a)||a<0)throw new Error("positive integer expected, got "+a)}function e(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&a.constructor.name==="Uint8Array"}function n(a,...c){if(!e(a))throw new Error("Uint8Array expected");if(c.length>0&&!c.includes(a.length))throw new Error("Uint8Array expected of length "+c+", got length="+a.length)}function r(a){if(typeof a!="function"||typeof a.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");t(a.outputLen),t(a.blockLen)}function s(a,c=!0){if(a.destroyed)throw new Error("Hash instance has been destroyed");if(c&&a.finished)throw new Error("Hash#digest() has already been called")}function i(a,c){n(a);const u=c.outputLen;if(a.length<u)throw new Error("digestInto() expects output buffer of length at least "+u)}const o={number:t,bytes:n,hash:r,exists:s,output:i};return Je.default=o,Je}var Gr={},gn={},qi;function vd(){return qi||(qi=1,Object.defineProperty(gn,"__esModule",{value:!0}),gn.crypto=void 0,gn.crypto=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0),gn}var Vi;function ha(){return Vi||(Vi=1,function(t){/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */Object.defineProperty(t,"__esModule",{value:!0}),t.Hash=t.nextTick=t.byteSwapIfBE=t.byteSwap=t.isLE=t.rotl=t.rotr=t.createView=t.u32=t.u8=void 0,t.isBytes=r,t.byteSwap32=f,t.bytesToHex=d,t.hexToBytes=w,t.asyncLoop=v,t.utf8ToBytes=M,t.toBytes=k,t.concatBytes=F,t.checkOpts=q,t.wrapConstructor=Y,t.wrapConstructorWithOpts=U,t.wrapXOFConstructorWithOpts=H,t.randomBytes=V;const e=vd(),n=da();function r(I){return I instanceof Uint8Array||ArrayBuffer.isView(I)&&I.constructor.name==="Uint8Array"}const s=I=>new Uint8Array(I.buffer,I.byteOffset,I.byteLength);t.u8=s;const i=I=>new Uint32Array(I.buffer,I.byteOffset,Math.floor(I.byteLength/4));t.u32=i;const o=I=>new DataView(I.buffer,I.byteOffset,I.byteLength);t.createView=o;const a=(I,W)=>I<<32-W|I>>>W;t.rotr=a;const c=(I,W)=>I<<W|I>>>32-W>>>0;t.rotl=c,t.isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;const u=I=>I<<24&4278190080|I<<8&16711680|I>>>8&65280|I>>>24&255;t.byteSwap=u,t.byteSwapIfBE=t.isLE?I=>I:I=>(0,t.byteSwap)(I);function f(I){for(let W=0;W<I.length;W++)I[W]=(0,t.byteSwap)(I[W])}const l=Array.from({length:256},(I,W)=>W.toString(16).padStart(2,"0"));function d(I){(0,n.abytes)(I);let W="";for(let m=0;m<I.length;m++)W+=l[I[m]];return W}const h={_0:48,_9:57,A:65,F:70,a:97,f:102};function g(I){if(I>=h._0&&I<=h._9)return I-h._0;if(I>=h.A&&I<=h.F)return I-(h.A-10);if(I>=h.a&&I<=h.f)return I-(h.a-10)}function w(I){if(typeof I!="string")throw new Error("hex string expected, got "+typeof I);const W=I.length,m=W/2;if(W%2)throw new Error("hex string expected, got unpadded hex of length "+W);const j=new Uint8Array(m);for(let O=0,D=0;O<m;O++,D+=2){const B=g(I.charCodeAt(D)),Q=g(I.charCodeAt(D+1));if(B===void 0||Q===void 0){const te=I[D]+I[D+1];throw new Error('hex string expected, got non-hex character "'+te+'" at index '+D)}j[O]=B*16+Q}return j}const x=async()=>{};t.nextTick=x;async function v(I,W,m){let j=Date.now();for(let O=0;O<I;O++){m(O);const D=Date.now()-j;D>=0&&D<W||(await(0,t.nextTick)(),j+=D)}}function M(I){if(typeof I!="string")throw new Error("utf8ToBytes expected string, got "+typeof I);return new Uint8Array(new TextEncoder().encode(I))}function k(I){return typeof I=="string"&&(I=M(I)),(0,n.abytes)(I),I}function F(...I){let W=0;for(let j=0;j<I.length;j++){const O=I[j];(0,n.abytes)(O),W+=O.length}const m=new Uint8Array(W);for(let j=0,O=0;j<I.length;j++){const D=I[j];m.set(D,O),O+=D.length}return m}class A{clone(){return this._cloneInto()}}t.Hash=A;function q(I,W){if(W!==void 0&&{}.toString.call(W)!=="[object Object]")throw new Error("Options should be object or undefined");return Object.assign(I,W)}function Y(I){const W=j=>I().update(k(j)).digest(),m=I();return W.outputLen=m.outputLen,W.blockLen=m.blockLen,W.create=()=>I(),W}function U(I){const W=(j,O)=>I(O).update(k(j)).digest(),m=I({});return W.outputLen=m.outputLen,W.blockLen=m.blockLen,W.create=j=>I(j),W}function H(I){const W=(j,O)=>I(O).update(k(j)).digest(),m=I({});return W.outputLen=m.outputLen,W.blockLen=m.blockLen,W.create=j=>I(j),W}function V(I=32){if(e.crypto&&typeof e.crypto.getRandomValues=="function")return e.crypto.getRandomValues(new Uint8Array(I));if(e.crypto&&typeof e.crypto.randomBytes=="function")return e.crypto.randomBytes(I);throw new Error("crypto.getRandomValues must be defined")}}(Gr)),Gr}var zi;function xd(){if(zi)return lt;zi=1,Object.defineProperty(lt,"__esModule",{value:!0}),lt.HashMD=lt.Maj=lt.Chi=void 0;const t=da(),e=ha();function n(o,a,c,u){if(typeof o.setBigUint64=="function")return o.setBigUint64(a,c,u);const f=BigInt(32),l=BigInt(4294967295),d=Number(c>>f&l),h=Number(c&l),g=u?4:0,w=u?0:4;o.setUint32(a+g,d,u),o.setUint32(a+w,h,u)}const r=(o,a,c)=>o&a^~o&c;lt.Chi=r;const s=(o,a,c)=>o&a^o&c^a&c;lt.Maj=s;class i extends e.Hash{constructor(a,c,u,f){super(),this.blockLen=a,this.outputLen=c,this.padOffset=u,this.isLE=f,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(a),this.view=(0,e.createView)(this.buffer)}update(a){(0,t.aexists)(this);const{view:c,buffer:u,blockLen:f}=this;a=(0,e.toBytes)(a);const l=a.length;for(let d=0;d<l;){const h=Math.min(f-this.pos,l-d);if(h===f){const g=(0,e.createView)(a);for(;f<=l-d;d+=f)this.process(g,d);continue}u.set(a.subarray(d,d+h),this.pos),this.pos+=h,d+=h,this.pos===f&&(this.process(c,0),this.pos=0)}return this.length+=a.length,this.roundClean(),this}digestInto(a){(0,t.aexists)(this),(0,t.aoutput)(a,this),this.finished=!0;const{buffer:c,view:u,blockLen:f,isLE:l}=this;let{pos:d}=this;c[d++]=128,this.buffer.subarray(d).fill(0),this.padOffset>f-d&&(this.process(u,0),d=0);for(let v=d;v<f;v++)c[v]=0;n(u,f-8,BigInt(this.length*8),l),this.process(u,0);const h=(0,e.createView)(a),g=this.outputLen;if(g%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const w=g/4,x=this.get();if(w>x.length)throw new Error("_sha2: outputLen bigger than state");for(let v=0;v<w;v++)h.setUint32(4*v,x[v],l)}digest(){const{buffer:a,outputLen:c}=this;this.digestInto(a);const u=a.slice(0,c);return this.destroy(),u}_cloneInto(a){a||(a=new this.constructor),a.set(...this.get());const{blockLen:c,buffer:u,length:f,finished:l,destroyed:d,pos:h}=this;return a.length=f,a.pos=h,a.finished=l,a.destroyed=d,f%c&&a.buffer.set(u),a}}return lt.HashMD=i,lt}var Wi;function Sd(){if(Wi)return ut;Wi=1,Object.defineProperty(ut,"__esModule",{value:!0}),ut.sha224=ut.sha256=ut.SHA256=void 0;const t=xd(),e=ha(),n=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),r=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),s=new Uint32Array(64);class i extends t.HashMD{constructor(){super(64,32,8,!1),this.A=r[0]|0,this.B=r[1]|0,this.C=r[2]|0,this.D=r[3]|0,this.E=r[4]|0,this.F=r[5]|0,this.G=r[6]|0,this.H=r[7]|0}get(){const{A:c,B:u,C:f,D:l,E:d,F:h,G:g,H:w}=this;return[c,u,f,l,d,h,g,w]}set(c,u,f,l,d,h,g,w){this.A=c|0,this.B=u|0,this.C=f|0,this.D=l|0,this.E=d|0,this.F=h|0,this.G=g|0,this.H=w|0}process(c,u){for(let M=0;M<16;M++,u+=4)s[M]=c.getUint32(u,!1);for(let M=16;M<64;M++){const k=s[M-15],F=s[M-2],A=(0,e.rotr)(k,7)^(0,e.rotr)(k,18)^k>>>3,q=(0,e.rotr)(F,17)^(0,e.rotr)(F,19)^F>>>10;s[M]=q+s[M-7]+A+s[M-16]|0}let{A:f,B:l,C:d,D:h,E:g,F:w,G:x,H:v}=this;for(let M=0;M<64;M++){const k=(0,e.rotr)(g,6)^(0,e.rotr)(g,11)^(0,e.rotr)(g,25),F=v+k+(0,t.Chi)(g,w,x)+n[M]+s[M]|0,q=((0,e.rotr)(f,2)^(0,e.rotr)(f,13)^(0,e.rotr)(f,22))+(0,t.Maj)(f,l,d)|0;v=x,x=w,w=g,g=h+F|0,h=d,d=l,l=f,f=F+q|0}f=f+this.A|0,l=l+this.B|0,d=d+this.C|0,h=h+this.D|0,g=g+this.E|0,w=w+this.F|0,x=x+this.G|0,v=v+this.H|0,this.set(f,l,d,h,g,w,x,v)}roundClean(){s.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}ut.SHA256=i;class o extends i{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}return ut.sha256=(0,e.wrapConstructor)(()=>new i),ut.sha224=(0,e.wrapConstructor)(()=>new o),ut}var Kr,Gi;function Ed(){if(Gi)return Kr;Gi=1;function t(e){if(e.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var s=0;s<e.length;s++){var i=e.charAt(s),o=i.charCodeAt(0);if(n[o]!==255)throw new TypeError(i+" is ambiguous");n[o]=s}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),f=Math.log(256)/Math.log(a);function l(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var w=0,x=0,v=0,M=g.length;v!==M&&g[v]===0;)v++,w++;for(var k=(M-v)*f+1>>>0,F=new Uint8Array(k);v!==M;){for(var A=g[v],q=0,Y=k-1;(A!==0||q<x)&&Y!==-1;Y--,q++)A+=256*F[Y]>>>0,F[Y]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");x=q,v++}for(var U=k-x;U!==k&&F[U]===0;)U++;for(var H=c.repeat(w);U<k;++U)H+=e.charAt(F[U]);return H}function d(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;for(var w=0,x=0,v=0;g[w]===c;)x++,w++;for(var M=(g.length-w)*u+1>>>0,k=new Uint8Array(M);g[w];){var F=n[g.charCodeAt(w)];if(F===255)return;for(var A=0,q=M-1;(F!==0||A<v)&&q!==-1;q--,A++)F+=a*k[q]>>>0,k[q]=F%256>>>0,F=F/256>>>0;if(F!==0)throw new Error("Non-zero carry");v=A,w++}for(var Y=M-v;Y!==M&&k[Y]===0;)Y++;for(var U=new Uint8Array(x+(M-Y)),H=x;Y!==M;)U[H++]=k[Y++];return U}function h(g){var w=d(g);if(w)return w;throw new Error("Non-base"+a+" character")}return{encode:l,decodeUnsafe:d,decode:h}}return Kr=t,Kr}var Xr,Ki;function kd(){return Ki||(Ki=1,Xr=Ed()("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz")),Xr}var Jr,Xi;function Ad(){if(Xi)return Jr;Xi=1;var t=kd();return Jr=function(e){function n(o){var a=Uint8Array.from(o),c=e(a),u=a.length+4,f=new Uint8Array(u);return f.set(a,0),f.set(c.subarray(0,4),a.length),t.encode(f,u)}function r(o){var a=o.slice(0,-4),c=o.slice(-4),u=e(a);if(!(c[0]^u[0]|c[1]^u[1]|c[2]^u[2]|c[3]^u[3]))return a}function s(o){var a=t.decodeUnsafe(o);if(a)return r(a)}function i(o){var a=t.decode(o),c=r(a);if(!c)throw new Error("Invalid checksum");return c}return{encode:n,decode:i,decodeUnsafe:s}},Jr}var Yr,Ji;function Cd(){if(Ji)return Yr;Ji=1;var{sha256:t}=Sd(),e=Ad();function n(r){return t(t(r))}return Yr=e(n),Yr}var Td=Cd();const ga=Sr(Td),ai="automerge:",ci=t=>{const e=new RegExp(`^${ai}(\\w+)$`),[,n]=t.match(e)||[],r=n,s=ya(r);if(!s)throw new Error("Invalid document URL: "+t);return{binaryDocumentId:s,documentId:r}},ui=t=>{const e=t instanceof Uint8Array||typeof t=="string"?t:"documentId"in t?t.documentId:void 0,n=e instanceof Uint8Array?As(e):typeof e=="string"?e:void 0;if(n===void 0)throw new Error("Invalid documentId: "+e);return ai+n},_a=t=>{if(!t||!t.startsWith(ai))return!1;const e=t;try{const{documentId:n}=ci(e);return pa(n)}catch{return!1}},pa=t=>{const e=ya(t);if(e===void 0)return!1;const n=Bl(e);return Cr(n)},Id=t=>Cr(t),Md=()=>{const t=Lo(null,new Uint8Array(16));return ui({documentId:t})},ya=t=>ga.decodeUnsafe(t),As=t=>ga.encode(t),Zr=t=>{if(t instanceof Uint8Array)return As(t);if(_a(t))return ci(t).documentId;if(pa(t))return t;if(Id(t)){console.warn("Future versions will not support UUIDs as document IDs; use Automerge URLs instead.");const e=jl(t);return As(e)}throw new Error(`Invalid AutomergeUrl: '${t}'`)};let Cs;try{Cs=new TextDecoder}catch{}let G,Bt,R=0;const Od=105,Rd=57342,Pd=57343,Yi=57337,Zi=6,qt={};let _n=11281e4,ft=1681e4,ue={},we,_r,pr=0,En=0,Ee,Ve,xe=[],Ts=[],Be,Re,yn,Qi={useRecords:!1,mapsAsObjects:!0},kn=!1,wa=2;try{new Function("")}catch{wa=1/0}class An{constructor(e){if(e&&((e.keyMap||e._keyMap)&&!e.useRecords&&(e.useRecords=!1,e.mapsAsObjects=!0),e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.getStructures&&(e.getShared=e.getStructures),e.getShared&&!e.structures&&((e.structures=[]).uninitialized=!0),e.keyMap)){this.mapKey=new Map;for(let[n,r]of Object.entries(e.keyMap))this.mapKey.set(r,n)}Object.assign(this,e)}decodeKey(e){return this.keyMap&&this.mapKey.get(e)||e}encodeKey(e){return this.keyMap&&this.keyMap.hasOwnProperty(e)?this.keyMap[e]:e}encodeKeys(e){if(!this._keyMap)return e;let n=new Map;for(let[r,s]of Object.entries(e))n.set(this._keyMap.hasOwnProperty(r)?this._keyMap[r]:r,s);return n}decodeKeys(e){if(!this._keyMap||e.constructor.name!="Map")return e;if(!this._mapKey){this._mapKey=new Map;for(let[r,s]of Object.entries(this._keyMap))this._mapKey.set(s,r)}let n={};return e.forEach((r,s)=>n[ze(this._mapKey.has(s)?this._mapKey.get(s):s)]=r),n}mapDecode(e,n){let r=this.decode(e);if(this._keyMap)switch(r.constructor.name){case"Array":return r.map(s=>this.decodeKeys(s))}return r}decode(e,n){if(G)return xa(()=>(Rs(),this?this.decode(e,n):An.prototype.decode.call(Qi,e,n)));Bt=n>-1?n:e.length,R=0,En=0,_r=null,Ee=null,G=e;try{Re=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(r){throw G=null,e instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof An){if(ue=this,Be=this.sharedValues&&(this.pack?new Array(this.maxPrivatePackedValues||16).concat(this.sharedValues):this.sharedValues),this.structures)return we=this.structures,Hn();(!we||we.length>0)&&(we=[])}else ue=Qi,(!we||we.length>0)&&(we=[]),Be=null;return Hn()}decodeMultiple(e,n){let r,s=0;try{let i=e.length;kn=!0;let o=this?this.decode(e,i):di.decode(e,i);if(n){if(n(o)===!1)return;for(;R<i;)if(s=R,n(Hn())===!1)return}else{for(r=[o];R<i;)s=R,r.push(Hn());return r}}catch(i){throw i.lastPosition=s,i.values=r,i}finally{kn=!1,Rs()}}}function Hn(){try{let t=fe();if(Ee){if(R>=Ee.postBundlePosition){let e=new Error("Unexpected bundle position");throw e.incomplete=!0,e}R=Ee.postBundlePosition,Ee=null}if(R==Bt)we=null,G=null,Ve&&(Ve=null);else if(R>Bt){let e=new Error("Unexpected end of CBOR data");throw e.incomplete=!0,e}else if(!kn)throw new Error("Data read, but end of buffer not reached");return t}catch(t){throw Rs(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer"))&&(t.incomplete=!0),t}}function fe(){let t=G[R++],e=t>>5;if(t=t&31,t>23)switch(t){case 24:t=G[R++];break;case 25:if(e==7)return jd();t=Re.getUint16(R),R+=2;break;case 26:if(e==7){let n=Re.getFloat32(R);if(ue.useFloat32>2){let r=fi[(G[R]&127)<<1|G[R+1]>>7];return R+=4,(r*n+(n>0?.5:-.5)>>0)/r}return R+=4,n}t=Re.getUint32(R),R+=4;break;case 27:if(e==7){let n=Re.getFloat64(R);return R+=8,n}if(e>1){if(Re.getUint32(R)>0)throw new Error("JavaScript does not support arrays, maps, or strings with length over 4294967295");t=Re.getUint32(R+4)}else ue.int64AsNumber?(t=Re.getUint32(R)*4294967296,t+=Re.getUint32(R+4)):t=Re.getBigUint64(R);R+=8;break;case 31:switch(e){case 2:case 3:throw new Error("Indefinite length not supported for byte or text strings");case 4:let n=[],r,s=0;for(;(r=fe())!=qt;){if(s>=_n)throw new Error(`Array length exceeds ${_n}`);n[s++]=r}return e==4?n:e==3?n.join(""):Buffer.concat(n);case 5:let i;if(ue.mapsAsObjects){let o={},a=0;if(ue.keyMap)for(;(i=fe())!=qt;){if(a++>=ft)throw new Error(`Property count exceeds ${ft}`);o[ze(ue.decodeKey(i))]=fe()}else for(;(i=fe())!=qt;){if(a++>=ft)throw new Error(`Property count exceeds ${ft}`);o[ze(i)]=fe()}return o}else{yn&&(ue.mapsAsObjects=!0,yn=!1);let o=new Map;if(ue.keyMap){let a=0;for(;(i=fe())!=qt;){if(a++>=ft)throw new Error(`Map size exceeds ${ft}`);o.set(ue.decodeKey(i),fe())}}else{let a=0;for(;(i=fe())!=qt;){if(a++>=ft)throw new Error(`Map size exceeds ${ft}`);o.set(i,fe())}}return o}case 7:return qt;default:throw new Error("Invalid major type for indefinite length "+e)}default:throw new Error("Unknown token "+t)}switch(e){case 0:return t;case 1:return~t;case 2:return Bd(t);case 3:if(En>=R)return _r.slice(R-pr,(R+=t)-pr);if(En==0&&Bt<140&&t<32){let s=t<16?ma(t):$d(t);if(s!=null)return s}return Dd(t);case 4:if(t>=_n)throw new Error(`Array length exceeds ${_n}`);let n=new Array(t);for(let s=0;s<t;s++)n[s]=fe();return n;case 5:if(t>=ft)throw new Error(`Map size exceeds ${_n}`);if(ue.mapsAsObjects){let s={};if(ue.keyMap)for(let i=0;i<t;i++)s[ze(ue.decodeKey(fe()))]=fe();else for(let i=0;i<t;i++)s[ze(fe())]=fe();return s}else{yn&&(ue.mapsAsObjects=!0,yn=!1);let s=new Map;if(ue.keyMap)for(let i=0;i<t;i++)s.set(ue.decodeKey(fe()),fe());else for(let i=0;i<t;i++)s.set(fe(),fe());return s}case 6:if(t>=Yi){let s=we[t&8191];if(s)return s.read||(s.read=Is(s)),s.read();if(t<65536){if(t==Pd){let i=Xt(),o=fe(),a=fe();Os(o,a);let c={};if(ue.keyMap)for(let u=2;u<i;u++){let f=ue.decodeKey(a[u-2]);c[ze(f)]=fe()}else for(let u=2;u<i;u++){let f=a[u-2];c[ze(f)]=fe()}return c}else if(t==Rd){let i=Xt(),o=fe();for(let a=2;a<i;a++)Os(o++,fe());return fe()}else if(t==Yi)return qd();if(ue.getShared&&(li(),s=we[t&8191],s))return s.read||(s.read=Is(s)),s.read()}}let r=xe[t];if(r)return r.handlesRead?r(fe):r(fe());{let s=fe();for(let i=0;i<Ts.length;i++){let o=Ts[i](t,s);if(o!==void 0)return o}return new ln(s,t)}case 7:switch(t){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 31:default:let s=(Be||Mt())[t];if(s!==void 0)return s;throw new Error("Unknown token "+t)}default:if(isNaN(t)){let s=new Error("Unexpected end of CBOR data");throw s.incomplete=!0,s}throw new Error("Unknown CBOR token "+t)}}const eo=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function Is(t){if(!t)throw new Error("Structure is required in record definition");function e(){let n=G[R++];if(n=n&31,n>23)switch(n){case 24:n=G[R++];break;case 25:n=Re.getUint16(R),R+=2;break;case 26:n=Re.getUint32(R),R+=4;break;default:throw new Error("Expected array header, but got "+G[R-1])}let r=this.compiledReader;for(;r;){if(r.propertyCount===n)return r(fe);r=r.next}if(this.slowReads++>=wa){let i=this.length==n?this:this.slice(0,n);return r=ue.keyMap?new Function("r","return {"+i.map(o=>ue.decodeKey(o)).map(o=>eo.test(o)?ze(o)+":r()":"["+JSON.stringify(o)+"]:r()").join(",")+"}"):new Function("r","return {"+i.map(o=>eo.test(o)?ze(o)+":r()":"["+JSON.stringify(o)+"]:r()").join(",")+"}"),this.compiledReader&&(r.next=this.compiledReader),r.propertyCount=n,this.compiledReader=r,r(fe)}let s={};if(ue.keyMap)for(let i=0;i<n;i++)s[ze(ue.decodeKey(this[i]))]=fe();else for(let i=0;i<n;i++)s[ze(this[i])]=fe();return s}return t.slowReads=0,e}function ze(t){if(typeof t=="string")return t==="__proto__"?"__proto_":t;if(typeof t=="number"||typeof t=="boolean"||typeof t=="bigint")return t.toString();if(t==null)return t+"";throw new Error("Invalid property name type "+typeof t)}let Dd=Ms;function Ms(t){let e;if(t<16&&(e=ma(t)))return e;if(t>64&&Cs)return Cs.decode(G.subarray(R,R+=t));const n=R+t,r=[];for(e="";R<n;){const s=G[R++];if(!(s&128))r.push(s);else if((s&224)===192){const i=G[R++]&63;r.push((s&31)<<6|i)}else if((s&240)===224){const i=G[R++]&63,o=G[R++]&63;r.push((s&31)<<12|i<<6|o)}else if((s&248)===240){const i=G[R++]&63,o=G[R++]&63,a=G[R++]&63;let c=(s&7)<<18|i<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(s);r.length>=4096&&(e+=ke.apply(String,r),r.length=0)}return r.length>0&&(e+=ke.apply(String,r)),e}let ke=String.fromCharCode;function $d(t){let e=R,n=new Array(t);for(let r=0;r<t;r++){const s=G[R++];if((s&128)>0){R=e;return}n[r]=s}return ke.apply(String,n)}function ma(t){if(t<4)if(t<2){if(t===0)return"";{let e=G[R++];if((e&128)>1){R-=1;return}return ke(e)}}else{let e=G[R++],n=G[R++];if((e&128)>0||(n&128)>0){R-=2;return}if(t<3)return ke(e,n);let r=G[R++];if((r&128)>0){R-=3;return}return ke(e,n,r)}else{let e=G[R++],n=G[R++],r=G[R++],s=G[R++];if((e&128)>0||(n&128)>0||(r&128)>0||(s&128)>0){R-=4;return}if(t<6){if(t===4)return ke(e,n,r,s);{let i=G[R++];if((i&128)>0){R-=5;return}return ke(e,n,r,s,i)}}else if(t<8){let i=G[R++],o=G[R++];if((i&128)>0||(o&128)>0){R-=6;return}if(t<7)return ke(e,n,r,s,i,o);let a=G[R++];if((a&128)>0){R-=7;return}return ke(e,n,r,s,i,o,a)}else{let i=G[R++],o=G[R++],a=G[R++],c=G[R++];if((i&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){R-=8;return}if(t<10){if(t===8)return ke(e,n,r,s,i,o,a,c);{let u=G[R++];if((u&128)>0){R-=9;return}return ke(e,n,r,s,i,o,a,c,u)}}else if(t<12){let u=G[R++],f=G[R++];if((u&128)>0||(f&128)>0){R-=10;return}if(t<11)return ke(e,n,r,s,i,o,a,c,u,f);let l=G[R++];if((l&128)>0){R-=11;return}return ke(e,n,r,s,i,o,a,c,u,f,l)}else{let u=G[R++],f=G[R++],l=G[R++],d=G[R++];if((u&128)>0||(f&128)>0||(l&128)>0||(d&128)>0){R-=12;return}if(t<14){if(t===12)return ke(e,n,r,s,i,o,a,c,u,f,l,d);{let h=G[R++];if((h&128)>0){R-=13;return}return ke(e,n,r,s,i,o,a,c,u,f,l,d,h)}}else{let h=G[R++],g=G[R++];if((h&128)>0||(g&128)>0){R-=14;return}if(t<15)return ke(e,n,r,s,i,o,a,c,u,f,l,d,h,g);let w=G[R++];if((w&128)>0){R-=15;return}return ke(e,n,r,s,i,o,a,c,u,f,l,d,h,g,w)}}}}}function Bd(t){return ue.copyBuffers?Uint8Array.prototype.slice.call(G,R,R+=t):G.subarray(R,R+=t)}let ba=new Float32Array(1),Fn=new Uint8Array(ba.buffer,0,4);function jd(){let t=G[R++],e=G[R++],n=(t&127)>>2;if(n===31)return e||t&3?NaN:t&128?-1/0:1/0;if(n===0){let r=((t&3)<<8|e)/16777216;return t&128?-r:r}return Fn[3]=t&128|(n>>1)+56,Fn[2]=(t&7)<<5|e>>3,Fn[1]=e<<5,Fn[0]=0,ba[0]}new Array(4096);class ln{constructor(e,n){this.value=e,this.tag=n}}xe[0]=t=>new Date(t);xe[1]=t=>new Date(Math.round(t*1e3));xe[2]=t=>{let e=BigInt(0);for(let n=0,r=t.byteLength;n<r;n++)e=BigInt(t[n])+(e<<BigInt(8));return e};xe[3]=t=>BigInt(-1)-xe[2](t);xe[4]=t=>+(t[1]+"e"+t[0]);xe[5]=t=>t[1]*Math.exp(t[0]*Math.log(2));const Os=(t,e)=>{t=t-57344;let n=we[t];n&&n.isShared&&((we.restoreStructures||(we.restoreStructures=[]))[t]=n),we[t]=e,e.read=Is(e)};xe[Od]=t=>{let e=t.length,n=t[1];Os(t[0],n);let r={};for(let s=2;s<e;s++){let i=n[s-2];r[ze(i)]=t[s]}return r};xe[14]=t=>Ee?Ee[0].slice(Ee.position0,Ee.position0+=t):new ln(t,14);xe[15]=t=>Ee?Ee[1].slice(Ee.position1,Ee.position1+=t):new ln(t,15);let Ld={Error,RegExp};xe[27]=t=>(Ld[t[0]]||Error)(t[1],t[2]);const va=t=>{if(G[R++]!=132){let n=new Error("Packed values structure must be followed by a 4 element array");throw G.length<R&&(n.incomplete=!0),n}let e=t();if(!e||!e.length){let n=new Error("Packed values structure must be followed by a 4 element array");throw n.incomplete=!0,n}return Be=Be?e.concat(Be.slice(e.length)):e,Be.prefixes=t(),Be.suffixes=t(),t()};va.handlesRead=!0;xe[51]=va;xe[Zi]=t=>{if(!Be)if(ue.getShared)li();else return new ln(t,Zi);if(typeof t=="number")return Be[16+(t>=0?2*t:-2*t-1)];let e=new Error("No support for non-integer packed references yet");throw t===void 0&&(e.incomplete=!0),e};xe[28]=t=>{Ve||(Ve=new Map,Ve.id=0);let e=Ve.id++,n=R,r=G[R],s;r>>5==4?s=[]:s={};let i={target:s};Ve.set(e,i);let o=t();return i.used?(Object.getPrototypeOf(s)!==Object.getPrototypeOf(o)&&(R=n,s=o,Ve.set(e,{target:s}),o=t()),Object.assign(s,o)):(i.target=o,o)};xe[28].handlesRead=!0;xe[29]=t=>{let e=Ve.get(t);return e.used=!0,e.target};xe[258]=t=>new Set(t);(xe[259]=t=>(ue.mapsAsObjects&&(ue.mapsAsObjects=!1,yn=!0),t())).handlesRead=!0;function Vt(t,e){return typeof t=="string"?t+e:t instanceof Array?t.concat(e):Object.assign({},t,e)}function Mt(){if(!Be)if(ue.getShared)li();else throw new Error("No packed values available");return Be}const Ud=1399353956;Ts.push((t,e)=>{if(t>=225&&t<=255)return Vt(Mt().prefixes[t-224],e);if(t>=28704&&t<=32767)return Vt(Mt().prefixes[t-28672],e);if(t>=1879052288&&t<=2147483647)return Vt(Mt().prefixes[t-1879048192],e);if(t>=216&&t<=223)return Vt(e,Mt().suffixes[t-216]);if(t>=27647&&t<=28671)return Vt(e,Mt().suffixes[t-27639]);if(t>=1811940352&&t<=1879048191)return Vt(e,Mt().suffixes[t-1811939328]);if(t==Ud)return{packedValues:Be,structures:we.slice(0),version:e};if(t==55799)return e});const Nd=new Uint8Array(new Uint16Array([1]).buffer)[0]==1,to=[Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array>"u"?{name:"BigUint64Array"}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array>"u"?{name:"BigInt64Array"}:BigInt64Array,Float32Array,Float64Array],Hd=[64,68,69,70,71,72,77,78,79,85,86];for(let t=0;t<to.length;t++)Fd(to[t],Hd[t]);function Fd(t,e){let n="get"+t.name.slice(0,-5),r;typeof t=="function"?r=t.BYTES_PER_ELEMENT:t=null;for(let s=0;s<2;s++){if(!s&&r==1)continue;let i=r==2?1:r==4?2:r==8?3:0;xe[s?e:e-4]=r==1||s==Nd?o=>{if(!t)throw new Error("Could not find typed array for code "+e);return!ue.copyBuffers&&(r===1||r===2&&!(o.byteOffset&1)||r===4&&!(o.byteOffset&3)||r===8&&!(o.byteOffset&7))?new t(o.buffer,o.byteOffset,o.byteLength>>i):new t(Uint8Array.prototype.slice.call(o,0).buffer)}:o=>{if(!t)throw new Error("Could not find typed array for code "+e);let a=new DataView(o.buffer,o.byteOffset,o.byteLength),c=o.length>>i,u=new t(c),f=a[n];for(let l=0;l<c;l++)u[l]=f.call(a,l<<i,s);return u}}}function qd(){let t=Xt(),e=R+fe();for(let r=2;r<t;r++){let s=Xt();R+=s}let n=R;return R=e,Ee=[Ms(Xt()),Ms(Xt())],Ee.position0=0,Ee.position1=0,Ee.postBundlePosition=R,R=n,fe()}function Xt(){let t=G[R++]&31;if(t>23)switch(t){case 24:t=G[R++];break;case 25:t=Re.getUint16(R),R+=2;break;case 26:t=Re.getUint32(R),R+=4;break}return t}function li(){if(ue.getShared){let t=xa(()=>(G=null,ue.getShared()))||{},e=t.structures||[];ue.sharedVersion=t.version,Be=ue.sharedValues=t.packedValues,we===!0?ue.structures=we=e:we.splice.apply(we,[0,e.length].concat(e))}}function xa(t){let e=Bt,n=R,r=pr,s=En,i=_r,o=Ve,a=Ee,c=new Uint8Array(G.slice(0,Bt)),u=we,f=ue,l=kn,d=t();return Bt=e,R=n,pr=r,En=s,_r=i,Ve=o,Ee=a,G=c,kn=l,we=u,ue=f,Re=new DataView(G.buffer,G.byteOffset,G.byteLength),d}function Rs(){G=null,Ve=null,we=null}const fi=new Array(147);for(let t=0;t<256;t++)fi[t]=+("1e"+Math.floor(45.15-t*.30103));let di=new An({useRecords:!1});const Sa=di.decode;di.decodeMultiple;let Jn;try{Jn=new TextEncoder}catch{}let Ps,Ea;const Rr=typeof globalThis=="object"&&globalThis.Buffer,Dn=typeof Rr<"u",Qr=Dn?Rr.allocUnsafeSlow:Uint8Array,no=Dn?Rr:Uint8Array,ro=256,so=Dn?4294967296:2144337920;let es,S,ye,y=0,xt,Se=null;const Vd=61440,zd=/[\u0080-\uFFFF]/,Ue=Symbol("record-id");class ka extends An{constructor(e){super(e),this.offset=0;let n,r,s,i,o;e=e||{};let a=no.prototype.utf8Write?function(m,j,O){return S.utf8Write(m,j,O)}:Jn&&Jn.encodeInto?function(m,j){return Jn.encodeInto(m,S.subarray(j)).written}:!1,c=this,u=e.structures||e.saveStructures,f=e.maxSharedStructures;if(f==null&&(f=u?128:0),f>8190)throw new Error("Maximum maxSharedStructure is 8190");let l=e.sequential;l&&(f=0),this.structures||(this.structures=[]),this.saveStructures&&(this.saveShared=this.saveStructures);let d,h,g=e.sharedValues,w;if(g){w=Object.create(null);for(let m=0,j=g.length;m<j;m++)w[g[m]]=m}let x=[],v=0,M=0;this.mapEncode=function(m,j){if(this._keyMap&&!this._mapped)switch(m.constructor.name){case"Array":m=m.map(O=>this.encodeKeys(O));break}return this.encode(m,j)},this.encode=function(m,j){if(S||(S=new Qr(8192),ye=new DataView(S.buffer,0,8192),y=0),xt=S.length-10,xt-y<2048?(S=new Qr(S.length),ye=new DataView(S.buffer,0,S.length),xt=S.length-10,y=0):j===ao&&(y=y+7&2147483640),n=y,c.useSelfDescribedHeader&&(ye.setUint32(y,3654940416),y+=3),o=c.structuredClone?new Map:null,c.bundleStrings&&typeof m!="string"?(Se=[],Se.size=1/0):Se=null,r=c.structures,r){if(r.uninitialized){let D=c.getShared()||{};c.structures=r=D.structures||[],c.sharedVersion=D.version;let B=c.sharedValues=D.packedValues;if(B){w={};for(let Q=0,te=B.length;Q<te;Q++)w[B[Q]]=Q}}let O=r.length;if(O>f&&!l&&(O=f),!r.transitions){r.transitions=Object.create(null);for(let D=0;D<O;D++){let B=r[D];if(!B)continue;let Q,te=r.transitions;for(let ne=0,re=B.length;ne<re;ne++){te[Ue]===void 0&&(te[Ue]=D);let ae=B[ne];Q=te[ae],Q||(Q=te[ae]=Object.create(null)),te=Q}te[Ue]=D|1048576}}l||(r.nextId=O)}if(s&&(s=!1),i=r||[],h=w,e.pack){let O=new Map;if(O.values=[],O.encoder=c,O.maxValues=e.maxPrivatePackedValues||(w?16:1/0),O.objectMap=w||!1,O.samplingPackedValues=d,Yn(m,O),O.values.length>0){S[y++]=216,S[y++]=51,rt(4);let D=O.values;k(D),rt(0),rt(0),h=Object.create(w||null);for(let B=0,Q=D.length;B<Q;B++)h[D[B]]=B}}es=j&ns;try{if(es)return;if(k(m),Se&&oo(n,k),c.offset=y,o&&o.idsToInsert){y+=o.idsToInsert.length*2,y>xt&&A(y),c.offset=y;let O=Kd(S.subarray(n,y),o.idsToInsert);return o=null,O}return j&ao?(S.start=n,S.end=y,S):S.subarray(n,y)}finally{if(r){if(M<10&&M++,r.length>f&&(r.length=f),v>1e4)r.transitions=null,M=0,v=0,x.length>0&&(x=[]);else if(x.length>0&&!l){for(let O=0,D=x.length;O<D;O++)x[O][Ue]=void 0;x=[]}}if(s&&c.saveShared){c.structures.length>f&&(c.structures=c.structures.slice(0,f));let O=S.subarray(n,y);return c.updateSharedData()===!1?c.encode(m):O}j&Xd&&(y=n)}},this.findCommonStringsToPack=()=>(d=new Map,w||(w=Object.create(null)),m=>{let j=m&&m.threshold||4,O=this.pack?m.maxPrivatePackedValues||16:0;g||(g=this.sharedValues=[]);for(let[D,B]of d)B.count>j&&(w[D]=O++,g.push(D),s=!0);for(;this.saveShared&&this.updateSharedData()===!1;);d=null});const k=m=>{y>xt&&(S=A(y));var j=typeof m,O;if(j==="string"){if(h){let te=h[m];if(te>=0){te<16?S[y++]=te+224:(S[y++]=198,te&1?k(15-te>>1):k(te-16>>1));return}else if(d&&!e.pack){let ne=d.get(m);ne?ne.count++:d.set(m,{count:1})}}let D=m.length;if(Se&&D>=4&&D<1024){if((Se.size+=D)>Vd){let ne,re=(Se[0]?Se[0].length*3+Se[1].length:0)+10;y+re>xt&&(S=A(y+re)),S[y++]=217,S[y++]=223,S[y++]=249,S[y++]=Se.position?132:130,S[y++]=26,ne=y-n,y+=4,Se.position&&oo(n,k),Se=["",""],Se.size=0,Se.position=ne}let te=zd.test(m);Se[te?0:1]+=m,S[y++]=te?206:207,k(D);return}let B;D<32?B=1:D<256?B=2:D<65536?B=3:B=5;let Q=D*3;if(y+Q>xt&&(S=A(y+Q)),D<64||!a){let te,ne,re,ae=y+B;for(te=0;te<D;te++)ne=m.charCodeAt(te),ne<128?S[ae++]=ne:ne<2048?(S[ae++]=ne>>6|192,S[ae++]=ne&63|128):(ne&64512)===55296&&((re=m.charCodeAt(te+1))&64512)===56320?(ne=65536+((ne&1023)<<10)+(re&1023),te++,S[ae++]=ne>>18|240,S[ae++]=ne>>12&63|128,S[ae++]=ne>>6&63|128,S[ae++]=ne&63|128):(S[ae++]=ne>>12|224,S[ae++]=ne>>6&63|128,S[ae++]=ne&63|128);O=ae-y-B}else O=a(m,y+B,Q);O<24?S[y++]=96|O:O<256?(B<2&&S.copyWithin(y+2,y+1,y+1+O),S[y++]=120,S[y++]=O):O<65536?(B<3&&S.copyWithin(y+3,y+2,y+2+O),S[y++]=121,S[y++]=O>>8,S[y++]=O&255):(B<5&&S.copyWithin(y+5,y+3,y+3+O),S[y++]=122,ye.setUint32(y,O),y+=4),y+=O}else if(j==="number")if(!this.alwaysUseFloat&&m>>>0===m)m<24?S[y++]=m:m<256?(S[y++]=24,S[y++]=m):m<65536?(S[y++]=25,S[y++]=m>>8,S[y++]=m&255):(S[y++]=26,ye.setUint32(y,m),y+=4);else if(!this.alwaysUseFloat&&m>>0===m)m>=-24?S[y++]=31-m:m>=-256?(S[y++]=56,S[y++]=~m):m>=-65536?(S[y++]=57,ye.setUint16(y,~m),y+=2):(S[y++]=58,ye.setUint32(y,~m),y+=4);else{let D;if((D=this.useFloat32)>0&&m<4294967296&&m>=-2147483648){S[y++]=250,ye.setFloat32(y,m);let B;if(D<4||(B=m*fi[(S[y]&127)<<1|S[y+1]>>7])>>0===B){y+=4;return}else y--}S[y++]=251,ye.setFloat64(y,m),y+=8}else if(j==="object")if(!m)S[y++]=246;else{if(o){let B=o.get(m);if(B){if(S[y++]=216,S[y++]=29,S[y++]=25,!B.references){let Q=o.idsToInsert||(o.idsToInsert=[]);B.references=[],Q.push(B)}B.references.push(y-n),y+=2;return}else o.set(m,{offset:y-n})}let D=m.constructor;if(D===Object)F(m);else if(D===Array){O=m.length,O<24?S[y++]=128|O:rt(O);for(let B=0;B<O;B++)k(m[B])}else if(D===Map)if((this.mapsAsObjects?this.useTag259ForMaps!==!1:this.useTag259ForMaps)&&(S[y++]=217,S[y++]=1,S[y++]=3),O=m.size,O<24?S[y++]=160|O:O<256?(S[y++]=184,S[y++]=O):O<65536?(S[y++]=185,S[y++]=O>>8,S[y++]=O&255):(S[y++]=186,ye.setUint32(y,O),y+=4),c.keyMap)for(let[B,Q]of m)k(c.encodeKey(B)),k(Q);else for(let[B,Q]of m)k(B),k(Q);else{for(let B=0,Q=Ps.length;B<Q;B++){let te=Ea[B];if(m instanceof te){let ne=Ps[B],re=ne.tag;re==null&&(re=ne.getTag&&ne.getTag.call(this,m)),re<24?S[y++]=192|re:re<256?(S[y++]=216,S[y++]=re):re<65536?(S[y++]=217,S[y++]=re>>8,S[y++]=re&255):re>-1&&(S[y++]=218,ye.setUint32(y,re),y+=4),ne.encode.call(this,m,k,A);return}}if(m[Symbol.iterator]){if(es){let B=new Error("Iterable should be serialized as iterator");throw B.iteratorNotHandled=!0,B}S[y++]=159;for(let B of m)k(B);S[y++]=255;return}if(m[Symbol.asyncIterator]||ts(m)){let B=new Error("Iterable/blob should be serialized as iterator");throw B.iteratorNotHandled=!0,B}if(this.useToJSON&&m.toJSON){const B=m.toJSON();if(B!==m)return k(B)}F(m)}}else if(j==="boolean")S[y++]=m?245:244;else if(j==="bigint"){if(m<BigInt(1)<<BigInt(64)&&m>=0)S[y++]=27,ye.setBigUint64(y,m);else if(m>-(BigInt(1)<<BigInt(64))&&m<0)S[y++]=59,ye.setBigUint64(y,-m-BigInt(1));else if(this.largeBigIntToFloat)S[y++]=251,ye.setFloat64(y,Number(m));else{m>=BigInt(0)?S[y++]=194:(S[y++]=195,m=BigInt(-1)-m);let D=[];for(;m;)D.push(Number(m&BigInt(255))),m>>=BigInt(8);Ds(new Uint8Array(D.reverse()),A);return}y+=8}else if(j==="undefined")S[y++]=247;else throw new Error("Unknown type: "+j)},F=this.useRecords===!1?this.variableMapSize?m=>{let j=Object.keys(m),O=Object.values(m),D=j.length;if(D<24?S[y++]=160|D:D<256?(S[y++]=184,S[y++]=D):D<65536?(S[y++]=185,S[y++]=D>>8,S[y++]=D&255):(S[y++]=186,ye.setUint32(y,D),y+=4),c.keyMap)for(let B=0;B<D;B++)k(c.encodeKey(j[B])),k(O[B]);else for(let B=0;B<D;B++)k(j[B]),k(O[B])}:m=>{S[y++]=185;let j=y-n;y+=2;let O=0;if(c.keyMap)for(let D in m)(typeof m.hasOwnProperty!="function"||m.hasOwnProperty(D))&&(k(c.encodeKey(D)),k(m[D]),O++);else for(let D in m)(typeof m.hasOwnProperty!="function"||m.hasOwnProperty(D))&&(k(D),k(m[D]),O++);S[j+++n]=O>>8,S[j+n]=O&255}:(m,j)=>{let O,D=i.transitions||(i.transitions=Object.create(null)),B=0,Q=0,te,ne;if(this.keyMap){ne=Object.keys(m).map(ae=>this.encodeKey(ae)),Q=ne.length;for(let ae=0;ae<Q;ae++){let fn=ne[ae];O=D[fn],O||(O=D[fn]=Object.create(null),B++),D=O}}else for(let ae in m)(typeof m.hasOwnProperty!="function"||m.hasOwnProperty(ae))&&(O=D[ae],O||(D[Ue]&1048576&&(te=D[Ue]&65535),O=D[ae]=Object.create(null),B++),D=O,Q++);let re=D[Ue];if(re!==void 0)re&=65535,S[y++]=217,S[y++]=re>>8|224,S[y++]=re&255;else if(ne||(ne=D.__keys__||(D.__keys__=Object.keys(m))),te===void 0?(re=i.nextId++,re||(re=0,i.nextId=1),re>=ro&&(i.nextId=(re=f)+1)):re=te,i[re]=ne,re<f){S[y++]=217,S[y++]=re>>8|224,S[y++]=re&255,D=i.transitions;for(let ae=0;ae<Q;ae++)(D[Ue]===void 0||D[Ue]&1048576)&&(D[Ue]=re),D=D[ne[ae]];D[Ue]=re|1048576,s=!0}else{if(D[Ue]=re,ye.setUint32(y,3655335680),y+=3,B&&(v+=M*B),x.length>=ro-f&&(x.shift()[Ue]=void 0),x.push(D),rt(Q+2),k(57344+re),k(ne),j)return;for(let ae in m)(typeof m.hasOwnProperty!="function"||m.hasOwnProperty(ae))&&k(m[ae]);return}if(Q<24?S[y++]=128|Q:rt(Q),!j)for(let ae in m)(typeof m.hasOwnProperty!="function"||m.hasOwnProperty(ae))&&k(m[ae])},A=m=>{let j;if(m>16777216){if(m-n>so)throw new Error("Encoded buffer would be larger than maximum buffer size");j=Math.min(so,Math.round(Math.max((m-n)*(m>67108864?1.25:2),4194304)/4096)*4096)}else j=(Math.max(m-n<<2,S.length-1)>>12)+1<<12;let O=new Qr(j);return ye=new DataView(O.buffer,0,j),S.copy?S.copy(O,0,n,m):O.set(S.slice(n,m)),y-=n,n=0,xt=O.length-10,S=O};let q=100,Y=1e3;this.encodeAsIterable=function(m,j){return I(m,j,U)},this.encodeAsAsyncIterable=function(m,j){return I(m,j,W)};function*U(m,j,O){let D=m.constructor;if(D===Object){let B=c.useRecords!==!1;B?F(m,!0):io(Object.keys(m).length,160);for(let Q in m){let te=m[Q];B||k(Q),te&&typeof te=="object"?j[Q]?yield*U(te,j[Q]):yield*H(te,j,Q):k(te)}}else if(D===Array){let B=m.length;rt(B);for(let Q=0;Q<B;Q++){let te=m[Q];te&&(typeof te=="object"||y-n>q)?j.element?yield*U(te,j.element):yield*H(te,j,"element"):k(te)}}else if(m[Symbol.iterator]&&!m.buffer){S[y++]=159;for(let B of m)B&&(typeof B=="object"||y-n>q)?j.element?yield*U(B,j.element):yield*H(B,j,"element"):k(B);S[y++]=255}else ts(m)?(io(m.size,64),yield S.subarray(n,y),yield m,V()):m[Symbol.asyncIterator]?(S[y++]=159,yield S.subarray(n,y),yield m,V(),S[y++]=255):k(m);O&&y>n?yield S.subarray(n,y):y-n>q&&(yield S.subarray(n,y),V())}function*H(m,j,O){let D=y-n;try{k(m),y-n>q&&(yield S.subarray(n,y),V())}catch(B){if(B.iteratorNotHandled)j[O]={},y=n+D,yield*U.call(this,m,j[O]);else throw B}}function V(){q=Y,c.encode(null,ns)}function I(m,j,O){return j&&j.chunkThreshold?q=Y=j.chunkThreshold:q=100,m&&typeof m=="object"?(c.encode(null,ns),O(m,c.iterateProperties||(c.iterateProperties={}),!0)):[c.encode(m)]}async function*W(m,j){for(let O of U(m,j,!0)){let D=O.constructor;if(D===no||D===Uint8Array)yield O;else if(ts(O)){let B=O.stream().getReader(),Q;for(;!(Q=await B.read()).done;)yield Q.value}else if(O[Symbol.asyncIterator])for await(let B of O)V(),B?yield*W(B,j.async||(j.async={})):yield c.encode(B);else yield O}}}useBuffer(e){S=e,ye=new DataView(S.buffer,S.byteOffset,S.byteLength),y=0}clearSharedData(){this.structures&&(this.structures=[]),this.sharedValues&&(this.sharedValues=void 0)}updateSharedData(){let e=this.sharedVersion||0;this.sharedVersion=e+1;let n=this.structures.slice(0),r=new Aa(n,this.sharedValues,this.sharedVersion),s=this.saveShared(r,i=>(i&&i.version||0)==e);return s===!1?(r=this.getShared()||{},this.structures=r.structures||[],this.sharedValues=r.packedValues,this.sharedVersion=r.version,this.structures.nextId=this.structures.length):n.forEach((i,o)=>this.structures[o]=i),s}}function io(t,e){t<24?S[y++]=e|t:t<256?(S[y++]=e|24,S[y++]=t):t<65536?(S[y++]=e|25,S[y++]=t>>8,S[y++]=t&255):(S[y++]=e|26,ye.setUint32(y,t),y+=4)}class Aa{constructor(e,n,r){this.structures=e,this.packedValues=n,this.version=r}}function rt(t){t<24?S[y++]=128|t:t<256?(S[y++]=152,S[y++]=t):t<65536?(S[y++]=153,S[y++]=t>>8,S[y++]=t&255):(S[y++]=154,ye.setUint32(y,t),y+=4)}const Wd=typeof Blob>"u"?function(){}:Blob;function ts(t){if(t instanceof Wd)return!0;let e=t[Symbol.toStringTag];return e==="Blob"||e==="File"}function Yn(t,e){switch(typeof t){case"string":if(t.length>3){if(e.objectMap[t]>-1||e.values.length>=e.maxValues)return;let r=e.get(t);if(r)++r.count==2&&e.values.push(t);else if(e.set(t,{count:1}),e.samplingPackedValues){let s=e.samplingPackedValues.get(t);s?s.count++:e.samplingPackedValues.set(t,{count:1})}}break;case"object":if(t)if(t instanceof Array)for(let r=0,s=t.length;r<s;r++)Yn(t[r],e);else{let r=!e.encoder.useRecords;for(var n in t)t.hasOwnProperty(n)&&(r&&Yn(n,e),Yn(t[n],e))}break;case"function":console.log(t)}}const Gd=new Uint8Array(new Uint16Array([1]).buffer)[0]==1;Ea=[Date,Set,Error,RegExp,ln,ArrayBuffer,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array>"u"?function(){}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array>"u"?function(){}:BigInt64Array,Float32Array,Float64Array,Aa];Ps=[{tag:1,encode(t,e){let n=t.getTime()/1e3;(this.useTimestamp32||t.getMilliseconds()===0)&&n>=0&&n<4294967296?(S[y++]=26,ye.setUint32(y,n),y+=4):(S[y++]=251,ye.setFloat64(y,n),y+=8)}},{tag:258,encode(t,e){let n=Array.from(t);e(n)}},{tag:27,encode(t,e){e([t.name,t.message])}},{tag:27,encode(t,e){e(["RegExp",t.source,t.flags])}},{getTag(t){return t.tag},encode(t,e){e(t.value)}},{encode(t,e,n){Ds(t,n)}},{getTag(t){if(t.constructor===Uint8Array&&(this.tagUint8Array||Dn&&this.tagUint8Array!==!1))return 64},encode(t,e,n){Ds(t,n)}},tt(68,1),tt(69,2),tt(70,4),tt(71,8),tt(72,1),tt(77,2),tt(78,4),tt(79,8),tt(85,4),tt(86,8),{encode(t,e){let n=t.packedValues||[],r=t.structures||[];if(n.values.length>0){S[y++]=216,S[y++]=51,rt(4);let s=n.values;e(s),rt(0),rt(0),packedObjectMap=Object.create(sharedPackedObjectMap||null);for(let i=0,o=s.length;i<o;i++)packedObjectMap[s[i]]=i}{ye.setUint32(y,3655335424),y+=3;let s=r.slice(0);s.unshift(57344),s.push(new ln(t.version,1399353956)),e(s)}}}];function tt(t,e){return!Gd&&e>1&&(t-=4),{tag:t,encode:function(r,s){let i=r.byteLength,o=r.byteOffset||0,a=r.buffer||r;s(Dn?Rr.from(a,o,i):new Uint8Array(a,o,i))}}}function Ds(t,e){let n=t.byteLength;n<24?S[y++]=64+n:n<256?(S[y++]=88,S[y++]=n):n<65536?(S[y++]=89,S[y++]=n>>8,S[y++]=n&255):(S[y++]=90,ye.setUint32(y,n),y+=4),y+n>=S.length&&e(y+n),S.set(t.buffer?t:new Uint8Array(t),y),y+=n}function Kd(t,e){let n,r=e.length*2,s=t.length-r;e.sort((i,o)=>i.offset>o.offset?1:-1);for(let i=0;i<e.length;i++){let o=e[i];o.id=i;for(let a of o.references)t[a++]=i>>8,t[a]=i&255}for(;n=e.pop();){let i=n.offset;t.copyWithin(i+r,i,s),r-=2;let o=i+r;t[o++]=216,t[o++]=28,s=i}return t}function oo(t,e){ye.setUint32(Se.position+t,y-Se.position-t+1);let n=Se;Se=null,e(n[0]),e(n[1])}let hi=new ka({useRecords:!1});hi.encode;hi.encodeAsIterable;hi.encodeAsAsyncIterable;const ao=512,Xd=1024,ns=2048;function Ca(t){return new ka({tagUint8Array:!1,useRecords:!1}).encode(t)}function Jd(t){return Sa(t)}const Yd=(t,e)=>t.length===e.length&&t.every((n,r)=>n===e[r]),gi=(t,e)=>Yd(t,e),Zd=async(t,e)=>{let n;const r=new Promise((s,i)=>{n=setTimeout(()=>i(new Qd(`withTimeout: timed out after ${e}ms`)),e)});try{return await Promise.race([t,r])}finally{clearTimeout(n)}};class Qd extends Error{constructor(e){super(e),this.name="TimeoutError"}}class eh extends un{documentId;#t;#e;#n;#r=6e4;#s={};constructor(e,n={}){super(),this.documentId=e,"timeoutDelay"in n&&n.timeoutDelay&&(this.#r=n.timeoutDelay);let r;const s="isNew"in n&&n.isNew;s?(r=sf(n.initialValue),r=Kl(r)):r=Ir(),this.#t=vt(`automerge-repo:dochandle:${this.documentId.slice(0,5)}`);const i=this.#r,o=wd({types:{context:{},events:{}},actions:{onUpdate:ks(({context:a,event:c})=>{const u=a.doc;gd(c,Vn);const{callback:f}=c.payload;return{doc:f(u)}}),onDelete:ks(()=>(this.emit("delete",{handle:this}),{doc:void 0})),onUnavailable:()=>{this.emit("unavailable",{handle:this})}}}).createMachine({initial:"idle",context:{documentId:e,doc:r},on:{UPDATE:{actions:"onUpdate"},DELETE:".deleted"},states:{idle:{on:{CREATE:"ready",FIND:"loading"}},loading:{on:{REQUEST:"requesting",DOC_READY:"ready",AWAIT_NETWORK:"awaitingNetwork"},after:{[i]:"unavailable"}},awaitingNetwork:{on:{NETWORK_READY:"requesting"}},requesting:{on:{DOC_UNAVAILABLE:"unavailable",DOC_READY:"ready"},after:{[i]:"unavailable"}},unavailable:{entry:"onUnavailable",on:{DOC_READY:"ready"}},ready:{},deleted:{entry:"onDelete",type:"final"}}});this.#e=Sn(o),this.#e.subscribe(a=>{const c=this.#n,u=a.context.doc;this.#t(`→ ${a.value} %o`,u),this.#c(c,u)}),this.#e.start(),this.#e.send(s?{type:nh}:{type:rh})}get#i(){return this.#e?.getSnapshot().context.doc}get#a(){return this.#e?.getSnapshot().value}#o(e){const n=Array.isArray(e)?e:[e];return bd(this.#e,r=>n.some(s=>r.matches(s)),{timeout:this.#r*2})}#c(e,n){if(n&&e&&!gi(Ye(n),Ye(e))){this.emit("heads-changed",{handle:this,doc:n});const s=Yl(n,Ye(e),Ye(n));s.length>0&&this.emit("change",{handle:this,doc:n,patches:s,patchInfo:{before:e,after:n,source:"change"}}),this.isReady()||this.#e.send({type:ih})}this.#n=n}get url(){return ui({documentId:this.documentId})}isReady=()=>this.inState(["ready"]);isDeleted=()=>this.inState(["deleted"]);isUnavailable=()=>this.inState(["unavailable"]);inState=e=>e.some(n=>this.#e.getSnapshot().matches(n));get state(){return this.#e.getSnapshot().value}async whenReady(e=["ready"]){await Zd(this.#o(e),this.#r)}async doc(e=["ready","unavailable"]){try{await this.#o(e)}catch{return}return this.isUnavailable()?void 0:this.#i}docSync(){if(this.isReady())return this.#i}heads(){if(this.isReady())return Ye(this.#i)}update(e){this.#e.send({type:Vn,payload:{callback:e}})}setRemoteHeads(e,n){this.#s[e]=n,this.emit("remote-heads",{storageId:e,heads:n})}getRemoteHeads(e){return this.#s[e]}change(e,n={}){if(!this.isReady())throw new Error(`DocHandle#${this.documentId} is not ready. Check \`handle.isReady()\` before accessing the document.`);this.#e.send({type:Vn,payload:{callback:r=>Wl(r,n,e)}})}changeAt(e,n,r={}){if(!this.isReady())throw new Error(`DocHandle#${this.documentId} is not ready. Check \`handle.isReady()\` before accessing the document.`);let s;return this.#e.send({type:Vn,payload:{callback:i=>{const o=Gl(i,e,r,n);return s=o.newHeads||void 0,o.newDoc}}}),s}merge(e){if(!this.isReady()||!e.isReady())throw new Error("Both handles must be ready to merge");const n=e.docSync();if(!n)throw new Error("The document to be merged in is falsy, aborting.");this.update(r=>Jl(r,n))}unavailable(){this.#e.send({type:uh})}request(){this.#a==="loading"&&this.#e.send({type:sh})}awaitNetwork(){this.#a==="loading"&&this.#e.send({type:oh})}networkReady(){this.#a==="awaitingNetwork"&&this.#e.send({type:ah})}delete(){this.#e.send({type:ch})}broadcast(e){this.emit("ephemeral-message-outbound",{handle:this,data:Ca(e)})}}const th={IDLE:"idle",LOADING:"loading",AWAITING_NETWORK:"awaitingNetwork",REQUESTING:"requesting",READY:"ready",DELETED:"deleted",UNAVAILABLE:"unavailable"},{IDLE:Ip,LOADING:Mp,AWAITING_NETWORK:Op,REQUESTING:qn,READY:rs,DELETED:Rp,UNAVAILABLE:co}=th,nh="CREATE",rh="FIND",sh="REQUEST",ih="DOC_READY",oh="AWAIT_NETWORK",ah="NETWORK_READY",Vn="UPDATE",ch="DELETE",uh="DOC_UNAVAILABLE";class lh extends un{#t=new Map;#e=new Set;#n=new Map;#r=new Set;#s=new Map;#i=vt("automerge-repo:remote-heads-subscriptions");subscribeToRemotes(e){this.#i("subscribeToRemotes",e);const n=[];for(const r of e)this.#e.has(r)||(this.#e.add(r),n.push(r));n.length>0&&this.emit("change-remote-subs",{add:n,peers:Array.from(this.#r)})}unsubscribeFromRemotes(e){this.#i("subscribeToRemotes",e);const n=[];for(const r of e)this.#e.has(r)&&(this.#e.delete(r),this.#n.has(r)||n.push(r));n.length>0&&this.emit("change-remote-subs",{remove:n,peers:Array.from(this.#r)})}handleControlMessage(e){const n=[],r=[],s=[];if(this.#i("handleControlMessage",e),e.add)for(const i of e.add){let o=this.#n.get(i);(this.#e.has(i)||o)&&s.push(i),o||(o=new Set,this.#n.set(i,o),this.#e.has(i)||n.push(i)),o.add(e.senderId)}if(e.remove)for(const i of e.remove){const o=this.#n.get(i);o&&(o.delete(e.senderId),o.size==0&&!this.#e.has(i)&&r.push(i))}(n.length>0||r.length>0)&&this.emit("change-remote-subs",{peers:Array.from(this.#r),add:n,remove:r});for(const i of s){const o=this.#s.get(e.senderId);if(o)for(const a of o){const c=this.#t.get(a);if(!c)continue;const u=c.get(i);u&&this.emit("notify-remote-heads",{targetId:e.senderId,documentId:a,heads:u.heads,timestamp:u.timestamp,storageId:i})}}}handleRemoteHeads(e){this.#i("handleRemoteHeads",e);const n=this.#o(e);for(const r of n)this.#e.has(r.storageId)&&this.emit("remote-heads-changed",r);for(const r of n)for(const s of this.#r)s!==e.senderId&&this.emit("notify-remote-heads",{targetId:s,documentId:r.documentId,heads:r.remoteHeads,timestamp:r.timestamp,storageId:r.storageId});for(const r of n){const s=this.#n.get(r.storageId);if(s)for(const i of s)this.#a(i,r.documentId)&&this.emit("notify-remote-heads",{targetId:i,documentId:r.documentId,heads:r.remoteHeads,timestamp:r.timestamp,storageId:r.storageId})}}handleImmediateRemoteHeadsChanged(e,n,r){this.#i("handleLocalHeadsChanged",e,n,r);const s=this.#t.get(e),i=Date.now();if(!s)this.#t.set(e,new Map([[n,{heads:r,timestamp:i}]]));else{const a=s.get(n);(!a||a.timestamp<Date.now())&&s.set(n,{heads:r,timestamp:Date.now()})}const o=this.#n.get(n);if(o)for(const a of o)this.#a(a,e)&&this.emit("notify-remote-heads",{targetId:a,documentId:e,heads:r,timestamp:i,storageId:n})}addGenerousPeer(e){this.#i("addGenerousPeer",e),this.#r.add(e),this.#e.size>0&&this.emit("change-remote-subs",{add:Array.from(this.#e),peers:[e]});for(const[n,r]of this.#t)for(const[s,{heads:i,timestamp:o}]of r)this.emit("notify-remote-heads",{targetId:e,documentId:n,heads:i,timestamp:o,storageId:s})}removePeer(e){this.#i("removePeer",e);const n=[];this.#r.delete(e),this.#s.delete(e);for(const[r,s]of this.#n)s.has(e)&&(s.delete(e),s.size==0&&(n.push(r),this.#n.delete(r)));n.length>0&&this.emit("change-remote-subs",{remove:n,peers:Array.from(this.#r)})}subscribePeerToDoc(e,n){let r=this.#s.get(e);r||(r=new Set,this.#s.set(e,r)),r.add(n);const s=this.#t.get(n);if(s)for(const[i,o]of s){const a=this.#n.get(i);a&&a.has(e)&&this.emit("notify-remote-heads",{targetId:e,documentId:n,heads:o.heads,timestamp:o.timestamp,storageId:i})}}#a(e,n){const r=this.#s.get(e);return r&&r.has(n)}#o(e){const n=[],{documentId:r,newHeads:s}=e;for(const[i,{heads:o,timestamp:a}]of Object.entries(s)){if(!this.#e.has(i)&&!this.#n.has(i))continue;let c=this.#t.get(r);c||(c=new Map,this.#t.set(r,c));const u=c.get(i);u&&u.timestamp>=a||(c.set(i,{timestamp:a,heads:o}),n.push({documentId:r,storageId:i,remoteHeads:o,timestamp:a}))}return n}}const $s=(t,e)=>{let n=Date.now(),r,s;return function(...i){r=n+e-Date.now(),clearTimeout(s),s=setTimeout(()=>{t(...i),n=Date.now()},r)}},fh=t=>hh(t)||Ia(t)||Ta(t)||dh(t)||gh(t)||_h(t),dh=t=>t.type==="doc-unavailable",Ta=t=>t.type==="request",hh=t=>t.type==="sync",Ia=t=>t.type==="ephemeral",gh=t=>t.type==="remote-subscription-change",_h=t=>t.type==="remote-heads-changed",ph=t=>`${t.senderId}:${t.sessionId}`;class yh extends un{peerId;peerMetadata;#t;#e={};#n=0;#r=Math.random().toString(36).slice(2);#s={};#i=0;#a=[];constructor(e,n=wh(),r){super(),this.peerId=n,this.peerMetadata=r,this.#t=vt(`automerge-repo:network:${this.peerId}`),e.forEach(s=>this.addNetworkAdapter(s))}addNetworkAdapter(e){this.#a.push(e),e.once("ready",()=>{this.#i++,this.#t("Adapters ready: ",this.#i,"/",this.#a.length),this.#i===this.#a.length&&this.emit("ready")}),e.on("peer-candidate",({peerId:n,peerMetadata:r})=>{this.#t(`peer candidate: ${n} `),this.#e[n]||(this.#e[n]=e),this.emit("peer",{peerId:n,peerMetadata:r})}),e.on("peer-disconnected",({peerId:n})=>{this.#t(`peer disconnected: ${n} `),delete this.#e[n],this.emit("peer-disconnected",{peerId:n})}),e.on("message",n=>{if(!fh(n)){this.#t(`invalid message: ${JSON.stringify(n)}`);return}if(this.#t(`message from ${n.senderId}`),Ia(n)){const r=ph(n);(this.#s[r]===void 0||n.count>this.#s[r])&&(this.#s[r]=n.count,this.emit("message",n));return}this.emit("message",n)}),e.on("close",()=>{this.#t("adapter closed"),Object.entries(this.#e).forEach(([n,r])=>{r===e&&delete this.#e[n]})}),this.peerMetadata.then(n=>{e.connect(this.peerId,n)}).catch(n=>{this.#t("error connecting to network",n)})}send(e){const n=this.#e[e.targetId];if(!n){this.#t(`Tried to send message but peer not found: ${e.targetId}`);return}const s=(i=>i.type==="ephemeral"?"count"in i?i:{...i,count:++this.#n,sessionId:this.#r,senderId:this.peerId}:{...i,senderId:this.peerId})(e);this.#t("sending message %o",s),n.send(s)}isReady=()=>this.#i===this.#a.length;whenReady=async()=>{if(!this.isReady())return new Promise(e=>{this.once("ready",()=>{e()})})}}function wh(){return`user-${Math.round(Math.random()*1e5)}`}function Ma(t){let e=0;t.forEach(s=>{e+=s.length});const n=new Uint8Array(e);let r=0;return t.forEach(s=>{n.set(s,r),r+=s.length}),n}var Zn={exports:{}},mh=Zn.exports,uo;function bh(){return uo||(uo=1,function(t){(function(e,n){var r={};n(r);var s=r.default;for(var i in r)s[i]=r[i];t.exports=s})(mh,function(e){e.__esModule=!0,e.digestLength=32,e.blockSize=64;var n=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function r(d,h,g,w,x){for(var v,M,k,F,A,q,Y,U,H,V,I,W,m;x>=64;){for(v=h[0],M=h[1],k=h[2],F=h[3],A=h[4],q=h[5],Y=h[6],U=h[7],V=0;V<16;V++)I=w+V*4,d[V]=(g[I]&255)<<24|(g[I+1]&255)<<16|(g[I+2]&255)<<8|g[I+3]&255;for(V=16;V<64;V++)H=d[V-2],W=(H>>>17|H<<15)^(H>>>19|H<<13)^H>>>10,H=d[V-15],m=(H>>>7|H<<25)^(H>>>18|H<<14)^H>>>3,d[V]=(W+d[V-7]|0)+(m+d[V-16]|0);for(V=0;V<64;V++)W=(((A>>>6|A<<26)^(A>>>11|A<<21)^(A>>>25|A<<7))+(A&q^~A&Y)|0)+(U+(n[V]+d[V]|0)|0)|0,m=((v>>>2|v<<30)^(v>>>13|v<<19)^(v>>>22|v<<10))+(v&M^v&k^M&k)|0,U=Y,Y=q,q=A,A=F+W|0,F=k,k=M,M=v,v=W+m|0;h[0]+=v,h[1]+=M,h[2]+=k,h[3]+=F,h[4]+=A,h[5]+=q,h[6]+=Y,h[7]+=U,w+=64,x-=64}return w}var s=function(){function d(){this.digestLength=e.digestLength,this.blockSize=e.blockSize,this.state=new Int32Array(8),this.temp=new Int32Array(64),this.buffer=new Uint8Array(128),this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this.reset()}return d.prototype.reset=function(){return this.state[0]=1779033703,this.state[1]=3144134277,this.state[2]=1013904242,this.state[3]=2773480762,this.state[4]=1359893119,this.state[5]=2600822924,this.state[6]=528734635,this.state[7]=1541459225,this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this},d.prototype.clean=function(){for(var h=0;h<this.buffer.length;h++)this.buffer[h]=0;for(var h=0;h<this.temp.length;h++)this.temp[h]=0;this.reset()},d.prototype.update=function(h,g){if(g===void 0&&(g=h.length),this.finished)throw new Error("SHA256: can't update because hash was finished.");var w=0;if(this.bytesHashed+=g,this.bufferLength>0){for(;this.bufferLength<64&&g>0;)this.buffer[this.bufferLength++]=h[w++],g--;this.bufferLength===64&&(r(this.temp,this.state,this.buffer,0,64),this.bufferLength=0)}for(g>=64&&(w=r(this.temp,this.state,h,w,g),g%=64);g>0;)this.buffer[this.bufferLength++]=h[w++],g--;return this},d.prototype.finish=function(h){if(!this.finished){var g=this.bytesHashed,w=this.bufferLength,x=g/536870912|0,v=g<<3,M=g%64<56?64:128;this.buffer[w]=128;for(var k=w+1;k<M-8;k++)this.buffer[k]=0;this.buffer[M-8]=x>>>24&255,this.buffer[M-7]=x>>>16&255,this.buffer[M-6]=x>>>8&255,this.buffer[M-5]=x>>>0&255,this.buffer[M-4]=v>>>24&255,this.buffer[M-3]=v>>>16&255,this.buffer[M-2]=v>>>8&255,this.buffer[M-1]=v>>>0&255,r(this.temp,this.state,this.buffer,0,M),this.finished=!0}for(var k=0;k<8;k++)h[k*4+0]=this.state[k]>>>24&255,h[k*4+1]=this.state[k]>>>16&255,h[k*4+2]=this.state[k]>>>8&255,h[k*4+3]=this.state[k]>>>0&255;return this},d.prototype.digest=function(){var h=new Uint8Array(this.digestLength);return this.finish(h),h},d.prototype._saveState=function(h){for(var g=0;g<this.state.length;g++)h[g]=this.state[g]},d.prototype._restoreState=function(h,g){for(var w=0;w<this.state.length;w++)this.state[w]=h[w];this.bytesHashed=g,this.finished=!1,this.bufferLength=0},d}();e.Hash=s;var i=function(){function d(h){this.inner=new s,this.outer=new s,this.blockSize=this.inner.blockSize,this.digestLength=this.inner.digestLength;var g=new Uint8Array(this.blockSize);if(h.length>this.blockSize)new s().update(h).finish(g).clean();else for(var w=0;w<h.length;w++)g[w]=h[w];for(var w=0;w<g.length;w++)g[w]^=54;this.inner.update(g);for(var w=0;w<g.length;w++)g[w]^=106;this.outer.update(g),this.istate=new Uint32Array(8),this.ostate=new Uint32Array(8),this.inner._saveState(this.istate),this.outer._saveState(this.ostate);for(var w=0;w<g.length;w++)g[w]=0}return d.prototype.reset=function(){return this.inner._restoreState(this.istate,this.inner.blockSize),this.outer._restoreState(this.ostate,this.outer.blockSize),this},d.prototype.clean=function(){for(var h=0;h<this.istate.length;h++)this.ostate[h]=this.istate[h]=0;this.inner.clean(),this.outer.clean()},d.prototype.update=function(h){return this.inner.update(h),this},d.prototype.finish=function(h){return this.outer.finished?this.outer.finish(h):(this.inner.finish(h),this.outer.update(h,this.digestLength).finish(h)),this},d.prototype.digest=function(){var h=new Uint8Array(this.digestLength);return this.finish(h),h},d}();e.HMAC=i;function o(d){var h=new s().update(d),g=h.digest();return h.clean(),g}e.hash=o,e.default=o;function a(d,h){var g=new i(d).update(h),w=g.digest();return g.clean(),w}e.hmac=a;function c(d,h,g,w){var x=w[0];if(x===0)throw new Error("hkdf: cannot expand more");h.reset(),x>1&&h.update(d),g&&h.update(g),h.update(w),h.finish(d),w[0]++}var u=new Uint8Array(e.digestLength);function f(d,h,g,w){h===void 0&&(h=u),w===void 0&&(w=32);for(var x=new Uint8Array([1]),v=a(h,d),M=new i(v),k=new Uint8Array(M.digestLength),F=k.length,A=new Uint8Array(w),q=0;q<w;q++)F===k.length&&(c(k,M,g,x),F=0),A[q]=k[F++];return M.clean(),k.fill(0),x.fill(0),A}e.hkdf=f;function l(d,h,g,w){for(var x=new i(d),v=x.digestLength,M=new Uint8Array(4),k=new Uint8Array(v),F=new Uint8Array(v),A=new Uint8Array(w),q=0;q*v<w;q++){var Y=q+1;M[0]=Y>>>24&255,M[1]=Y>>>16&255,M[2]=Y>>>8&255,M[3]=Y>>>0&255,x.reset(),x.update(h),x.update(M),x.finish(F);for(var U=0;U<v;U++)k[U]=F[U];for(var U=2;U<=g;U++){x.reset(),x.update(F).finish(F);for(var H=0;H<v;H++)k[H]^=F[H]}for(var U=0;U<v&&q*v+U<w;U++)A[q*v+U]=k[U]}for(var q=0;q<v;q++)k[q]=F[q]=0;for(var q=0;q<4;q++)M[q]=0;return x.clean(),A}e.pbkdf2=l})}(Zn)),Zn.exports}var vh=bh();function Oa(t){const e=vh.hash(t);return Sh(e)}function xh(t){const e=new TextEncoder,n=Ma(t.map(r=>e.encode(r)));return Oa(n)}function Sh(t){return Array.from(t,e=>e.toString(16).padStart(2,"0")).join("")}function Eh(t){if(t.length<2)return null;const e=t[t.length-2];return e==="snapshot"||e==="incremental"?e:null}class kh{#t;#e=new Map;#n=new Map;#r=!1;#s=vt("automerge-repo:storage-subsystem");constructor(e){this.#t=e}async id(){const e=await this.#t.load(["storage-adapter-id"]);let n;return e?n=new TextDecoder().decode(e):(n=Lo(),await this.#t.save(["storage-adapter-id"],new TextEncoder().encode(n))),n}async load(e,n){const r=[e,n];return await this.#t.load(r)}async save(e,n,r){const s=[e,n];await this.#t.save(s,r)}async remove(e,n){const r=[e,n];await this.#t.remove(r)}async loadDoc(e){const n=await this.#t.loadRange([e]),r=[],s=[];for(const a of n){if(a.data===void 0)continue;const c=Eh(a.key);c!=null&&(s.push({key:a.key,type:c,size:a.data.length}),r.push(a.data))}this.#n.set(e,s);const i=Ma(r);if(i.length===0)return null;const o=Fo(Ir(),i);return this.#e.set(e,Ye(o)),o}async saveDoc(e,n){if(!this.#o(e,n))return;const r=this.#n.get(e)??[];this.#c(r)?await this.#a(e,n,r):await this.#i(e,n),this.#e.set(e,Ye(n))}async removeDoc(e){await this.#t.removeRange([e,"snapshot"]),await this.#t.removeRange([e,"incremental"]),await this.#t.removeRange([e,"sync-state"])}async#i(e,n){const r=rf(n,this.#e.get(e)??[]);if(r&&r.length>0){const s=[e,"incremental",Oa(r)];this.#s(`Saving incremental ${s} for document ${e}`),await this.#t.save(s,r),this.#n.has(e)||this.#n.set(e,[]),this.#n.get(e).push({key:s,type:"incremental",size:r.length}),this.#e.set(e,Ye(n))}else return Promise.resolve()}async#a(e,n,r){this.#r=!0;const s=qo(n),i=xh(Ye(n)),o=[e,"snapshot",i],a=new Set(r.map(u=>u.key).filter(u=>u[2]!==i));this.#s(`Saving snapshot ${o} for document ${e}`),this.#s(`deleting old chunks ${Array.from(a)}`),await this.#t.save(o,s);for(const u of a)await this.#t.remove(u);const c=this.#n.get(e)?.filter(u=>!a.has(u.key))??[];c.push({key:o,type:"snapshot",size:s.length}),this.#n.set(e,c),this.#r=!1}async loadSyncState(e,n){const r=[e,"sync-state",n],s=await this.#t.load(r);return s?zo(s):void 0}async saveSyncState(e,n,r){const s=[e,"sync-state",n];await this.#t.save(s,Vo(r))}#o(e,n){const r=this.#e.get(e);if(!r)return!0;const s=Ye(n);return!gi(s,r)}#c(e){if(this.#r)return!1;let n=0,r=0;for(const s of e)s.type==="snapshot"?n+=s.size:r+=s.size;return n<1024||r>=n}}class Ra extends un{}class Ah extends Ra{#t;syncDebounceRate=100;#e=[];#n={};#r={};#s={};#i=[];#a=!1;#o;#c;constructor({handle:e,onLoadSyncState:n}){super(),this.#o=e,this.#c=n??(()=>Promise.resolve(void 0));const r=e.documentId.slice(0,5);this.#t=vt(`automerge-repo:docsync:${r}`),e.on("change",$s(()=>this.#_(),this.syncDebounceRate)),e.on("ephemeral-message-outbound",s=>this.#p(s)),(async()=>(await e.doc([rs,qn]),this.#g()))()}get peerStates(){return this.#r}get documentId(){return this.#o.documentId}async#_(){this.#t("syncWithPeers");const e=await this.#o.doc();e!==void 0&&this.#e.forEach(n=>this.#d(n,e))}async#p({data:e}){this.#t("broadcastToPeers",this.#e),this.#e.forEach(n=>this.#y(n,e))}#y(e,n){this.#t(`sendEphemeralMessage ->${e}`);const r={type:"ephemeral",targetId:e,documentId:this.#o.documentId,data:n};this.emit("message",r)}#l(e,n){this.#w(e),e in this.#r||(this.#r[e]="unknown");const r=this.#s[e];if(r){n(r);return}let s=this.#n[e];s||(this.#c(e).then(i=>{this.#m(e,i??tf())}).catch(i=>{this.#t(`Error loading sync state for ${e}: ${i}`)}),s=this.#n[e]=[]),s.push(n)}#w(e){this.#e.includes(e)||(this.#e.push(e),this.emit("open-doc",{documentId:this.documentId,peerId:e}))}#m(e,n){const r=this.#n[e];if(r)for(const s of r)s(n);delete this.#n[e],this.#s[e]=n}#f(e,n){this.#s[e]=n,this.emit("sync-state",{peerId:e,syncState:n,documentId:this.#o.documentId})}#d(e,n){this.#t(`sendSyncMessage ->${e}`),this.#l(e,r=>{const[s,i]=Ql(n,r);if(i){this.#f(e,s);const o=Ye(n).length===0;!this.#o.isReady()&&o&&s.sharedHeads.length===0&&!Object.values(this.#r).includes("has")&&this.#r[e]==="unknown"?this.emit("message",{type:"request",targetId:e,documentId:this.#o.documentId,data:i}):this.emit("message",{type:"sync",targetId:e,data:i,documentId:this.#o.documentId}),o||(this.#r[e]="has")}})}hasPeer(e){return this.#e.includes(e)}beginSync(e){const n=e.every(s=>this.#r[s]in["unavailable","wants"]),r=this.#o.doc([rs,qn,co]).then(s=>{if(this.#a=!0,this.#u(),!(s===void 0&&n))return s??Ir()});this.#t(`beginSync: ${e.join(", ")}`),e.forEach(s=>{this.#l(s,i=>{const o=zo(Vo(i));this.#f(s,o),r.then(a=>{a&&this.#d(s,a)}).catch(a=>{this.#t(`Error loading doc for ${s}: ${a}`)})})})}endSync(e){this.#t(`removing peer ${e}`),this.#e=this.#e.filter(n=>n!==e)}receiveMessage(e){switch(e.type){case"sync":case"request":this.receiveSyncMessage(e);break;case"ephemeral":this.receiveEphemeralMessage(e);break;case"doc-unavailable":this.#r[e.senderId]="unavailable",this.#u();break;default:throw new Error(`unknown message type: ${e}`)}}receiveEphemeralMessage(e){if(e.documentId!==this.#o.documentId)throw new Error("channelId doesn't match documentId");const{senderId:n,data:r}=e,s=Sa(new Uint8Array(r));this.#o.emit("ephemeral-message",{handle:this.#o,senderId:n,message:s}),this.#e.forEach(i=>{i!==n&&this.emit("message",{...e,targetId:i})})}receiveSyncMessage(e){if(e.documentId!==this.#o.documentId)throw new Error("channelId doesn't match documentId");if(!this.#o.inState([rs,qn,co])){this.#i.push({message:e,received:new Date});return}this.#g(),this.#h(e)}#h(e){Ta(e)&&(this.#r[e.senderId]="wants"),this.#u(),nf(e.data).heads.length>0&&(this.#r[e.senderId]="has"),this.#l(e.senderId,n=>{this.#o.update(r=>{const[s,i]=ef(r,n,e.data);return this.#f(e.senderId,i),this.#d(e.senderId,r),s}),this.#u()})}#u(){this.#a&&this.#o.inState([qn])&&this.#e.every(e=>this.#r[e]==="unavailable"||this.#r[e]==="wants")&&(this.#e.filter(e=>this.#r[e]==="wants").forEach(e=>{const n={type:"doc-unavailable",documentId:this.#o.documentId,targetId:e};this.emit("message",n)}),this.#o.unavailable())}#g(){for(const e of this.#i)this.#h(e.message);this.#i=[]}}const ss=vt("automerge-repo:collectionsync");class Ch extends Ra{repo;#t=new Set;#e={};#n={};constructor(e){super(),this.repo=e}#r(e){if(!this.#e[e]){const n=this.repo.find(ui({documentId:e}));this.#e[e]=this.#s(n)}return this.#e[e]}#s(e){const n=new Ah({handle:e,onLoadSyncState:async r=>{if(!this.repo.storageSubsystem)return;const{storageId:s,isEphemeral:i}=this.repo.peerMetadataByPeerId[r]||{};if(!(!s||i))return this.repo.storageSubsystem.loadSyncState(e.documentId,s)}});return n.on("message",r=>this.emit("message",r)),n.on("open-doc",r=>this.emit("open-doc",r)),n.on("sync-state",r=>this.emit("sync-state",r)),n}async#i(e){const n=Array.from(this.#t),r=[];for(const s of n)await this.repo.sharePolicy(s,e)&&r.push(s);return r}async receiveMessage(e){ss(`onSyncMessage: ${e.senderId}, ${e.documentId}, ${"data"in e?e.data.byteLength+"bytes":""}`);const n=e.documentId;if(!n)throw new Error("received a message with an invalid documentId");this.#n[n]=!0;const r=this.#r(n);r.receiveMessage(e);const s=await this.#i(n);r.beginSync(s.filter(i=>!r.hasPeer(i)))}addDocument(e){if(this.#n[e])return;const n=this.#r(e);this.#i(e).then(r=>{n.beginSync(r)})}removeDocument(e){throw new Error("not implemented")}addPeer(e){if(ss(`adding ${e} & synchronizing with them`),!this.#t.has(e)){this.#t.add(e);for(const n of Object.values(this.#e)){const{documentId:r}=n;this.repo.sharePolicy(e,r).then(s=>{s&&n.beginSync([e])})}}}removePeer(e){ss(`removing peer ${e}`),this.#t.delete(e);for(const n of Object.values(this.#e))n.endSync(e)}get peers(){return Array.from(this.#t)}}class Th extends un{#t;networkSubsystem;storageSubsystem;saveDebounceRate=100;#e={};#n;sharePolicy=async()=>!0;peerMetadataByPeerId={};#r=new lh;#s=!1;constructor({storage:e,network:n=[],peerId:r,sharePolicy:s,isEphemeral:i=e===void 0,enableRemoteHeadsGossiping:o=!1}={}){super(),this.#s=o,this.#t=vt("automerge-repo:repo"),this.sharePolicy=s??this.sharePolicy,this.on("document",async({handle:f,isNew:l})=>{if(a){const d=({handle:h,doc:g})=>{a.saveDoc(h.documentId,g)};if(f.on("heads-changed",$s(d,this.saveDebounceRate)),l)await a.saveDoc(f.documentId,f.docSync());else{const h=await a.loadDoc(f.documentId);h&&f.update(()=>h)}}f.on("unavailable",()=>{this.#t("document unavailable",{documentId:f.documentId}),this.emit("unavailable-document",{documentId:f.documentId})}),this.networkSubsystem.isReady()?f.request():(f.awaitNetwork(),this.networkSubsystem.whenReady().then(()=>{f.networkReady()}).catch(d=>{this.#t("error waiting for network",{err:d})})),this.#n.addDocument(f.documentId)}),this.on("delete-document",({documentId:f})=>{a&&a.removeDoc(f).catch(l=>{this.#t("error deleting document",{documentId:f,err:l})})}),this.#n=new Ch(this),this.#n.on("message",f=>{this.#t(`sending ${f.type} message to ${f.targetId}`),u.send(f)}),this.#s&&this.#n.on("open-doc",({peerId:f,documentId:l})=>{this.#r.subscribePeerToDoc(f,l)});const a=e?new kh(e):void 0;this.storageSubsystem=a;const c=(async()=>({storageId:await a?.id(),isEphemeral:i}))(),u=new yh(n,r,c);this.networkSubsystem=u,u.on("peer",async({peerId:f,peerMetadata:l})=>{this.#t("peer connected",{peerId:f}),l&&(this.peerMetadataByPeerId[f]={...l}),this.sharePolicy(f).then(d=>{d&&this.#s&&this.#r.addGenerousPeer(f)}).catch(d=>{console.log("error in share policy",{err:d})}),this.#n.addPeer(f)}),u.on("peer-disconnected",({peerId:f})=>{this.#n.removePeer(f),this.#r.removePeer(f)}),u.on("message",async f=>{this.#i(f)}),this.#n.on("sync-state",f=>{this.#o(f);const l=this.#e[f.documentId],{storageId:d}=this.peerMetadataByPeerId[f.peerId]||{};if(!d)return;const h=l.getRemoteHeads(d);f.syncState.theirHeads&&(!h||!gi(h,f.syncState.theirHeads))&&f.syncState.theirHeads&&(l.setRemoteHeads(d,f.syncState.theirHeads),d&&this.#s&&this.#r.handleImmediateRemoteHeadsChanged(f.documentId,d,f.syncState.theirHeads))}),this.#s&&(this.#r.on("notify-remote-heads",f=>{this.networkSubsystem.send({type:"remote-heads-changed",targetId:f.targetId,documentId:f.documentId,newHeads:{[f.storageId]:{heads:f.heads,timestamp:f.timestamp}}})}),this.#r.on("change-remote-subs",f=>{this.#t("change-remote-subs",f);for(const l of f.peers)this.networkSubsystem.send({type:"remote-subscription-change",targetId:l,add:f.add,remove:f.remove})}),this.#r.on("remote-heads-changed",f=>{this.#e[f.documentId].setRemoteHeads(f.storageId,f.remoteHeads)}))}#i(e){switch(e.type){case"remote-subscription-change":this.#s&&this.#r.handleControlMessage(e);break;case"remote-heads-changed":this.#s&&this.#r.handleRemoteHeads(e);break;case"sync":case"request":case"ephemeral":case"doc-unavailable":this.#n.receiveMessage(e).catch(n=>{console.log("error receiving message",{err:n})})}}#a={};#o(e){if(!this.storageSubsystem)return;const{storageId:n,isEphemeral:r}=this.peerMetadataByPeerId[e.peerId]||{};if(!n||r)return;let s=this.#a[n];s||(s=this.#a[n]=$s(({documentId:i,syncState:o})=>{this.storageSubsystem.saveSyncState(i,n,o)},this.saveDebounceRate)),s(e)}#c({documentId:e,isNew:n,initialValue:r}){if(this.#e[e])return this.#e[e];if(!e)throw new Error(`Invalid documentId ${e}`);const s=new eh(e,{isNew:n,initialValue:r});return this.#e[e]=s,s}get handles(){return this.#e}get peers(){return this.#n.peers}getStorageIdOfPeer(e){return this.peerMetadataByPeerId[e]?.storageId}create(e){const{documentId:n}=ci(Md()),r=this.#c({documentId:n,isNew:!0,initialValue:e});return this.emit("document",{handle:r,isNew:!0}),r}clone(e){if(!e.isReady())throw new Error(`Cloned handle is not yet in ready state.
        (Try await handle.waitForReady() first.)`);const n=e.docSync();if(!n)throw new Error("Cloned handle doesn't have a document.");const r=this.create();return r.update(()=>Ti(n)),r}find(e){const n=Zr(e);if(this.#e[n])return this.#e[n].isUnavailable()&&setTimeout(()=>{this.#e[n].emit("unavailable",{handle:this.#e[n]})}),this.#e[n];const r=this.#c({documentId:n,isNew:!1});return this.emit("document",{handle:r,isNew:!1}),r}delete(e){const n=Zr(e);this.#c({documentId:n,isNew:!1}).delete(),delete this.#e[n],this.emit("delete-document",{documentId:n})}async export(e){const n=Zr(e),s=await this.#c({documentId:n,isNew:!1}).doc();if(s)return qo(s)}import(e){const n=of(e),r=this.create();return r.update(()=>Ti(n)),r}subscribeToRemotes=e=>{this.#s?(this.#t("subscribeToRemotes",{remotes:e}),this.#r.subscribeToRemotes(e)):this.#t("WARN: subscribeToRemotes called but remote heads gossiping is not enabled")};storageId=async()=>{if(this.storageSubsystem)return this.storageSubsystem.id()};async flush(e){if(!this.storageSubsystem)return;const n=e?e.map(r=>this.#e[r]):Object.values(this.#e);await Promise.all(n.map(async r=>{const s=r.docSync();if(s)return this.storageSubsystem.saveDoc(r.documentId,s)}))}}class Ih extends un{peerId;peerMetadata}const Mh=""+new URL("automerge_wasm_bg-BEjDkhWo.wasm",import.meta.url).href,Oh=async(t={},e)=>{let n;if(e.startsWith("data:")){const r=e.replace(/^data:.*?base64,/,"");let s;if(typeof Buffer=="function"&&typeof Buffer.from=="function")s=Buffer.from(r,"base64");else if(typeof atob=="function"){const i=atob(r);s=new Uint8Array(i.length);for(let o=0;o<i.length;o++)s[o]=i.charCodeAt(o)}else throw new Error("Cannot decode base64-encoded data URL");n=await WebAssembly.instantiate(s,t)}else{const r=await fetch(e),s=r.headers.get("Content-Type")||"";if("instantiateStreaming"in WebAssembly&&s.startsWith("application/wasm"))n=await WebAssembly.instantiateStreaming(r,t);else{const i=await r.arrayBuffer();n=await WebAssembly.instantiate(i,t)}}return n.instance.exports};let p;function Pa(t){p=t}const _t=new Array(128).fill(void 0);_t.push(void 0,null,!0,!1);function N(t){return _t[t]}let mn=_t.length;function Rh(t){t<132||(_t[t]=mn,mn=t)}function P(t){const e=N(t);return Rh(t),e}let Ge=0,zn=null;function Qn(){return(zn===null||zn.byteLength===0)&&(zn=new Uint8Array(p.memory.buffer)),zn}const Ph=typeof TextEncoder>"u"?(0,module.require)("util").TextEncoder:TextEncoder;let er=new Ph("utf-8");const Dh=typeof er.encodeInto=="function"?function(t,e){return er.encodeInto(t,e)}:function(t,e){const n=er.encode(t);return e.set(n),{read:t.length,written:n.length}};function ot(t,e,n){if(n===void 0){const a=er.encode(t),c=e(a.length,1)>>>0;return Qn().subarray(c,c+a.length).set(a),Ge=a.length,c}let r=t.length,s=e(r,1)>>>0;const i=Qn();let o=0;for(;o<r;o++){const a=t.charCodeAt(o);if(a>127)break;i[s+o]=a}if(o!==r){o!==0&&(t=t.slice(o)),s=n(s,r,r=o+t.length*3,1)>>>0;const a=Qn().subarray(s+o,s+r),c=Dh(t,a);o+=c.written,s=n(s,r,o,1)>>>0}return Ge=o,s}function _e(t){return t==null}let Wn=null;function b(){return(Wn===null||Wn.byteLength===0)&&(Wn=new Int32Array(p.memory.buffer)),Wn}const $h=typeof TextDecoder>"u"?(0,module.require)("util").TextDecoder:TextDecoder;let Da=new $h("utf-8",{ignoreBOM:!0,fatal:!0});Da.decode();function Ne(t,e){return t=t>>>0,Da.decode(Qn().subarray(t,t+e))}function E(t){mn===_t.length&&_t.push(_t.length+1);const e=mn;return mn=_t[e],_t[e]=t,e}let Gn=null;function tr(){return(Gn===null||Gn.byteLength===0)&&(Gn=new Float64Array(p.memory.buffer)),Gn}function Bs(t){const e=typeof t;if(e=="number"||e=="boolean"||t==null)return`${t}`;if(e=="string")return`"${t}"`;if(e=="symbol"){const s=t.description;return s==null?"Symbol":`Symbol(${s})`}if(e=="function"){const s=t.name;return typeof s=="string"&&s.length>0?`Function(${s})`:"Function"}if(Array.isArray(t)){const s=t.length;let i="[";s>0&&(i+=Bs(t[0]));for(let o=1;o<s;o++)i+=", "+Bs(t[o]);return i+="]",i}const n=/\[object ([^\]]+)\]/.exec(toString.call(t));let r;if(n.length>1)r=n[1];else return toString.call(t);if(r=="Object")try{return"Object("+JSON.stringify(t)+")"}catch{return"Object"}return t instanceof Error?`${t.name}: ${t.message}
${t.stack}`:r}function Pt(t,e){if(!(t instanceof e))throw new Error(`expected instance of ${e.name}`);return t.ptr}function Bh(t){try{const s=p.__wbindgen_add_to_stack_pointer(-16);p.create(s,E(t));var e=b()[s/4+0],n=b()[s/4+1],r=b()[s/4+2];if(r)throw P(n);return st.__wrap(e)}finally{p.__wbindgen_add_to_stack_pointer(16)}}function jh(t,e){try{const i=p.__wbindgen_add_to_stack_pointer(-16);p.load(i,E(t),E(e));var n=b()[i/4+0],r=b()[i/4+1],s=b()[i/4+2];if(s)throw P(r);return st.__wrap(n)}finally{p.__wbindgen_add_to_stack_pointer(16)}}function Lh(t){try{const s=p.__wbindgen_add_to_stack_pointer(-16);p.encodeChange(s,E(t));var e=b()[s/4+0],n=b()[s/4+1],r=b()[s/4+2];if(r)throw P(n);return P(e)}finally{p.__wbindgen_add_to_stack_pointer(16)}}function Uh(t){try{const s=p.__wbindgen_add_to_stack_pointer(-16);p.decodeChange(s,E(t));var e=b()[s/4+0],n=b()[s/4+1],r=b()[s/4+2];if(r)throw P(n);return P(e)}finally{p.__wbindgen_add_to_stack_pointer(16)}}function Nh(){const t=p.initSyncState();return Ke.__wrap(t)}function Hh(t){try{const s=p.__wbindgen_add_to_stack_pointer(-16);p.importSyncState(s,E(t));var e=b()[s/4+0],n=b()[s/4+1],r=b()[s/4+2];if(r)throw P(n);return Ke.__wrap(e)}finally{p.__wbindgen_add_to_stack_pointer(16)}}function Fh(t){Pt(t,Ke);const e=p.exportSyncState(t.__wbg_ptr);return P(e)}function qh(t){try{const s=p.__wbindgen_add_to_stack_pointer(-16);p.encodeSyncMessage(s,E(t));var e=b()[s/4+0],n=b()[s/4+1],r=b()[s/4+2];if(r)throw P(n);return P(e)}finally{p.__wbindgen_add_to_stack_pointer(16)}}function Vh(t){try{const s=p.__wbindgen_add_to_stack_pointer(-16);p.decodeSyncMessage(s,E(t));var e=b()[s/4+0],n=b()[s/4+1],r=b()[s/4+2];if(r)throw P(n);return P(e)}finally{p.__wbindgen_add_to_stack_pointer(16)}}function zh(t){Pt(t,Ke);const e=p.encodeSyncState(t.__wbg_ptr);return P(e)}function Wh(t){try{const s=p.__wbindgen_add_to_stack_pointer(-16);p.decodeSyncState(s,E(t));var e=b()[s/4+0],n=b()[s/4+1],r=b()[s/4+2];if(r)throw P(n);return Ke.__wrap(e)}finally{p.__wbindgen_add_to_stack_pointer(16)}}function De(t,e){try{return t.apply(this,e)}catch(n){p.__wbindgen_exn_store(E(n))}}const Gh=Object.freeze({Array:0,0:"Array",String:1,1:"String"}),lo=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>p.__wbg_automerge_free(t>>>0));class st{static __wrap(e){e=e>>>0;const n=Object.create(st.prototype);return n.__wbg_ptr=e,lo.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,lo.unregister(this),e}free(){const e=this.__destroy_into_raw();p.__wbg_automerge_free(e)}static new(e,n){try{const c=p.__wbindgen_add_to_stack_pointer(-16);var r=_e(e)?0:ot(e,p.__wbindgen_malloc,p.__wbindgen_realloc),s=Ge;p.automerge_new(c,r,s,n);var i=b()[c/4+0],o=b()[c/4+1],a=b()[c/4+2];if(a)throw P(o);return st.__wrap(i)}finally{p.__wbindgen_add_to_stack_pointer(16)}}clone(e){try{const a=p.__wbindgen_add_to_stack_pointer(-16);var n=_e(e)?0:ot(e,p.__wbindgen_malloc,p.__wbindgen_realloc),r=Ge;p.automerge_clone(a,this.__wbg_ptr,n,r);var s=b()[a/4+0],i=b()[a/4+1],o=b()[a/4+2];if(o)throw P(i);return st.__wrap(s)}finally{p.__wbindgen_add_to_stack_pointer(16)}}fork(e,n){try{const c=p.__wbindgen_add_to_stack_pointer(-16);var r=_e(e)?0:ot(e,p.__wbindgen_malloc,p.__wbindgen_realloc),s=Ge;p.automerge_fork(c,this.__wbg_ptr,r,s,E(n));var i=b()[c/4+0],o=b()[c/4+1],a=b()[c/4+2];if(a)throw P(o);return st.__wrap(i)}finally{p.__wbindgen_add_to_stack_pointer(16)}}pendingOps(){const e=p.automerge_pendingOps(this.__wbg_ptr);return P(e)}commit(e,n){var r=_e(e)?0:ot(e,p.__wbindgen_malloc,p.__wbindgen_realloc),s=Ge;const i=p.automerge_commit(this.__wbg_ptr,r,s,!_e(n),_e(n)?0:n);return P(i)}merge(e){try{const i=p.__wbindgen_add_to_stack_pointer(-16);Pt(e,st),p.automerge_merge(i,this.__wbg_ptr,e.__wbg_ptr);var n=b()[i/4+0],r=b()[i/4+1],s=b()[i/4+2];if(s)throw P(r);return P(n)}finally{p.__wbindgen_add_to_stack_pointer(16)}}rollback(){return p.automerge_rollback(this.__wbg_ptr)}keys(e,n){try{const o=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_keys(o,this.__wbg_ptr,E(e),_e(n)?0:E(n));var r=b()[o/4+0],s=b()[o/4+1],i=b()[o/4+2];if(i)throw P(s);return P(r)}finally{p.__wbindgen_add_to_stack_pointer(16)}}text(e,n){let r,s;try{const l=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_text(l,this.__wbg_ptr,E(e),_e(n)?0:E(n));var i=b()[l/4+0],o=b()[l/4+1],a=b()[l/4+2],c=b()[l/4+3],u=i,f=o;if(c)throw u=0,f=0,P(a);return r=u,s=f,Ne(u,f)}finally{p.__wbindgen_add_to_stack_pointer(16),p.__wbindgen_free(r,s,1)}}spans(e,n){try{const o=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_spans(o,this.__wbg_ptr,E(e),_e(n)?0:E(n));var r=b()[o/4+0],s=b()[o/4+1],i=b()[o/4+2];if(i)throw P(s);return P(r)}finally{p.__wbindgen_add_to_stack_pointer(16)}}splice(e,n,r,s){try{const a=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_splice(a,this.__wbg_ptr,E(e),n,r,E(s));var i=b()[a/4+0],o=b()[a/4+1];if(o)throw P(i)}finally{p.__wbindgen_add_to_stack_pointer(16)}}updateText(e,n){try{const i=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_updateText(i,this.__wbg_ptr,E(e),E(n));var r=b()[i/4+0],s=b()[i/4+1];if(s)throw P(r)}finally{p.__wbindgen_add_to_stack_pointer(16)}}updateSpans(e,n){try{const i=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_updateSpans(i,this.__wbg_ptr,E(e),E(n));var r=b()[i/4+0],s=b()[i/4+1];if(s)throw P(r)}finally{p.__wbindgen_add_to_stack_pointer(16)}}push(e,n,r){try{const o=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_push(o,this.__wbg_ptr,E(e),E(n),E(r));var s=b()[o/4+0],i=b()[o/4+1];if(i)throw P(s)}finally{p.__wbindgen_add_to_stack_pointer(16)}}pushObject(e,n){try{const a=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_pushObject(a,this.__wbg_ptr,E(e),E(n));var r=b()[a/4+0],s=b()[a/4+1],i=b()[a/4+2],o=b()[a/4+3];if(o)throw P(i);let c;return r!==0&&(c=Ne(r,s).slice(),p.__wbindgen_free(r,s*1,1)),c}finally{p.__wbindgen_add_to_stack_pointer(16)}}insert(e,n,r,s){try{const a=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_insert(a,this.__wbg_ptr,E(e),n,E(r),E(s));var i=b()[a/4+0],o=b()[a/4+1];if(o)throw P(i)}finally{p.__wbindgen_add_to_stack_pointer(16)}}splitBlock(e,n,r){try{const o=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_splitBlock(o,this.__wbg_ptr,E(e),n,E(r));var s=b()[o/4+0],i=b()[o/4+1];if(i)throw P(s)}finally{p.__wbindgen_add_to_stack_pointer(16)}}joinBlock(e,n){try{const i=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_joinBlock(i,this.__wbg_ptr,E(e),n);var r=b()[i/4+0],s=b()[i/4+1];if(s)throw P(r)}finally{p.__wbindgen_add_to_stack_pointer(16)}}updateBlock(e,n,r){try{const o=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_updateBlock(o,this.__wbg_ptr,E(e),n,E(r));var s=b()[o/4+0],i=b()[o/4+1];if(i)throw P(s)}finally{p.__wbindgen_add_to_stack_pointer(16)}}getBlock(e,n,r){try{const a=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_getBlock(a,this.__wbg_ptr,E(e),n,_e(r)?0:E(r));var s=b()[a/4+0],i=b()[a/4+1],o=b()[a/4+2];if(o)throw P(i);return P(s)}finally{p.__wbindgen_add_to_stack_pointer(16)}}insertObject(e,n,r){try{const c=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_insertObject(c,this.__wbg_ptr,E(e),n,E(r));var s=b()[c/4+0],i=b()[c/4+1],o=b()[c/4+2],a=b()[c/4+3];if(a)throw P(o);let u;return s!==0&&(u=Ne(s,i).slice(),p.__wbindgen_free(s,i*1,1)),u}finally{p.__wbindgen_add_to_stack_pointer(16)}}put(e,n,r,s){try{const a=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_put(a,this.__wbg_ptr,E(e),E(n),E(r),E(s));var i=b()[a/4+0],o=b()[a/4+1];if(o)throw P(i)}finally{p.__wbindgen_add_to_stack_pointer(16)}}putObject(e,n,r){try{const a=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_putObject(a,this.__wbg_ptr,E(e),E(n),E(r));var s=b()[a/4+0],i=b()[a/4+1],o=b()[a/4+2];if(o)throw P(i);return P(s)}finally{p.__wbindgen_add_to_stack_pointer(16)}}increment(e,n,r){try{const o=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_increment(o,this.__wbg_ptr,E(e),E(n),E(r));var s=b()[o/4+0],i=b()[o/4+1];if(i)throw P(s)}finally{p.__wbindgen_add_to_stack_pointer(16)}}get(e,n,r){try{const a=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_get(a,this.__wbg_ptr,E(e),E(n),_e(r)?0:E(r));var s=b()[a/4+0],i=b()[a/4+1],o=b()[a/4+2];if(o)throw P(i);return P(s)}finally{p.__wbindgen_add_to_stack_pointer(16)}}getWithType(e,n,r){try{const a=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_getWithType(a,this.__wbg_ptr,E(e),E(n),_e(r)?0:E(r));var s=b()[a/4+0],i=b()[a/4+1],o=b()[a/4+2];if(o)throw P(i);return P(s)}finally{p.__wbindgen_add_to_stack_pointer(16)}}objInfo(e,n){try{const o=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_objInfo(o,this.__wbg_ptr,E(e),_e(n)?0:E(n));var r=b()[o/4+0],s=b()[o/4+1],i=b()[o/4+2];if(i)throw P(s);return P(r)}finally{p.__wbindgen_add_to_stack_pointer(16)}}getAll(e,n,r){try{const a=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_getAll(a,this.__wbg_ptr,E(e),E(n),_e(r)?0:E(r));var s=b()[a/4+0],i=b()[a/4+1],o=b()[a/4+2];if(o)throw P(i);return P(s)}finally{p.__wbindgen_add_to_stack_pointer(16)}}enableFreeze(e){try{const i=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_enableFreeze(i,this.__wbg_ptr,E(e));var n=b()[i/4+0],r=b()[i/4+1],s=b()[i/4+2];if(s)throw P(r);return P(n)}finally{p.__wbindgen_add_to_stack_pointer(16)}}registerDatatype(e,n,r){try{const o=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_registerDatatype(o,this.__wbg_ptr,E(e),E(n),E(r));var s=b()[o/4+0],i=b()[o/4+1];if(i)throw P(s)}finally{p.__wbindgen_add_to_stack_pointer(16)}}applyPatches(e,n){try{const o=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_applyPatches(o,this.__wbg_ptr,E(e),E(n));var r=b()[o/4+0],s=b()[o/4+1],i=b()[o/4+2];if(i)throw P(s);return P(r)}finally{p.__wbindgen_add_to_stack_pointer(16)}}applyAndReturnPatches(e,n){try{const o=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_applyAndReturnPatches(o,this.__wbg_ptr,E(e),E(n));var r=b()[o/4+0],s=b()[o/4+1],i=b()[o/4+2];if(i)throw P(s);return P(r)}finally{p.__wbindgen_add_to_stack_pointer(16)}}diffIncremental(){try{const s=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_diffIncremental(s,this.__wbg_ptr);var e=b()[s/4+0],n=b()[s/4+1],r=b()[s/4+2];if(r)throw P(n);return P(e)}finally{p.__wbindgen_add_to_stack_pointer(16)}}updateDiffCursor(){p.automerge_updateDiffCursor(this.__wbg_ptr)}resetDiffCursor(){p.automerge_resetDiffCursor(this.__wbg_ptr)}diff(e,n){try{const o=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_diff(o,this.__wbg_ptr,E(e),E(n));var r=b()[o/4+0],s=b()[o/4+1],i=b()[o/4+2];if(i)throw P(s);return P(r)}finally{p.__wbindgen_add_to_stack_pointer(16)}}isolate(e){try{const s=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_isolate(s,this.__wbg_ptr,E(e));var n=b()[s/4+0],r=b()[s/4+1];if(r)throw P(n)}finally{p.__wbindgen_add_to_stack_pointer(16)}}integrate(){p.automerge_integrate(this.__wbg_ptr)}length(e,n){try{const o=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_length(o,this.__wbg_ptr,E(e),_e(n)?0:E(n));var r=tr()[o/8+0],s=b()[o/4+2],i=b()[o/4+3];if(i)throw P(s);return r}finally{p.__wbindgen_add_to_stack_pointer(16)}}delete(e,n){try{const i=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_delete(i,this.__wbg_ptr,E(e),E(n));var r=b()[i/4+0],s=b()[i/4+1];if(s)throw P(r)}finally{p.__wbindgen_add_to_stack_pointer(16)}}save(){const e=p.automerge_save(this.__wbg_ptr);return P(e)}saveIncremental(){const e=p.automerge_saveIncremental(this.__wbg_ptr);return P(e)}saveSince(e){try{const i=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_saveSince(i,this.__wbg_ptr,E(e));var n=b()[i/4+0],r=b()[i/4+1],s=b()[i/4+2];if(s)throw P(r);return P(n)}finally{p.__wbindgen_add_to_stack_pointer(16)}}saveNoCompress(){const e=p.automerge_saveNoCompress(this.__wbg_ptr);return P(e)}saveAndVerify(){try{const s=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_saveAndVerify(s,this.__wbg_ptr);var e=b()[s/4+0],n=b()[s/4+1],r=b()[s/4+2];if(r)throw P(n);return P(e)}finally{p.__wbindgen_add_to_stack_pointer(16)}}loadIncremental(e){try{const i=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_loadIncremental(i,this.__wbg_ptr,E(e));var n=tr()[i/8+0],r=b()[i/4+2],s=b()[i/4+3];if(s)throw P(r);return n}finally{p.__wbindgen_add_to_stack_pointer(16)}}applyChanges(e){try{const s=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_applyChanges(s,this.__wbg_ptr,E(e));var n=b()[s/4+0],r=b()[s/4+1];if(r)throw P(n)}finally{p.__wbindgen_add_to_stack_pointer(16)}}getChanges(e){try{const i=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_getChanges(i,this.__wbg_ptr,E(e));var n=b()[i/4+0],r=b()[i/4+1],s=b()[i/4+2];if(s)throw P(r);return P(n)}finally{p.__wbindgen_add_to_stack_pointer(16)}}getChangeByHash(e){try{const i=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_getChangeByHash(i,this.__wbg_ptr,E(e));var n=b()[i/4+0],r=b()[i/4+1],s=b()[i/4+2];if(s)throw P(r);return P(n)}finally{p.__wbindgen_add_to_stack_pointer(16)}}getDecodedChangeByHash(e){try{const i=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_getDecodedChangeByHash(i,this.__wbg_ptr,E(e));var n=b()[i/4+0],r=b()[i/4+1],s=b()[i/4+2];if(s)throw P(r);return P(n)}finally{p.__wbindgen_add_to_stack_pointer(16)}}getChangesAdded(e){Pt(e,st);const n=p.automerge_getChangesAdded(this.__wbg_ptr,e.__wbg_ptr);return P(n)}getHeads(){const e=p.automerge_getHeads(this.__wbg_ptr);return P(e)}getActorId(){let e,n;try{const i=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_getActorId(i,this.__wbg_ptr);var r=b()[i/4+0],s=b()[i/4+1];return e=r,n=s,Ne(r,s)}finally{p.__wbindgen_add_to_stack_pointer(16),p.__wbindgen_free(e,n,1)}}getLastLocalChange(){const e=p.automerge_getLastLocalChange(this.__wbg_ptr);return P(e)}dump(){p.automerge_dump(this.__wbg_ptr)}getMissingDeps(e){try{const i=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_getMissingDeps(i,this.__wbg_ptr,_e(e)?0:E(e));var n=b()[i/4+0],r=b()[i/4+1],s=b()[i/4+2];if(s)throw P(r);return P(n)}finally{p.__wbindgen_add_to_stack_pointer(16)}}receiveSyncMessage(e,n){try{const i=p.__wbindgen_add_to_stack_pointer(-16);Pt(e,Ke),p.automerge_receiveSyncMessage(i,this.__wbg_ptr,e.__wbg_ptr,E(n));var r=b()[i/4+0],s=b()[i/4+1];if(s)throw P(r)}finally{p.__wbindgen_add_to_stack_pointer(16)}}generateSyncMessage(e){Pt(e,Ke);const n=p.automerge_generateSyncMessage(this.__wbg_ptr,e.__wbg_ptr);return P(n)}toJS(e){try{const i=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_toJS(i,this.__wbg_ptr,E(e));var n=b()[i/4+0],r=b()[i/4+1],s=b()[i/4+2];if(s)throw P(r);return P(n)}finally{p.__wbindgen_add_to_stack_pointer(16)}}materialize(e,n,r){try{const a=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_materialize(a,this.__wbg_ptr,E(e),_e(n)?0:E(n),E(r));var s=b()[a/4+0],i=b()[a/4+1],o=b()[a/4+2];if(o)throw P(i);return P(s)}finally{p.__wbindgen_add_to_stack_pointer(16)}}getCursor(e,n,r){let s,i;try{const d=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_getCursor(d,this.__wbg_ptr,E(e),n,_e(r)?0:E(r));var o=b()[d/4+0],a=b()[d/4+1],c=b()[d/4+2],u=b()[d/4+3],f=o,l=a;if(u)throw f=0,l=0,P(c);return s=f,i=l,Ne(f,l)}finally{p.__wbindgen_add_to_stack_pointer(16),p.__wbindgen_free(s,i,1)}}getCursorPosition(e,n,r){try{const a=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_getCursorPosition(a,this.__wbg_ptr,E(e),E(n),_e(r)?0:E(r));var s=tr()[a/8+0],i=b()[a/4+2],o=b()[a/4+3];if(o)throw P(i);return s}finally{p.__wbindgen_add_to_stack_pointer(16)}}emptyChange(e,n){var r=_e(e)?0:ot(e,p.__wbindgen_malloc,p.__wbindgen_realloc),s=Ge;const i=p.automerge_emptyChange(this.__wbg_ptr,r,s,!_e(n),_e(n)?0:n);return P(i)}mark(e,n,r,s,i){try{const c=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_mark(c,this.__wbg_ptr,E(e),E(n),E(r),E(s),E(i));var o=b()[c/4+0],a=b()[c/4+1];if(a)throw P(o)}finally{p.__wbindgen_add_to_stack_pointer(16)}}unmark(e,n,r){try{const o=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_unmark(o,this.__wbg_ptr,E(e),E(n),E(r));var s=b()[o/4+0],i=b()[o/4+1];if(i)throw P(s)}finally{p.__wbindgen_add_to_stack_pointer(16)}}marks(e,n){try{const o=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_marks(o,this.__wbg_ptr,E(e),_e(n)?0:E(n));var r=b()[o/4+0],s=b()[o/4+1],i=b()[o/4+2];if(i)throw P(s);return P(r)}finally{p.__wbindgen_add_to_stack_pointer(16)}}marksAt(e,n,r){try{const a=p.__wbindgen_add_to_stack_pointer(-16);p.automerge_marksAt(a,this.__wbg_ptr,E(e),n,_e(r)?0:E(r));var s=b()[a/4+0],i=b()[a/4+1],o=b()[a/4+2];if(o)throw P(i);return P(s)}finally{p.__wbindgen_add_to_stack_pointer(16)}}hasOurChanges(e){Pt(e,Ke);const n=p.automerge_hasOurChanges(this.__wbg_ptr,e.__wbg_ptr);return P(n)}topoHistoryTraversal(){const e=p.automerge_topoHistoryTraversal(this.__wbg_ptr);return P(e)}stats(){const e=p.automerge_stats(this.__wbg_ptr);return P(e)}}const fo=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>p.__wbg_syncstate_free(t>>>0));class Ke{static __wrap(e){e=e>>>0;const n=Object.create(Ke.prototype);return n.__wbg_ptr=e,fo.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,fo.unregister(this),e}free(){const e=this.__destroy_into_raw();p.__wbg_syncstate_free(e)}get sharedHeads(){const e=p.syncstate_sharedHeads(this.__wbg_ptr);return P(e)}get lastSentHeads(){const e=p.syncstate_lastSentHeads(this.__wbg_ptr);return P(e)}set lastSentHeads(e){try{const s=p.__wbindgen_add_to_stack_pointer(-16);p.syncstate_set_lastSentHeads(s,this.__wbg_ptr,E(e));var n=b()[s/4+0],r=b()[s/4+1];if(r)throw P(n)}finally{p.__wbindgen_add_to_stack_pointer(16)}}set sentHashes(e){try{const s=p.__wbindgen_add_to_stack_pointer(-16);p.syncstate_set_sentHashes(s,this.__wbg_ptr,E(e));var n=b()[s/4+0],r=b()[s/4+1];if(r)throw P(n)}finally{p.__wbindgen_add_to_stack_pointer(16)}}clone(){const e=p.syncstate_clone(this.__wbg_ptr);return Ke.__wrap(e)}}function $a(t){P(t)}function Ba(t,e){const n=N(e),r=typeof n=="string"?n:void 0;var s=_e(r)?0:ot(r,p.__wbindgen_malloc,p.__wbindgen_realloc),i=Ge;b()[t/4+1]=i,b()[t/4+0]=s}function ja(t,e){const n=new Error(Ne(t,e));return E(n)}function La(t,e){const n=Ne(t,e);return E(n)}function Ua(t){return E(t)}function Na(t){const e=N(t);return E(e)}function Ha(t,e){const n=N(e),r=typeof n=="number"?n:void 0;tr()[t/8+1]=_e(r)?0:r,b()[t/4+0]=!_e(r)}function Fa(t){return N(t)===void 0}function qa(t){const e=N(t);return typeof e=="boolean"?e?1:0:2}function Va(t){return N(t)===null}function za(t){return typeof N(t)=="string"}function Wa(t){return typeof N(t)=="function"}function Ga(t){const e=N(t);return typeof e=="object"&&e!==null}function Ka(t){return Array.isArray(N(t))}function Xa(t,e){const n=N(e),r=JSON.stringify(n===void 0?null:n),s=ot(r,p.__wbindgen_malloc,p.__wbindgen_realloc),i=Ge;b()[t/4+1]=i,b()[t/4+0]=s}function Ja(){const t=new Error;return E(t)}function Ya(t,e){const n=N(e).stack,r=ot(n,p.__wbindgen_malloc,p.__wbindgen_realloc),s=Ge;b()[t/4+1]=s,b()[t/4+0]=r}function Za(t,e){let n,r;try{n=t,r=e,console.error(Ne(t,e))}finally{p.__wbindgen_free(n,r,1)}}function Qa(t,e){return N(t)==N(e)}function ec(t,e){const n=String(N(e)),r=ot(n,p.__wbindgen_malloc,p.__wbindgen_realloc),s=Ge;b()[t/4+1]=s,b()[t/4+0]=r}function tc(t){return E(t)}function nc(t){const e=BigInt.asUintN(64,t);return E(e)}function rc(t,e,n){N(t)[P(e)]=P(n)}function sc(){return De(function(t,e){N(t).getRandomValues(N(e))},arguments)}function ic(){return De(function(t,e){N(t).randomFillSync(P(e))},arguments)}function oc(t){const e=N(t).crypto;return E(e)}function ac(t){const e=N(t).process;return E(e)}function cc(t){const e=N(t).versions;return E(e)}function uc(t){const e=N(t).node;return E(e)}function lc(){return De(function(){const t=module.require;return E(t)},arguments)}function fc(t){const e=N(t).msCrypto;return E(e)}function dc(t){console.log(N(t))}function hc(t,e){console.log(N(t),N(e))}function gc(t,e){const n=N(t)[e>>>0];return E(n)}function _c(t){return N(t).length}function pc(){const t=new Array;return E(t)}function yc(t,e){const n=new Function(Ne(t,e));return E(n)}function wc(t){const e=N(t).next;return E(e)}function mc(){return De(function(t){const e=N(t).next();return E(e)},arguments)}function bc(t){return N(t).done}function vc(t){const e=N(t).value;return E(e)}function xc(){return E(Symbol.iterator)}function Sc(){return De(function(t,e){const n=Reflect.get(N(t),N(e));return E(n)},arguments)}function Ec(){return De(function(t,e){const n=N(t).call(N(e));return E(n)},arguments)}function kc(){const t=new Object;return E(t)}function Ac(t){return N(t).length}function Cc(t,e,n){N(t)[e>>>0]=P(n)}function Tc(t){const e=Array.from(N(t));return E(e)}function Ic(t){return Array.isArray(N(t))}function Mc(t,e){return N(t).push(N(e))}function Oc(t,e){return N(t).unshift(N(e))}function Rc(t){let e;try{e=N(t)instanceof ArrayBuffer}catch{e=!1}return e}function Pc(t,e){const n=new Error(Ne(t,e));return E(n)}function Dc(){return De(function(t,e,n){const r=N(t).call(N(e),N(n));return E(r)},arguments)}function $c(t){let e;try{e=N(t)instanceof Date}catch{e=!1}return e}function Bc(t){return N(t).getTime()}function jc(t){const e=new Date(N(t));return E(e)}function Lc(t){let e;try{e=N(t)instanceof Object}catch{e=!1}return e}function Uc(t,e){const n=Object.assign(N(t),N(e));return E(n)}function Nc(t,e,n){const r=Object.defineProperty(N(t),N(e),N(n));return E(r)}function Hc(t){const e=Object.entries(N(t));return E(e)}function Fc(t){const e=Object.freeze(N(t));return E(e)}function qc(t){const e=Object.keys(N(t));return E(e)}function Vc(t){const e=Object.values(N(t));return E(e)}function zc(t,e){const n=new RangeError(Ne(t,e));return E(n)}function Wc(){return De(function(t,e,n){const r=Reflect.apply(N(t),N(e),N(n));return E(r)},arguments)}function Gc(){return De(function(t,e){return Reflect.deleteProperty(N(t),N(e))},arguments)}function Kc(){return De(function(t){const e=Reflect.ownKeys(N(t));return E(e)},arguments)}function Xc(){return De(function(t,e,n){return Reflect.set(N(t),N(e),N(n))},arguments)}function Jc(t){const e=N(t).buffer;return E(e)}function Yc(t,e){const n=N(t).concat(N(e));return E(n)}function Zc(t,e,n){const r=N(t).slice(e>>>0,n>>>0);return E(r)}function Qc(t,e){const n=Symbol.for(Ne(t,e));return E(n)}function eu(t){const e=N(t).toString();return E(e)}function tu(){return De(function(){const t=self.self;return E(t)},arguments)}function nu(){return De(function(){const t=window.window;return E(t)},arguments)}function ru(){return De(function(){const t=globalThis.globalThis;return E(t)},arguments)}function su(){return De(function(){const t=global.global;return E(t)},arguments)}function iu(t,e,n){const r=new Uint8Array(N(t),e>>>0,n>>>0);return E(r)}function ou(t){const e=new Uint8Array(N(t));return E(e)}function au(t,e,n){N(t).set(N(e),n>>>0)}function cu(t){return N(t).length}function uu(t){let e;try{e=N(t)instanceof Uint8Array}catch{e=!1}return e}function lu(t){const e=new Uint8Array(t>>>0);return E(e)}function fu(t,e,n){const r=N(t).subarray(e>>>0,n>>>0);return E(r)}function du(t,e){const n=Bs(N(e)),r=ot(n,p.__wbindgen_malloc,p.__wbindgen_realloc),s=Ge;b()[t/4+1]=s,b()[t/4+0]=r}function hu(t,e){throw new Error(Ne(t,e))}function gu(){const t=p.memory;return E(t)}URL=globalThis.URL;const L=await Oh({"./automerge_wasm_bg.js":{__wbindgen_object_drop_ref:$a,__wbindgen_string_get:Ba,__wbindgen_error_new:ja,__wbindgen_string_new:La,__wbindgen_number_new:Ua,__wbindgen_object_clone_ref:Na,__wbindgen_number_get:Ha,__wbindgen_is_undefined:Fa,__wbindgen_boolean_get:qa,__wbindgen_is_null:Va,__wbindgen_is_string:za,__wbindgen_is_function:Wa,__wbindgen_is_object:Ga,__wbindgen_is_array:Ka,__wbindgen_json_serialize:Xa,__wbg_new_abda76e883ba8a5f:Ja,__wbg_stack_658279fe44541cf6:Ya,__wbg_error_f851667af71bcfc6:Za,__wbindgen_jsval_loose_eq:Qa,__wbg_String_91fba7ded13ba54c:ec,__wbindgen_bigint_from_i64:tc,__wbindgen_bigint_from_u64:nc,__wbg_set_20cbc34131e76824:rc,__wbg_getRandomValues_3aa56aa6edec874c:sc,__wbg_randomFillSync_5c9c955aa56b6049:ic,__wbg_crypto_1d1f22824a6a080c:oc,__wbg_process_4a72847cc503995b:ac,__wbg_versions_f686565e586dd935:cc,__wbg_node_104a2ff8d6ea03a2:uc,__wbg_require_cca90b1a94a0255b:lc,__wbg_msCrypto_eb05e62b530a1508:fc,__wbg_log_5bb5f88f245d7762:dc,__wbg_log_1746d5c75ec89963:hc,__wbg_get_bd8e338fbd5f5cc8:gc,__wbg_length_cd7af8117672b8b8:_c,__wbg_new_16b304a2cfa7ff4a:pc,__wbg_newnoargs_e258087cd0daa0ea:yc,__wbg_next_40fc327bfc8770e6:wc,__wbg_next_196c84450b364254:mc,__wbg_done_298b57d23c0fc80c:bc,__wbg_value_d93c65011f51a456:vc,__wbg_iterator_2cee6dadfd956dfa:xc,__wbg_get_e3c254076557e348:Sc,__wbg_call_27c0f87801dedf93:Ec,__wbg_new_72fb9a18b5ae2624:kc,__wbg_length_dee433d4c85c9387:Ac,__wbg_set_d4638f722068f043:Cc,__wbg_from_89e3fc3ba5e6fb48:Tc,__wbg_isArray_2ab64d95e09ea0ae:Ic,__wbg_push_a5b05aedc7234f9f:Mc,__wbg_unshift_e22df4b34bcf5070:Oc,__wbg_instanceof_ArrayBuffer_836825be07d4c9d2:Rc,__wbg_new_28c511d9baebfa89:Pc,__wbg_call_b3ca7c6051f9bec1:Dc,__wbg_instanceof_Date_f65cf97fb83fc369:$c,__wbg_getTime_2bc4375165f02d15:Bc,__wbg_new_cf3ec55744a78578:jc,__wbg_instanceof_Object_71ca3c0a59266746:Lc,__wbg_assign_496d2d14fecafbcf:Uc,__wbg_defineProperty_cc00e2de8a0f5141:Nc,__wbg_entries_95cc2c823b285a09:Hc,__wbg_freeze_cc6bc19f75299986:Fc,__wbg_keys_91e412b4b222659f:qc,__wbg_values_9c75e6e2bfbdb70d:Vc,__wbg_new_dd6a5dd7b538af21:zc,__wbg_apply_0a5aa603881e6d79:Wc,__wbg_deleteProperty_13e721a56f19e842:Gc,__wbg_ownKeys_658942b7f28d1fe9:Kc,__wbg_set_1f9b04f170055d33:Xc,__wbg_buffer_12d079cc21e14bdb:Jc,__wbg_concat_3de229fe4fe90fea:Yc,__wbg_slice_52fb626ffdc8da8f:Zc,__wbg_for_27c67e2dbdce22f6:Qc,__wbg_toString_7df3c77999517c20:eu,__wbg_self_ce0dbfc45cf2f5be:tu,__wbg_window_c6fb939a7f436783:nu,__wbg_globalThis_d1e6af4856ba331b:ru,__wbg_global_207b558942527489:su,__wbg_newwithbyteoffsetandlength_aa4a17c33a06e5cb:iu,__wbg_new_63b92bc8671ed464:ou,__wbg_set_a47bac70306a19a7:au,__wbg_length_c20a40f15020d68a:cu,__wbg_instanceof_Uint8Array_2b3bbecd033d19f6:uu,__wbg_newwithlength_e9b4878cebadb3d3:lu,__wbg_subarray_a1f73cd4b5b42fe1:fu,__wbindgen_debug_string:du,__wbindgen_throw:hu,__wbindgen_memory:gu}},Mh),Kh=L.memory,Xh=L.__wbg_syncstate_free,Jh=L.syncstate_sharedHeads,Yh=L.syncstate_lastSentHeads,Zh=L.syncstate_set_lastSentHeads,Qh=L.syncstate_set_sentHashes,e0=L.syncstate_clone,t0=L.__wbg_automerge_free,n0=L.automerge_new,r0=L.automerge_clone,s0=L.automerge_fork,i0=L.automerge_pendingOps,o0=L.automerge_commit,a0=L.automerge_merge,c0=L.automerge_rollback,u0=L.automerge_keys,l0=L.automerge_text,f0=L.automerge_spans,d0=L.automerge_splice,h0=L.automerge_updateText,g0=L.automerge_updateSpans,_0=L.automerge_push,p0=L.automerge_pushObject,y0=L.automerge_insert,w0=L.automerge_splitBlock,m0=L.automerge_joinBlock,b0=L.automerge_updateBlock,v0=L.automerge_getBlock,x0=L.automerge_insertObject,S0=L.automerge_put,E0=L.automerge_putObject,k0=L.automerge_increment,A0=L.automerge_get,C0=L.automerge_getWithType,T0=L.automerge_objInfo,I0=L.automerge_getAll,M0=L.automerge_enableFreeze,O0=L.automerge_registerDatatype,R0=L.automerge_applyPatches,P0=L.automerge_applyAndReturnPatches,D0=L.automerge_diffIncremental,$0=L.automerge_updateDiffCursor,B0=L.automerge_resetDiffCursor,j0=L.automerge_diff,L0=L.automerge_isolate,U0=L.automerge_integrate,N0=L.automerge_length,H0=L.automerge_delete,F0=L.automerge_save,q0=L.automerge_saveIncremental,V0=L.automerge_saveSince,z0=L.automerge_saveNoCompress,W0=L.automerge_saveAndVerify,G0=L.automerge_loadIncremental,K0=L.automerge_applyChanges,X0=L.automerge_getChanges,J0=L.automerge_getChangeByHash,Y0=L.automerge_getDecodedChangeByHash,Z0=L.automerge_getChangesAdded,Q0=L.automerge_getHeads,eg=L.automerge_getActorId,tg=L.automerge_getLastLocalChange,ng=L.automerge_dump,rg=L.automerge_getMissingDeps,sg=L.automerge_receiveSyncMessage,ig=L.automerge_generateSyncMessage,og=L.automerge_toJS,ag=L.automerge_materialize,cg=L.automerge_getCursor,ug=L.automerge_getCursorPosition,lg=L.automerge_emptyChange,fg=L.automerge_mark,dg=L.automerge_unmark,hg=L.automerge_marks,gg=L.automerge_marksAt,_g=L.automerge_hasOurChanges,pg=L.automerge_topoHistoryTraversal,yg=L.automerge_stats,wg=L.create,mg=L.load,bg=L.encodeChange,vg=L.decodeChange,xg=L.initSyncState,Sg=L.importSyncState,Eg=L.exportSyncState,kg=L.encodeSyncMessage,Ag=L.decodeSyncMessage,Cg=L.encodeSyncState,Tg=L.decodeSyncState,Ig=L.__wbindgen_malloc,Mg=L.__wbindgen_realloc,Og=L.__wbindgen_add_to_stack_pointer,Rg=L.__wbindgen_free,Pg=L.__wbindgen_exn_store,Dg=Object.freeze(Object.defineProperty({__proto__:null,__wbg_automerge_free:t0,__wbg_syncstate_free:Xh,__wbindgen_add_to_stack_pointer:Og,__wbindgen_exn_store:Pg,__wbindgen_free:Rg,__wbindgen_malloc:Ig,__wbindgen_realloc:Mg,automerge_applyAndReturnPatches:P0,automerge_applyChanges:K0,automerge_applyPatches:R0,automerge_clone:r0,automerge_commit:o0,automerge_delete:H0,automerge_diff:j0,automerge_diffIncremental:D0,automerge_dump:ng,automerge_emptyChange:lg,automerge_enableFreeze:M0,automerge_fork:s0,automerge_generateSyncMessage:ig,automerge_get:A0,automerge_getActorId:eg,automerge_getAll:I0,automerge_getBlock:v0,automerge_getChangeByHash:J0,automerge_getChanges:X0,automerge_getChangesAdded:Z0,automerge_getCursor:cg,automerge_getCursorPosition:ug,automerge_getDecodedChangeByHash:Y0,automerge_getHeads:Q0,automerge_getLastLocalChange:tg,automerge_getMissingDeps:rg,automerge_getWithType:C0,automerge_hasOurChanges:_g,automerge_increment:k0,automerge_insert:y0,automerge_insertObject:x0,automerge_integrate:U0,automerge_isolate:L0,automerge_joinBlock:m0,automerge_keys:u0,automerge_length:N0,automerge_loadIncremental:G0,automerge_mark:fg,automerge_marks:hg,automerge_marksAt:gg,automerge_materialize:ag,automerge_merge:a0,automerge_new:n0,automerge_objInfo:T0,automerge_pendingOps:i0,automerge_push:_0,automerge_pushObject:p0,automerge_put:S0,automerge_putObject:E0,automerge_receiveSyncMessage:sg,automerge_registerDatatype:O0,automerge_resetDiffCursor:B0,automerge_rollback:c0,automerge_save:F0,automerge_saveAndVerify:W0,automerge_saveIncremental:q0,automerge_saveNoCompress:z0,automerge_saveSince:V0,automerge_spans:f0,automerge_splice:d0,automerge_splitBlock:w0,automerge_stats:yg,automerge_text:l0,automerge_toJS:og,automerge_topoHistoryTraversal:pg,automerge_unmark:dg,automerge_updateBlock:b0,automerge_updateDiffCursor:$0,automerge_updateSpans:g0,automerge_updateText:h0,create:wg,decodeChange:vg,decodeSyncMessage:Ag,decodeSyncState:Tg,encodeChange:bg,encodeSyncMessage:kg,encodeSyncState:Cg,exportSyncState:Eg,importSyncState:Sg,initSyncState:xg,load:mg,memory:Kh,syncstate_clone:e0,syncstate_lastSentHeads:Yh,syncstate_set_lastSentHeads:Zh,syncstate_set_sentHashes:Qh,syncstate_sharedHeads:Jh},Symbol.toStringTag,{value:"Module"}));Pa(Dg);const $g=Object.freeze(Object.defineProperty({__proto__:null,Automerge:st,SyncState:Ke,TextRepresentation:Gh,__wbg_String_91fba7ded13ba54c:ec,__wbg_apply_0a5aa603881e6d79:Wc,__wbg_assign_496d2d14fecafbcf:Uc,__wbg_buffer_12d079cc21e14bdb:Jc,__wbg_call_27c0f87801dedf93:Ec,__wbg_call_b3ca7c6051f9bec1:Dc,__wbg_concat_3de229fe4fe90fea:Yc,__wbg_crypto_1d1f22824a6a080c:oc,__wbg_defineProperty_cc00e2de8a0f5141:Nc,__wbg_deleteProperty_13e721a56f19e842:Gc,__wbg_done_298b57d23c0fc80c:bc,__wbg_entries_95cc2c823b285a09:Hc,__wbg_error_f851667af71bcfc6:Za,__wbg_for_27c67e2dbdce22f6:Qc,__wbg_freeze_cc6bc19f75299986:Fc,__wbg_from_89e3fc3ba5e6fb48:Tc,__wbg_getRandomValues_3aa56aa6edec874c:sc,__wbg_getTime_2bc4375165f02d15:Bc,__wbg_get_bd8e338fbd5f5cc8:gc,__wbg_get_e3c254076557e348:Sc,__wbg_globalThis_d1e6af4856ba331b:ru,__wbg_global_207b558942527489:su,__wbg_instanceof_ArrayBuffer_836825be07d4c9d2:Rc,__wbg_instanceof_Date_f65cf97fb83fc369:$c,__wbg_instanceof_Object_71ca3c0a59266746:Lc,__wbg_instanceof_Uint8Array_2b3bbecd033d19f6:uu,__wbg_isArray_2ab64d95e09ea0ae:Ic,__wbg_iterator_2cee6dadfd956dfa:xc,__wbg_keys_91e412b4b222659f:qc,__wbg_length_c20a40f15020d68a:cu,__wbg_length_cd7af8117672b8b8:_c,__wbg_length_dee433d4c85c9387:Ac,__wbg_log_1746d5c75ec89963:hc,__wbg_log_5bb5f88f245d7762:dc,__wbg_msCrypto_eb05e62b530a1508:fc,__wbg_new_16b304a2cfa7ff4a:pc,__wbg_new_28c511d9baebfa89:Pc,__wbg_new_63b92bc8671ed464:ou,__wbg_new_72fb9a18b5ae2624:kc,__wbg_new_abda76e883ba8a5f:Ja,__wbg_new_cf3ec55744a78578:jc,__wbg_new_dd6a5dd7b538af21:zc,__wbg_newnoargs_e258087cd0daa0ea:yc,__wbg_newwithbyteoffsetandlength_aa4a17c33a06e5cb:iu,__wbg_newwithlength_e9b4878cebadb3d3:lu,__wbg_next_196c84450b364254:mc,__wbg_next_40fc327bfc8770e6:wc,__wbg_node_104a2ff8d6ea03a2:uc,__wbg_ownKeys_658942b7f28d1fe9:Kc,__wbg_process_4a72847cc503995b:ac,__wbg_push_a5b05aedc7234f9f:Mc,__wbg_randomFillSync_5c9c955aa56b6049:ic,__wbg_require_cca90b1a94a0255b:lc,__wbg_self_ce0dbfc45cf2f5be:tu,__wbg_set_1f9b04f170055d33:Xc,__wbg_set_20cbc34131e76824:rc,__wbg_set_a47bac70306a19a7:au,__wbg_set_d4638f722068f043:Cc,__wbg_set_wasm:Pa,__wbg_slice_52fb626ffdc8da8f:Zc,__wbg_stack_658279fe44541cf6:Ya,__wbg_subarray_a1f73cd4b5b42fe1:fu,__wbg_toString_7df3c77999517c20:eu,__wbg_unshift_e22df4b34bcf5070:Oc,__wbg_value_d93c65011f51a456:vc,__wbg_values_9c75e6e2bfbdb70d:Vc,__wbg_versions_f686565e586dd935:cc,__wbg_window_c6fb939a7f436783:nu,__wbindgen_bigint_from_i64:tc,__wbindgen_bigint_from_u64:nc,__wbindgen_boolean_get:qa,__wbindgen_debug_string:du,__wbindgen_error_new:ja,__wbindgen_is_array:Ka,__wbindgen_is_function:Wa,__wbindgen_is_null:Va,__wbindgen_is_object:Ga,__wbindgen_is_string:za,__wbindgen_is_undefined:Fa,__wbindgen_json_serialize:Xa,__wbindgen_jsval_loose_eq:Qa,__wbindgen_memory:gu,__wbindgen_number_get:Ha,__wbindgen_number_new:Ua,__wbindgen_object_clone_ref:Na,__wbindgen_object_drop_ref:$a,__wbindgen_string_get:Ba,__wbindgen_string_new:La,__wbindgen_throw:hu,create:Bh,decodeChange:Uh,decodeSyncMessage:Vh,decodeSyncState:Wh,encodeChange:Lh,encodeSyncMessage:qh,encodeSyncState:zh,exportSyncState:Fh,importSyncState:Hh,initSyncState:Nh,load:jh},Symbol.toStringTag,{value:"Module"}));Hl($g);Ir();var Wt=null;typeof WebSocket<"u"?Wt=WebSocket:typeof MozWebSocket<"u"?Wt=MozWebSocket:typeof global<"u"?Wt=global.WebSocket||global.MozWebSocket:typeof window<"u"?Wt=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(Wt=self.WebSocket||self.MozWebSocket);const is=Wt,Bg=t=>t.type==="peer",jg=t=>t.type==="error",Lg="1";function nt(t,e="Assertion failed"){if(t===!1||t===null||t===void 0){const n=new Error(Ug(e));throw n.stack=Ng(n.stack,"assert.ts"),n}}const Ug=t=>t.split(`
`).map(e=>e.trim()).join(`
`),Ng=(t="",e)=>t.split(`
`).filter(n=>!n.includes(e)).join(`
`),Hg=t=>{const{buffer:e,byteOffset:n,byteLength:r}=t;return e.slice(n,n+r)};class Fg extends Ih{socket}class qg extends Fg{url;retryInterval;#t=!1;#e;#n=vt("automerge-repo:websocket:browser");remotePeerId;constructor(e,n=5e3){super(),this.url=e,this.retryInterval=n,this.#n=this.#n.extend(e)}connect(e,n){!this.socket||!this.peerId?(this.#n("connecting"),this.peerId=e,this.peerMetadata=n??{}):(this.#n("reconnecting"),nt(e===this.peerId),this.socket.removeEventListener("open",this.onOpen),this.socket.removeEventListener("close",this.onClose),this.socket.removeEventListener("message",this.onMessage),this.socket.removeEventListener("error",this.onError)),this.#e||(this.#e=setInterval(()=>{this.connect(e,n)},this.retryInterval)),this.socket=new is(this.url),this.socket.binaryType="arraybuffer",this.socket.addEventListener("open",this.onOpen),this.socket.addEventListener("close",this.onClose),this.socket.addEventListener("message",this.onMessage),this.socket.addEventListener("error",this.onError),setTimeout(()=>this.#r(),1e3),this.join()}onOpen=()=>{this.#n("open"),clearInterval(this.#e),this.#e=void 0,this.join()};onClose=()=>{this.#n("close"),this.remotePeerId&&this.emit("peer-disconnected",{peerId:this.remotePeerId}),this.retryInterval>0&&!this.#e&&setTimeout(()=>(nt(this.peerId),this.connect(this.peerId,this.peerMetadata)),this.retryInterval)};onMessage=e=>{this.receiveMessage(e.data)};onError=e=>{if("error"in e&&e.error.code!=="ECONNREFUSED")throw e.error;this.#n("Connection failed, retrying...")};#r(){this.#t||(this.#t=!0,this.emit("ready",{network:this}))}join(){nt(this.peerId),nt(this.socket),this.socket.readyState===is.OPEN&&this.send(Vg(this.peerId,this.peerMetadata))}disconnect(){nt(this.peerId),nt(this.socket),this.send({type:"leave",senderId:this.peerId})}send(e){if("data"in e&&e.data?.byteLength===0)throw new Error("Tried to send a zero-length message");if(nt(this.peerId),nt(this.socket),this.socket.readyState!==is.OPEN)throw new Error(`Websocket not ready (${this.socket.readyState})`);const n=Ca(e);this.socket.send(Hg(n))}peerCandidate(e,n){nt(this.socket),this.#r(),this.remotePeerId=e,this.emit("peer-candidate",{peerId:e,peerMetadata:n})}receiveMessage(e){const n=Jd(new Uint8Array(e));if(nt(this.socket),e.byteLength===0)throw new Error("received a zero-length message");if(Bg(n)){const{peerMetadata:r}=n;this.#n(`peer: ${n.senderId}`),this.peerCandidate(n.senderId,r)}else jg(n)?this.#n(`error: ${n.message}`):this.emit("message",n)}}function Vg(t,e){return{type:"join",senderId:t,peerMetadata:e,supportedProtocolVersions:[Lg]}}vt("WebsocketServer");class zg{database;store;dbPromise;constructor(e="automerge",n="documents"){this.database=e,this.store=n,this.dbPromise=this.createDatabasePromise()}createDatabasePromise(){return new Promise((e,n)=>{const r=indexedDB.open(this.database,1);r.onerror=()=>{n(r.error)},r.onupgradeneeded=s=>{s.target.result.createObjectStore(this.store)},r.onsuccess=s=>{const i=s.target.result;e(i)}})}async load(e){const r=(await this.dbPromise).transaction(this.store),i=r.objectStore(this.store).get(e);return new Promise((o,a)=>{r.onerror=()=>{a(i.error)},i.onsuccess=c=>{const u=c.target.result;u&&typeof u=="object"&&"binary"in u?o(u.binary):o(void 0)}})}async save(e,n){const s=(await this.dbPromise).transaction(this.store,"readwrite");return s.objectStore(this.store).put({key:e,binary:n},e),new Promise((o,a)=>{s.onerror=()=>{a(s.error)},s.oncomplete=()=>{o()}})}async remove(e){const r=(await this.dbPromise).transaction(this.store,"readwrite");return r.objectStore(this.store).delete(e),new Promise((i,o)=>{r.onerror=()=>{o(r.error)},r.oncomplete=()=>{i()}})}async loadRange(e){const n=await this.dbPromise,r=e,s=[...e,"￿"],i=IDBKeyRange.bound(r,s),o=n.transaction(this.store),c=o.objectStore(this.store).openCursor(i),u=[];return new Promise((f,l)=>{o.onerror=()=>{l(c.error)},c.onsuccess=d=>{const h=d.target.result;h?(u.push({data:h.value.binary,key:h.key}),h.continue()):f(u)}})}async removeRange(e){const n=await this.dbPromise,r=e,s=[...e,"￿"],i=IDBKeyRange.bound(r,s),o=n.transaction(this.store,"readwrite");return o.objectStore(this.store).delete(i),new Promise((c,u)=>{o.onerror=()=>{u(o.error)},o.oncomplete=()=>{c()}})}}const yr=Symbol("store-raw"),Yt=Symbol("store-node"),dt=Symbol("store-has"),_u=Symbol("store-self");function pu(t){let e=t[jt];if(!e&&(Object.defineProperty(t,jt,{value:e=new Proxy(t,Kg)}),!Array.isArray(t))){const n=Object.keys(t),r=Object.getOwnPropertyDescriptors(t);for(let s=0,i=n.length;s<i;s++){const o=n[s];r[o].get&&Object.defineProperty(t,o,{enumerable:r[o].enumerable,get:r[o].get.bind(e)})}}return e}function on(t){let e;return t!=null&&typeof t=="object"&&(t[jt]||!(e=Object.getPrototypeOf(t))||e===Object.prototype||Array.isArray(t))}function an(t,e=new Set){let n,r,s,i;if(n=t!=null&&t[yr])return n;if(!on(t)||e.has(t))return t;if(Array.isArray(t)){Object.isFrozen(t)?t=t.slice(0):e.add(t);for(let o=0,a=t.length;o<a;o++)s=t[o],(r=an(s,e))!==s&&(t[o]=r)}else{Object.isFrozen(t)?t=Object.assign({},t):e.add(t);const o=Object.keys(t),a=Object.getOwnPropertyDescriptors(t);for(let c=0,u=o.length;c<u;c++)i=o[c],!a[i].get&&(s=t[i],(r=an(s,e))!==s&&(t[i]=r))}return t}function wr(t,e){let n=t[e];return n||Object.defineProperty(t,e,{value:n=Object.create(null)}),n}function Cn(t,e,n){if(t[e])return t[e];const[r,s]=be(n,{equals:!1,internal:!0});return r.$=s,t[e]=r}function Wg(t,e){const n=Reflect.getOwnPropertyDescriptor(t,e);return!n||n.get||!n.configurable||e===jt||e===Yt||(delete n.value,delete n.writable,n.get=()=>t[jt][e]),n}function yu(t){fs()&&Cn(wr(t,Yt),_u)()}function Gg(t){return yu(t),Reflect.ownKeys(t)}const Kg={get(t,e,n){if(e===yr)return t;if(e===jt)return n;if(e===rr)return yu(t),n;const r=wr(t,Yt),s=r[e];let i=s?s():t[e];if(e===Yt||e===dt||e==="__proto__")return i;if(!s){const o=Object.getOwnPropertyDescriptor(t,e);fs()&&(typeof i!="function"||t.hasOwnProperty(e))&&!(o&&o.get)&&(i=Cn(r,e,i)())}return on(i)?pu(i):i},has(t,e){return e===yr||e===jt||e===rr||e===Yt||e===dt||e==="__proto__"?!0:(fs()&&Cn(wr(t,dt),e)(),e in t)},set(){return!0},deleteProperty(){return!0},ownKeys:Gg,getOwnPropertyDescriptor:Wg};function cn(t,e,n,r=!1){if(!r&&t[e]===n)return;const s=t[e],i=t.length;n===void 0?(delete t[e],t[dt]&&t[dt][e]&&s!==void 0&&t[dt][e].$()):(t[e]=n,t[dt]&&t[dt][e]&&s===void 0&&t[dt][e].$());let o=wr(t,Yt),a;if((a=Cn(o,e,s))&&a.$(()=>n),Array.isArray(t)&&t.length!==i){for(let c=t.length;c<i;c++)(a=o[c])&&a.$();(a=Cn(o,"length",i))&&a.$(t.length)}(a=o[_u])&&a.$()}function wu(t,e){const n=Object.keys(e);for(let r=0;r<n.length;r+=1){const s=n[r];cn(t,s,e[s])}}function Xg(t,e){if(typeof e=="function"&&(e=e(t)),e=an(e),Array.isArray(e)){if(t===e)return;let n=0,r=e.length;for(;n<r;n++){const s=e[n];t[n]!==s&&cn(t,n,s)}cn(t,"length",r)}else wu(t,e)}function wn(t,e,n=[]){let r,s=t;if(e.length>1){r=e.shift();const o=typeof r,a=Array.isArray(t);if(Array.isArray(r)){for(let c=0;c<r.length;c++)wn(t,[r[c]].concat(e),n);return}else if(a&&o==="function"){for(let c=0;c<t.length;c++)r(t[c],c)&&wn(t,[c].concat(e),n);return}else if(a&&o==="object"){const{from:c=0,to:u=t.length-1,by:f=1}=r;for(let l=c;l<=u;l+=f)wn(t,[l].concat(e),n);return}else if(e.length>1){wn(t[r],e,[r].concat(n));return}s=t[r],n=[r].concat(n)}let i=e[0];typeof i=="function"&&(i=i(s,n),i===s)||r===void 0&&i==null||(i=an(i),r===void 0||on(s)&&on(i)&&!Array.isArray(i)?wu(s,i):cn(t,r,i))}function _i(...[t,e]){const n=an(t||{}),r=Array.isArray(n),s=pu(n);function i(...o){zs(()=>{r&&o.length===1?Xg(n,o[0]):wn(n,o)})}return[s,i]}const mr=new WeakMap,mu={get(t,e){if(e===yr)return t;const n=t[e];let r;return on(n)?mr.get(n)||(mr.set(n,r=new Proxy(n,mu)),r):n},set(t,e,n){return cn(t,e,an(n)),!0},deleteProperty(t,e){return cn(t,e,void 0,!0),!0}};function js(t){return e=>{if(on(e)){let n;(n=mr.get(e))||mr.set(e,n=new Proxy(e,mu)),t(n)}return e}}var os={exports:{}},ho;function Jg(){return ho||(ho=1,function(t){function e(n){this.__proto__=this.sy={is:"webaudio-tinysynth",properties:{masterVol:{type:Number,value:.5,observer:"setMasterVol"},reverbLev:{type:Number,value:.3,observer:"setReverbLev"},quality:{type:Number,value:1,observer:"setQuality"},debug:{type:Number,value:0},src:{type:String,value:null,observer:"loadMIDIUrl"},loop:{type:Number,value:0},internalcontext:{type:Number,value:1},tsmode:{type:Number,value:0},voices:{type:Number,value:64},useReverb:{type:Number,value:1}},program:[{name:"Acoustic Grand Piano"},{name:"Bright Acoustic Piano"},{name:"Electric Grand Piano"},{name:"Honky-tonk Piano"},{name:"Electric Piano 1"},{name:"Electric Piano 2"},{name:"Harpsichord"},{name:"Clavi"},{name:"Celesta"},{name:"Glockenspiel"},{name:"Music Box"},{name:"Vibraphone"},{name:"Marimba"},{name:"Xylophone"},{name:"Tubular Bells"},{name:"Dulcimer"},{name:"Drawbar Organ"},{name:"Percussive Organ"},{name:"Rock Organ"},{name:"Church Organ"},{name:"Reed Organ"},{name:"Accordion"},{name:"Harmonica"},{name:"Tango Accordion"},{name:"Acoustic Guitar (nylon)"},{name:"Acoustic Guitar (steel)"},{name:"Electric Guitar (jazz)"},{name:"Electric Guitar (clean)"},{name:"Electric Guitar (muted)"},{name:"Overdriven Guitar"},{name:"Distortion Guitar"},{name:"Guitar harmonics"},{name:"Acoustic Bass"},{name:"Electric Bass (finger)"},{name:"Electric Bass (pick)"},{name:"Fretless Bass"},{name:"Slap Bass 1"},{name:"Slap Bass 2"},{name:"Synth Bass 1"},{name:"Synth Bass 2"},{name:"Violin"},{name:"Viola"},{name:"Cello"},{name:"Contrabass"},{name:"Tremolo Strings"},{name:"Pizzicato Strings"},{name:"Orchestral Harp"},{name:"Timpani"},{name:"String Ensemble 1"},{name:"String Ensemble 2"},{name:"SynthStrings 1"},{name:"SynthStrings 2"},{name:"Choir Aahs"},{name:"Voice Oohs"},{name:"Synth Voice"},{name:"Orchestra Hit"},{name:"Trumpet"},{name:"Trombone"},{name:"Tuba"},{name:"Muted Trumpet"},{name:"French Horn"},{name:"Brass Section"},{name:"SynthBrass 1"},{name:"SynthBrass 2"},{name:"Soprano Sax"},{name:"Alto Sax"},{name:"Tenor Sax"},{name:"Baritone Sax"},{name:"Oboe"},{name:"English Horn"},{name:"Bassoon"},{name:"Clarinet"},{name:"Piccolo"},{name:"Flute"},{name:"Recorder"},{name:"Pan Flute"},{name:"Blown Bottle"},{name:"Shakuhachi"},{name:"Whistle"},{name:"Ocarina"},{name:"Lead 1 (square)"},{name:"Lead 2 (sawtooth)"},{name:"Lead 3 (calliope)"},{name:"Lead 4 (chiff)"},{name:"Lead 5 (charang)"},{name:"Lead 6 (voice)"},{name:"Lead 7 (fifths)"},{name:"Lead 8 (bass + lead)"},{name:"Pad 1 (new age)"},{name:"Pad 2 (warm)"},{name:"Pad 3 (polysynth)"},{name:"Pad 4 (choir)"},{name:"Pad 5 (bowed)"},{name:"Pad 6 (metallic)"},{name:"Pad 7 (halo)"},{name:"Pad 8 (sweep)"},{name:"FX 1 (rain)"},{name:"FX 2 (soundtrack)"},{name:"FX 3 (crystal)"},{name:"FX 4 (atmosphere)"},{name:"FX 5 (brightness)"},{name:"FX 6 (goblins)"},{name:"FX 7 (echoes)"},{name:"FX 8 (sci-fi)"},{name:"Sitar"},{name:"Banjo"},{name:"Shamisen"},{name:"Koto"},{name:"Kalimba"},{name:"Bag pipe"},{name:"Fiddle"},{name:"Shanai"},{name:"Tinkle Bell"},{name:"Agogo"},{name:"Steel Drums"},{name:"Woodblock"},{name:"Taiko Drum"},{name:"Melodic Tom"},{name:"Synth Drum"},{name:"Reverse Cymbal"},{name:"Guitar Fret Noise"},{name:"Breath Noise"},{name:"Seashore"},{name:"Bird Tweet"},{name:"Telephone Ring"},{name:"Helicopter"},{name:"Applause"},{name:"Gunshot"}],drummap:[{name:"Acoustic Bass Drum"},{name:"Bass Drum 1"},{name:"Side Stick"},{name:"Acoustic Snare"},{name:"Hand Clap"},{name:"Electric Snare"},{name:"Low Floor Tom"},{name:"Closed Hi Hat"},{name:"High Floor Tom"},{name:"Pedal Hi-Hat"},{name:"Low Tom"},{name:"Open Hi-Hat"},{name:"Low-Mid Tom"},{name:"Hi-Mid Tom"},{name:"Crash Cymbal 1"},{name:"High Tom"},{name:"Ride Cymbal 1"},{name:"Chinese Cymbal"},{name:"Ride Bell"},{name:"Tambourine"},{name:"Splash Cymbal"},{name:"Cowbell"},{name:"Crash Cymbal 2"},{name:"Vibraslap"},{name:"Ride Cymbal 2"},{name:"Hi Bongo"},{name:"Low Bongo"},{name:"Mute Hi Conga"},{name:"Open Hi Conga"},{name:"Low Conga"},{name:"High Timbale"},{name:"Low Timbale"},{name:"High Agogo"},{name:"Low Agogo"},{name:"Cabasa"},{name:"Maracas"},{name:"Short Whistle"},{name:"Long Whistle"},{name:"Short Guiro"},{name:"Long Guiro"},{name:"Claves"},{name:"Hi Wood Block"},{name:"Low Wood Block"},{name:"Mute Cuica"},{name:"Open Cuica"},{name:"Mute Triangle"},{name:"Open Triangle"}],program1:[[{w:"sine",v:.4,d:.7,r:.1},{w:"triangle",v:3,d:.7,s:.1,g:1,a:.01,k:-1.2}],[{w:"triangle",v:.4,d:.7,r:.1},{w:"triangle",v:4,t:3,d:.4,s:.1,g:1,k:-1,a:.01}],[{w:"sine",d:.7,r:.1},{w:"triangle",v:4,f:2,d:.5,s:.5,g:1,k:-1}],[{w:"sine",d:.7,v:.2},{w:"triangle",v:4,t:3,f:2,d:.3,g:1,k:-1,a:.01,s:.5}],[{w:"sine",v:.35,d:.7},{w:"sine",v:3,t:7,f:1,d:1,s:1,g:1,k:-.7}],[{w:"sine",v:.35,d:.7},{w:"sine",v:8,t:7,f:1,d:.5,s:1,g:1,k:-.7}],[{w:"sawtooth",v:.34,d:2},{w:"sine",v:8,f:.1,d:2,s:1,r:2,g:1}],[{w:"triangle",v:.34,d:1.5},{w:"square",v:6,f:.1,d:1.5,s:.5,r:2,g:1}],[{w:"sine",d:.3,r:.3},{w:"sine",v:7,t:11,d:.03,g:1}],[{w:"sine",d:.3,r:.3},{w:"sine",v:11,t:6,d:.2,s:.4,g:1}],[{w:"sine",v:.2,d:.3,r:.3},{w:"sine",v:11,t:5,d:.1,s:.4,g:1}],[{w:"sine",v:.2,d:.6,r:.6},{w:"triangle",v:11,t:5,f:1,s:.5,g:1}],[{w:"sine",v:.3,d:.2,r:.2},{w:"sine",v:6,t:5,d:.02,g:1}],[{w:"sine",v:.3,d:.2,r:.2},{w:"sine",v:7,t:11,d:.03,g:1}],[{w:"sine",v:.2,d:1,r:1},{w:"sine",v:11,t:3.5,d:1,r:1,g:1}],[{w:"triangle",v:.2,d:.5,r:.2},{w:"sine",v:6,t:2.5,d:.2,s:.1,r:.2,g:1}],[{w:"w9999",v:.22,s:.9},{w:"w9999",v:.22,t:2,f:2,s:.9}],[{w:"w9999",v:.2,s:1},{w:"sine",v:11,t:6,f:2,s:.1,g:1,h:.006,r:.002,d:.002},{w:"w9999",v:.2,t:2,f:1,h:0,s:1}],[{w:"w9999",v:.2,d:.1,s:.9},{w:"w9999",v:.25,t:4,f:2,s:.5}],[{w:"w9999",v:.3,a:.04,s:.9},{w:"w9999",v:.2,t:8,f:2,a:.04,s:.9}],[{w:"sine",v:.2,a:.02,d:.05,s:1},{w:"sine",v:6,t:3,f:1,a:.02,d:.05,s:1,g:1}],[{w:"triangle",v:.2,a:.02,d:.05,s:.8},{w:"square",v:7,t:3,f:1,d:.05,s:1.5,g:1}],[{w:"square",v:.2,a:.02,d:.2,s:.5},{w:"square",v:1,d:.03,s:2,g:1}],[{w:"square",v:.2,a:.02,d:.1,s:.8},{w:"square",v:1,a:.3,d:.1,s:2,g:1}],[{w:"sine",v:.3,d:.5,f:1},{w:"triangle",v:5,t:3,f:-1,d:1,s:.1,g:1}],[{w:"sine",v:.4,d:.6,f:1},{w:"triangle",v:12,t:3,d:.6,s:.1,g:1,f:-1}],[{w:"triangle",v:.3,d:1,f:1},{w:"triangle",v:6,f:-1,d:.4,s:.5,g:1,t:3}],[{w:"sine",v:.3,d:1,f:-1},{w:"triangle",v:11,f:1,d:.4,s:.5,g:1,t:3}],[{w:"sine",v:.4,d:.1,r:.01},{w:"sine",v:7,g:1}],[{w:"triangle",v:.4,d:1,f:1},{w:"square",v:4,f:-1,d:1,s:.7,g:1}],[{w:"triangle",v:.35,d:1,f:1},{w:"square",v:7,f:-1,d:.3,s:.5,g:1}],[{w:"sine",v:.2,t:1.5,a:.005,h:.2,d:.6},{w:"sine",v:11,t:5,f:2,d:1,s:.5,g:1}],[{w:"sine",d:.3},{w:"sine",v:4,t:3,d:1,s:1,g:1}],[{w:"sine",d:.3},{w:"sine",v:4,t:3,d:1,s:1,g:1}],[{w:"w9999",d:.3,v:.7,s:.5},{w:"sawtooth",v:1.2,d:.02,s:.5,g:1,h:0,r:.02}],[{w:"sine",d:.3},{w:"sine",v:4,t:3,d:1,s:1,g:1}],[{w:"triangle",v:.3,t:2,d:1},{w:"triangle",v:15,t:2.5,d:.04,s:.1,g:1}],[{w:"triangle",v:.3,t:2,d:1},{w:"triangle",v:15,t:2.5,d:.04,s:.1,g:1}],[{w:"triangle",d:.7},{w:"square",v:.4,t:.5,f:1,d:.2,s:10,g:1}],[{w:"triangle",d:.7},{w:"square",v:.4,t:.5,f:1,d:.2,s:10,g:1}],[{w:"sawtooth",v:.4,a:.1,d:11},{w:"sine",v:5,d:11,s:.2,g:1}],[{w:"sawtooth",v:.4,a:.1,d:11},{w:"sine",v:5,d:11,s:.2,g:1}],[{w:"sawtooth",v:.4,a:.1,d:11},{w:"sine",v:5,t:.5,d:11,s:.2,g:1}],[{w:"sawtooth",v:.4,a:.1,d:11},{w:"sine",v:5,t:.5,d:11,s:.2,g:1}],[{w:"sine",v:.4,a:.1,d:11},{w:"sine",v:6,f:2.5,d:.05,s:1.1,g:1}],[{w:"sine",v:.3,d:.1,r:.1},{w:"square",v:4,t:3,d:1,s:.2,g:1}],[{w:"sine",v:.3,d:.5,r:.5},{w:"sine",v:7,t:2,f:2,d:1,r:1,g:1}],[{w:"triangle",v:.6,h:.03,d:.3,r:.3,t:.5},{w:"n0",v:8,t:1.5,d:.08,r:.08,g:1}],[{w:"sawtooth",v:.3,a:.03,s:.5},{w:"sawtooth",v:.2,t:2,f:2,d:1,s:2}],[{w:"sawtooth",v:.3,f:-2,a:.03,s:.5},{w:"sawtooth",v:.2,t:2,f:2,d:1,s:2}],[{w:"sawtooth",v:.2,a:.02,s:1},{w:"sawtooth",v:.2,t:2,f:2,a:1,d:1,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1},{w:"sawtooth",v:.2,f:2,a:.02,d:1,s:1}],[{w:"triangle",v:.3,a:.03,s:1},{w:"sine",v:3,t:5,f:1,d:1,s:1,g:1}],[{w:"sine",v:.4,a:.03,s:.9},{w:"sine",v:1,t:2,f:3,d:.03,s:.2,g:1}],[{w:"triangle",v:.6,a:.05,s:.5},{w:"sine",v:1,f:.8,d:.2,s:.2,g:1}],[{w:"square",v:.15,a:.01,d:.2,r:.2,t:.5,h:.03},{w:"square",v:4,f:.5,d:.2,r:11,a:.01,g:1,h:.02},{w:"square",v:.15,t:4,f:1,a:.02,d:.15,r:.15,h:.03},{g:3,w:"square",v:4,f:-.5,a:.01,h:.02,d:.15,r:11}],[{w:"square",v:.2,a:.01,d:1,s:.6,r:.04},{w:"sine",v:1,d:.1,s:4,g:1}],[{w:"square",v:.2,a:.02,d:1,s:.5,r:.08},{w:"sine",v:1,d:.1,s:4,g:1}],[{w:"square",v:.2,a:.04,d:1,s:.4,r:.08},{w:"sine",v:1,d:.1,s:4,g:1}],[{w:"square",v:.15,a:.04,s:1},{w:"sine",v:2,d:.1,g:1}],[{w:"square",v:.2,a:.02,d:1,s:.5,r:.08},{w:"sine",v:1,d:.1,s:4,g:1}],[{w:"square",v:.2,a:.02,d:1,s:.6,r:.08},{w:"sine",v:1,f:.2,d:.1,s:4,g:1}],[{w:"square",v:.2,a:.02,d:.5,s:.7,r:.08},{w:"sine",v:1,d:.1,s:4,g:1}],[{w:"square",v:.2,a:.02,d:1,s:.5,r:.08},{w:"sine",v:1,d:.1,s:4,g:1}],[{w:"square",v:.2,a:.02,d:2,s:.6},{w:"sine",v:2,d:1,g:1}],[{w:"square",v:.2,a:.02,d:2,s:.6},{w:"sine",v:2,d:1,g:1}],[{w:"square",v:.2,a:.02,d:1,s:.6},{w:"sine",v:2,d:1,g:1}],[{w:"square",v:.2,a:.02,d:1,s:.6},{w:"sine",v:2,d:1,g:1}],[{w:"sine",v:.4,a:.02,d:.7,s:.5},{w:"square",v:5,t:2,d:.2,s:.5,g:1}],[{w:"sine",v:.3,a:.05,d:.2,s:.8},{w:"sawtooth",v:6,f:.1,d:.1,s:.3,g:1}],[{w:"sine",v:.3,a:.03,d:.2,s:.4},{w:"square",v:7,f:.2,d:1,s:.1,g:1}],[{w:"square",v:.2,a:.05,d:.1,s:.8},{w:"square",v:4,d:.1,s:1.1,g:1}],[{w:"sine",a:.02,d:2},{w:"sine",v:6,t:2,d:.04,g:1}],[{w:"sine",v:.7,a:.03,d:.4,s:.4},{w:"sine",v:4,t:2,f:.2,d:.4,g:1}],[{w:"sine",v:.7,a:.02,d:.4,s:.6},{w:"sine",v:3,t:2,d:0,s:1,g:1}],[{w:"sine",v:.4,a:.06,d:.3,s:.3},{w:"sine",v:7,t:2,d:.2,s:.2,g:1}],[{w:"sine",a:.02,d:.3,s:.3},{w:"sawtooth",v:3,t:2,d:.3,g:1}],[{w:"sine",v:.4,a:.02,d:2,s:.1},{w:"sawtooth",v:8,t:2,f:1,d:.5,g:1}],[{w:"sine",v:.7,a:.03,d:.5,s:.3},{w:"sine",v:.003,t:0,f:4,d:.1,s:.002,g:1}],[{w:"sine",v:.7,a:.02,d:2},{w:"sine",v:1,t:2,f:1,d:.02,g:1}],[{w:"square",v:.3,d:1,s:.5},{w:"square",v:1,f:.2,d:1,s:.5,g:1}],[{w:"sawtooth",v:.3,d:2,s:.5},{w:"square",v:2,f:.1,s:.5,g:1}],[{w:"triangle",v:.5,a:.05,d:2,s:.6},{w:"sine",v:4,t:2,g:1}],[{w:"triangle",v:.3,a:.01,d:2,s:.3},{w:"sine",v:22,t:2,f:1,d:.03,s:.2,g:1}],[{w:"sawtooth",v:.3,d:1,s:.5},{w:"sine",v:11,t:11,a:.2,d:.05,s:.3,g:1}],[{w:"sine",v:.3,a:.06,d:1,s:.5},{w:"sine",v:7,f:1,d:1,s:.2,g:1}],[{w:"sawtooth",v:.3,a:.03,d:.7,s:.3,r:.2},{w:"sawtooth",v:.3,t:.75,d:.7,a:.1,s:.3,r:.2}],[{w:"triangle",v:.3,a:.01,d:.7,s:.5},{w:"square",v:5,t:.5,d:.7,s:.5,g:1}],[{w:"triangle",v:.3,a:.02,d:.3,s:.3,r:.3},{w:"square",v:3,t:4,f:1,a:.02,d:.1,s:1,g:1},{w:"triangle",v:.08,t:.5,a:.1,h:0,d:.1,s:.5,r:.1,b:0,c:0}],[{w:"sine",v:.3,a:.05,d:1,s:.7,r:.3},{w:"sine",v:2,f:1,d:.3,s:1,g:1}],[{w:"square",v:.3,a:.03,d:.5,s:.3,r:.1},{w:"square",v:4,f:1,a:.03,d:.1,g:1}],[{w:"triangle",v:.3,a:.08,d:1,s:.3,r:.1},{w:"square",v:2,f:1,d:.3,s:.3,g:1,t:4,a:.08}],[{w:"sine",v:.3,a:.05,d:1,s:.3,r:.1},{w:"sine",v:.1,t:2.001,f:1,d:1,s:50,g:1}],[{w:"triangle",v:.3,a:.03,d:.7,s:.3,r:.2},{w:"sine",v:12,t:7,f:1,d:.5,s:1.7,g:1}],[{w:"sine",v:.3,a:.05,d:1,s:.3,r:.1},{w:"sawtooth",v:22,t:6,d:.06,s:.3,g:1}],[{w:"triangle",v:.3,a:.05,d:11,r:.3},{w:"triangle",v:1,d:1,s:8,g:1}],[{w:"sawtooth",v:.3,d:4,s:.8,r:.1},{w:"square",v:1,t:2,f:8,a:1,d:1,s:1,r:.1,g:1}],[{w:"triangle",v:.3,d:1,s:.5,t:.8,a:.2,p:1.25,q:.2},{w:"sawtooth",v:.2,a:.2,d:.3,s:1,t:1.2,p:1.25,q:.2}],[{w:"sine",v:.3,d:1,s:.3},{w:"square",v:22,t:11,d:.5,s:.1,g:1}],[{w:"sawtooth",v:.3,a:.04,d:1,s:.8,r:.1},{w:"square",v:1,t:.5,d:1,s:2,g:1}],[{w:"triangle",v:.3,d:1,s:.3},{w:"sine",v:22,t:6,d:.6,s:.05,g:1}],[{w:"sine",v:.6,a:.1,d:.05,s:.4},{w:"sine",v:5,t:5,f:1,d:.05,s:.3,g:1}],[{w:"sine",a:.1,d:.05,s:.4,v:.8},{w:"sine",v:5,t:5,f:1,d:.05,s:.3,g:1}],[{w:"square",v:.3,a:.1,d:.1,s:.4},{w:"square",v:1,f:1,d:.3,s:.1,g:1}],[{w:"sawtooth",v:.3,d:.5,r:.5},{w:"sawtooth",v:11,t:5,d:.05,g:1}],[{w:"square",v:.3,d:.2,r:.2},{w:"square",v:7,t:3,d:.05,g:1}],[{w:"triangle",d:.2,r:.2},{w:"square",v:9,t:3,d:.1,r:.1,g:1}],[{w:"triangle",d:.3,r:.3},{w:"square",v:6,t:3,d:1,r:1,g:1}],[{w:"triangle",v:.4,d:.2,r:.2},{w:"square",v:22,t:12,d:.1,r:.1,g:1}],[{w:"sine",v:.25,a:.02,d:.05,s:.8},{w:"square",v:1,t:2,d:.03,s:11,g:1}],[{w:"sine",v:.3,a:.05,d:11},{w:"square",v:7,t:3,f:1,s:.7,g:1}],[{w:"square",v:.3,a:.05,d:.1,s:.8},{w:"square",v:4,d:.1,s:1.1,g:1}],[{w:"sine",v:.4,d:.3,r:.3},{w:"sine",v:7,t:9,d:.1,r:.1,g:1}],[{w:"sine",v:.7,d:.1,r:.1},{w:"sine",v:22,t:7,d:.05,g:1}],[{w:"sine",v:.6,d:.15,r:.15},{w:"square",v:11,t:3.2,d:.1,r:.1,g:1}],[{w:"sine",v:.8,d:.07,r:.07},{w:"square",v:11,t:7,r:.01,g:1}],[{w:"triangle",v:.7,t:.5,d:.2,r:.2,p:.95},{w:"n0",v:9,g:1,d:.2,r:.2}],[{w:"sine",v:.7,d:.1,r:.1,p:.9},{w:"square",v:14,t:2,d:.005,r:.005,g:1}],[{w:"square",d:.15,r:.15,p:.5},{w:"square",v:4,t:5,d:.001,r:.001,g:1}],[{w:"n1",v:.3,a:1,s:1,d:.15,r:0,t:.5}],[{w:"sine",t:12.5,d:0,r:0,p:.5,v:.3,h:.2,q:.5},{g:1,w:"sine",v:1,t:2,d:0,r:0,s:1},{g:1,w:"n0",v:.2,t:2,a:.6,h:0,d:.1,r:.1,b:0,c:0}],[{w:"n0",v:.2,a:.05,h:.02,d:.02,r:.02}],[{w:"n0",v:.4,a:1,d:1,t:.25}],[{w:"sine",v:.3,a:.1,d:1,s:.5},{w:"sine",v:4,t:0,f:1.5,d:1,s:1,r:.1,g:1},{g:1,w:"sine",v:4,t:0,f:2,a:.6,h:0,d:.1,s:1,r:.1,b:0,c:0}],[{w:"square",v:.3,t:.25,d:11,s:1},{w:"square",v:12,t:0,f:8,d:1,s:1,r:11,g:1}],[{w:"n0",v:.4,t:.5,a:1,d:11,s:1,r:.5},{w:"square",v:1,t:0,f:14,d:1,s:1,r:11,g:1}],[{w:"sine",t:0,f:1221,a:.2,d:1,r:.25,s:1},{g:1,w:"n0",v:3,t:.5,d:1,s:1,r:1}],[{w:"sine",d:.4,r:.4,p:.1,t:2.5,v:1},{w:"n0",v:12,t:2,d:1,r:1,g:1}]],program0:[[{w:"triangle",v:.5,d:.7}],[{w:"triangle",v:.5,d:.7}],[{w:"triangle",v:.5,d:.7}],[{w:"triangle",v:.5,d:.7}],[{w:"triangle",v:.5,d:.7}],[{w:"triangle",v:.5,d:.7}],[{w:"sawtooth",v:.3,d:.7}],[{w:"sawtooth",v:.3,d:.7}],[{w:"sine",v:.5,d:.3,r:.3}],[{w:"triangle",v:.5,d:.3,r:.3}],[{w:"square",v:.2,d:.3,r:.3}],[{w:"square",v:.2,d:.3,r:.3}],[{w:"sine",v:.5,d:.1,r:.1}],[{w:"sine",v:.5,d:.1,r:.1}],[{w:"square",v:.2,d:1,r:1}],[{w:"sawtooth",v:.3,d:.7,r:.7}],[{w:"sine",v:.5,a:.01,s:1}],[{w:"sine",v:.7,d:.02,s:.7}],[{w:"square",v:.2,s:1}],[{w:"triangle",v:.5,a:.01,s:1}],[{w:"square",v:.2,a:.02,s:1}],[{w:"square",v:.2,a:.02,s:1}],[{w:"square",v:.2,a:.02,s:1}],[{w:"square",v:.2,a:.05,s:1}],[{w:"triangle",v:.5,d:.5}],[{w:"square",v:.2,d:.6}],[{w:"square",v:.2,d:.6}],[{w:"triangle",v:.8,d:.6}],[{w:"triangle",v:.4,d:.05}],[{w:"square",v:.2,d:1}],[{w:"square",v:.2,d:1}],[{w:"sine",v:.4,d:.6}],[{w:"triangle",v:.7,d:.4}],[{w:"triangle",v:.7,d:.7}],[{w:"triangle",v:.7,d:.7}],[{w:"triangle",v:.7,d:.7}],[{w:"square",v:.3,d:.2}],[{w:"square",v:.3,d:.2}],[{w:"square",v:.3,d:.1,s:.2}],[{w:"sawtooth",v:.4,d:.1,s:.2}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.3,d:.1}],[{w:"sawtooth",v:.3,d:.5,r:.5}],[{w:"triangle",v:.6,d:.1,r:.1,h:.03,p:.8}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"sawtooth",v:.2,a:.02,s:1}],[{w:"triangle",v:.3,a:.03,s:1}],[{w:"sine",v:.3,a:.03,s:1}],[{w:"triangle",v:.3,a:.05,s:1}],[{w:"sawtooth",v:.5,a:.01,d:.1}],[{w:"square",v:.3,a:.05,d:.2,s:.6}],[{w:"square",v:.3,a:.05,d:.2,s:.6}],[{w:"square",v:.3,a:.05,d:.2,s:.6}],[{w:"square",v:.2,a:.05,d:.01,s:1}],[{w:"square",v:.3,a:.05,s:1}],[{w:"square",v:.3,s:.7}],[{w:"square",v:.3,s:.7}],[{w:"square",v:.3,s:.7}],[{w:"square",v:.3,a:.02,d:2}],[{w:"square",v:.3,a:.02,d:2}],[{w:"square",v:.3,a:.03,d:2}],[{w:"square",v:.3,a:.04,d:2}],[{w:"square",v:.3,a:.02,d:2}],[{w:"square",v:.3,a:.05,d:2}],[{w:"square",v:.3,a:.03,d:2}],[{w:"square",v:.3,a:.03,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"sine",v:.7,a:.02,d:2}],[{w:"square",v:.3,s:.7}],[{w:"sawtooth",v:.4,s:.7}],[{w:"triangle",v:.5,s:.7}],[{w:"sawtooth",v:.4,s:.7}],[{w:"sawtooth",v:.4,d:12}],[{w:"sine",v:.4,a:.06,d:12}],[{w:"sawtooth",v:.4,d:12}],[{w:"sawtooth",v:.4,d:12}],[{w:"sawtooth",v:.3,d:12}],[{w:"triangle",v:.5,d:12}],[{w:"square",v:.3,d:12}],[{w:"triangle",v:.5,a:.08,d:11}],[{w:"sawtooth",v:.5,a:.05,d:11}],[{w:"sawtooth",v:.5,d:11}],[{w:"triangle",v:.5,d:11}],[{w:"triangle",v:.5,d:11}],[{w:"triangle",v:.5,d:11}],[{w:"triangle",v:.5,d:11}],[{w:"square",v:.3,d:11}],[{w:"sawtooth",v:.5,a:.04,d:11}],[{w:"sawtooth",v:.5,d:11}],[{w:"triangle",v:.5,a:.8,d:11}],[{w:"triangle",v:.5,d:11}],[{w:"square",v:.3,d:11}],[{w:"sawtooth",v:.3,d:1,r:1}],[{w:"sawtooth",v:.5,d:.3}],[{w:"sawtooth",v:.5,d:.3,r:.3}],[{w:"sawtooth",v:.5,d:.3,r:.3}],[{w:"square",v:.3,d:.2,r:.2}],[{w:"square",v:.3,a:.02,d:2}],[{w:"sawtooth",v:.2,a:.02,d:.7}],[{w:"triangle",v:.5,d:1}],[{w:"sawtooth",v:.3,d:.3,r:.3}],[{w:"sine",v:.8,d:.1,r:.1}],[{w:"square",v:.2,d:.1,r:.1,p:1.05}],[{w:"sine",v:.8,d:.05,r:.05}],[{w:"triangle",v:.5,d:.1,r:.1,p:.96}],[{w:"triangle",v:.5,d:.1,r:.1,p:.97}],[{w:"square",v:.3,d:.1,r:.1}],[{w:"n1",v:.3,a:1,s:1,d:.15,r:0,t:.5}],[{w:"triangle",v:.5,d:.03,t:0,f:1332,r:.001,p:1.1}],[{w:"n0",v:.2,t:.1,d:.02,a:.05,h:.02,r:.02}],[{w:"n0",v:.4,a:1,d:1,t:.25}],[{w:"sine",v:.3,a:.8,d:1,t:0,f:1832}],[{w:"triangle",d:.5,t:0,f:444,s:1}],[{w:"n0",v:.4,d:1,t:0,f:22,s:1}],[{w:"n0",v:.5,a:.2,d:11,t:0,f:44}],[{w:"n0",v:.5,t:.25,d:.4,r:.4}]],drummap1:[[{w:"triangle",t:0,f:70,v:1,d:.05,h:.03,p:.9,q:.1},{w:"n0",g:1,t:6,v:17,r:.01,h:0,p:0}],[{w:"triangle",t:0,f:88,v:1,d:.05,h:.03,p:.5,q:.1},{w:"n0",g:1,t:5,v:42,r:.01,h:0,p:0}],[{w:"n0",f:222,p:0,t:0,r:.01,h:0}],[{w:"triangle",v:.3,f:180,d:.05,t:0,h:.03,p:.9,q:.1},{w:"n0",v:.6,t:0,f:70,h:.02,r:.01,p:0},{g:1,w:"square",v:2,t:0,f:360,r:.01,b:0,c:0}],[{w:"square",f:1150,v:.34,t:0,r:.03,h:.025,d:.03},{g:1,w:"n0",t:0,f:13,h:.025,d:.1,s:1,r:.1,v:1}],[{w:"triangle",f:200,v:1,d:.06,t:0,r:.06},{w:"n0",g:1,t:0,f:400,v:12,r:.02,d:.02}],[{w:"triangle",f:100,v:.9,d:.12,h:.02,p:.5,t:0,r:.12},{g:1,w:"n0",v:5,t:.4,h:.015,d:.005,r:.005}],[{w:"n1",f:390,v:.25,r:.01,t:0}],[{w:"triangle",f:120,v:.9,d:.12,h:.02,p:.5,t:0,r:.12},{g:1,w:"n0",v:5,t:.5,h:.015,d:.005,r:.005}],[{w:"n1",v:.25,f:390,r:.03,t:0,h:.005,d:.03}],[{w:"triangle",f:140,v:.9,d:.12,h:.02,p:.5,t:0,r:.12},{g:1,w:"n0",v:5,t:.3,h:.015,d:.005,r:.005}],[{w:"n1",v:.25,f:390,t:0,d:.2,r:.2},{w:"n0",v:.3,t:0,c:0,f:440,h:.005,d:.05}],[{w:"triangle",f:155,v:.9,d:.12,h:.02,p:.5,t:0,r:.12},{g:1,w:"n0",v:5,t:.3,h:.015,d:.005,r:.005}],[{w:"triangle",f:180,v:.9,d:.12,h:.02,p:.5,t:0,r:.12},{g:1,w:"n0",v:5,t:.3,h:.015,d:.005,r:.005}],[{w:"n1",v:.3,f:1200,d:.2,r:.2,h:.05,t:0},{w:"n1",t:0,v:1,d:.1,r:.1,p:1.2,f:440}],[{w:"triangle",f:220,v:.9,d:.12,h:.02,p:.5,t:0,r:.12},{g:1,w:"n0",v:5,t:.3,h:.015,d:.005,r:.005}],[{w:"n1",f:500,v:.15,d:.4,r:.4,h:0,t:0},{w:"n0",v:.1,t:0,r:.01,f:440}],[{w:"n1",v:.3,f:800,d:.2,r:.2,h:.05,t:0},{w:"square",t:0,v:1,d:.1,r:.1,p:.1,f:220,g:1}],[{w:"sine",f:1651,v:.15,d:.2,r:.2,h:0,t:0},{w:"sawtooth",g:1,t:1.21,v:7.2,d:.1,r:11,h:1},{g:1,w:"n0",v:3.1,t:.152,d:.002,r:.002}],null,[{w:"n1",v:.3,f:1200,d:.2,r:.2,h:.05,t:0},{w:"n1",t:0,v:1,d:.1,r:.1,p:1.2,f:440}],null,[{w:"n1",v:.3,f:555,d:.25,r:.25,h:.05,t:0},{w:"n1",t:0,v:1,d:.1,r:.1,f:440,a:.005,h:.02}],[{w:"sawtooth",f:776,v:.2,d:.3,t:0,r:.3},{g:1,w:"n0",v:2,t:0,f:776,a:.005,h:.02,d:.1,s:1,r:.1,c:0},{g:11,w:"sine",v:.1,t:0,f:22,d:.3,r:.3,b:0,c:0}],[{w:"n1",f:440,v:.15,d:.4,r:.4,h:0,t:0},{w:"n0",v:.4,t:0,r:.01,f:440}],null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,[{w:"sine",f:1720,v:.3,d:.02,t:0,r:.02},{w:"square",g:1,t:0,f:2876,v:6,d:.2,s:1,r:.2}],[{w:"sine",f:1720,v:.3,d:.25,t:0,r:.25},{w:"square",g:1,t:0,f:2876,v:6,d:.2,s:1,r:.2}]],drummap0:[[{w:"triangle",t:0,f:110,v:1,d:.05,h:.02,p:.1}],[{w:"triangle",t:0,f:150,v:.8,d:.1,p:.1,h:.02,r:.01}],[{w:"n0",f:392,v:.5,d:.01,p:0,t:0,r:.05}],[{w:"n0",f:33,d:.05,t:0}],[{w:"n0",f:100,v:.7,d:.03,t:0,r:.03,h:.02}],[{w:"n0",f:44,v:.7,d:.02,p:.1,t:0,h:.02}],[{w:"triangle",f:240,v:.9,d:.1,h:.02,p:.1,t:0}],[{w:"n0",f:440,v:.2,r:.01,t:0}],[{w:"triangle",f:270,v:.9,d:.1,h:.02,p:.1,t:0}],[{w:"n0",f:440,v:.2,d:.04,r:.04,t:0}],[{w:"triangle",f:300,v:.9,d:.1,h:.02,p:.1,t:0}],[{w:"n0",f:440,v:.2,d:.1,r:.1,h:.02,t:0}],[{w:"triangle",f:320,v:.9,d:.1,h:.02,p:.1,t:0}],[{w:"triangle",f:360,v:.9,d:.1,h:.02,p:.1,t:0}],[{w:"n0",f:150,v:.2,d:.1,r:.1,h:.05,t:0,p:.1}],[{w:"triangle",f:400,v:.9,d:.1,h:.02,p:.1,t:0}],[{w:"n0",f:150,v:.2,d:.1,r:.01,h:.05,t:0,p:.1}],[{w:"n0",f:150,v:.2,d:.1,r:.01,h:.05,t:0,p:.1}],[{w:"n0",f:440,v:.3,d:.1,p:.9,t:0,r:.1}],[{w:"n0",f:200,v:.2,d:.05,p:.9,t:0}],[{w:"n0",f:440,v:.3,d:.12,p:.9,t:0}],[{w:"sine",f:800,v:.4,d:.06,t:0}],[{w:"n0",f:150,v:.2,d:.1,r:.01,h:.05,t:0,p:.1}],[{w:"n0",f:33,v:.3,d:.2,p:.9,t:0}],[{w:"n0",f:300,v:.3,d:.14,p:.9,t:0}],[{w:"sine",f:200,d:.06,t:0}],[{w:"sine",f:150,d:.06,t:0}],[{w:"sine",f:300,t:0}],[{w:"sine",f:300,d:.06,t:0}],[{w:"sine",f:250,d:.06,t:0}],[{w:"square",f:300,v:.3,d:.06,p:.8,t:0}],[{w:"square",f:260,v:.3,d:.06,p:.8,t:0}],[{w:"sine",f:850,v:.5,d:.07,t:0}],[{w:"sine",f:790,v:.5,d:.07,t:0}],[{w:"n0",f:440,v:.3,a:.05,t:0}],[{w:"n0",f:440,v:.3,a:.05,t:0}],[{w:"triangle",f:1800,v:.4,p:.9,t:0,h:.03}],[{w:"triangle",f:1800,v:.3,p:.9,t:0,h:.13}],[{w:"n0",f:330,v:.3,a:.02,t:0,r:.01}],[{w:"n0",f:330,v:.3,a:.02,t:0,h:.04,r:.01}],[{w:"n0",f:440,v:.3,t:0}],[{w:"sine",f:800,t:0}],[{w:"sine",f:700,t:0}],[{w:"n0",f:330,v:.3,t:0}],[{w:"n0",f:330,v:.3,t:0,h:.1,r:.01,p:.7}],[{w:"sine",t:0,f:1200,v:.3,r:.01}],[{w:"sine",t:0,f:1200,v:.3,d:.2,r:.2}]],ready:function(){var s;this.pg=[],this.vol=[],this.ex=[],this.bend=[],this.rpnidx=[],this.brange=[],this.sustain=[],this.notetab=[],this.rhythm=[],this.maxTick=0,this.playTick=0,this.playing=0,this.releaseRatio=3.5;for(var s=0;s<16;++s)this.pg[s]=0,this.vol[s]=3*100*100/(127*127),this.bend[s]=0,this.brange[s]=256,this.rhythm[s]=0;this.rhythm[9]=1,this.preroll=.2,this.relcnt=0,setInterval(function(){if(++this.relcnt>=3){this.relcnt=0;for(var i=this.notetab.length-1;i>=0;--i){var o=this.notetab[i];this.actx.currentTime>o.e&&(this._pruneNote(o),this.notetab.splice(i,1))}}if(this.playing&&this.song.ev.length>0)for(var a=this.song.ev[this.playIndex];this.actx.currentTime+this.preroll>this.playTime;)if(a.m[0]==65361?(this.song.tempo=a.m[1],this.tick2Time=4*60/this.song.tempo/this.song.timebase):this.send(a.m,this.playTime),++this.playIndex,this.playIndex>=this.song.ev.length)if(this.loop)a=this.song.ev[this.playIndex=0],this.playTick=a.t;else{this.playTick=this.maxTick,this.playing=0;break}else a=this.song.ev[this.playIndex],this.playTime+=(a.t-this.playTick)*this.tick2Time,this.playTick=a.t}.bind(this),60),this.internalcontext&&(window.AudioContext=window.AudioContext||window.webkitAudioContext,this.setAudioContext(new AudioContext)),this.isReady=1},setMasterVol:function(s){s!=null&&(this.masterVol=s),this.out&&(this.out.gain.value=this.masterVol)},setReverbLev:function(s){s!=null&&(this.reverbLev=s);var i=parseFloat(this.reverbLev);this.rev&&!isNaN(i)&&(this.rev.gain.value=i*8)},setLoop:function(s){this.loop=s},setVoices:function(s){this.voices=s},getPlayStatus:function(){return{play:this.playing,maxTick:this.maxTick,curTick:this.playTick}},locateMIDI:function(s){var i,o=this.playing;for(this.stopMIDI(),i=0;i<this.song.ev.length&&s>this.song.ev[i].t;++i){var a=this.song.ev[i],c=a.m[0]&15;switch(a.m[0]&240){case 176:switch(a.m[1]){case 1:this.setModulation(c,a.m[2]);break;case 7:this.setChVol(c,a.m[2]);break;case 10:this.setPan(c,a.m[2]);break;case 11:this.setExpression(c,a.m[2]);break;case 64:this.setSustain(c,a.m[2]);break}break;case 192:this.pg[a.m[0]&15]=a.m[1];break}a.m[0]==65361&&(this.song.tempo=a.m[1])}this.song.ev[i]?(this.playIndex=i,this.playTick=this.song.ev[i].t):(this.playIndex=0,this.playTick=this.maxTick),o&&this.playMIDI()},getTimbreName:function(s,i){return s==0?this.program[i].name:this.drummap[i-35].name},loadMIDIUrl:function(s){if(s){var i=new XMLHttpRequest;i.open("GET",s,!0),i.responseType="arraybuffer",i.loadMIDI=this.loadMIDI.bind(this),i.onload=function(o){this.status==200&&this.loadMIDI(this.response)},i.send()}},reset:function(){for(var s=0;s<16;++s)this.setProgram(s,0),this.setBendRange(s,256),this.setChVol(s,100),this.setPan(s,64),this.resetAllControllers(s),this.allSoundOff(s),this.rhythm[s]=0;this.rhythm[9]=1},stopMIDI:function(){this.playing=0;for(var s=0;s<16;++s)this.allSoundOff(s)},playMIDI:function(){if(this.song){var s=this.actx.createOscillator();s.connect(this.actx.destination),s.frequency.value=0,s.start(0),s.stop(this.actx.currentTime+.001),this.playTick>=this.maxTick&&(this.playTick=0,this.playIndex=0),this.playTime=this.actx.currentTime+.1,this.tick2Time=4*60/this.song.tempo/this.song.timebase,this.playing=1}},loadMIDI:function(s){function i(U,H){return(U[H]<<8)+U[H+1]}function o(U,H){return(U[H]<<16)+(U[H+1]<<8)+U[H+2]}function a(U,H){return(U[H]<<24)+(U[H+1]<<16)+(U[H+2]<<8)+U[H+3]}function c(U,H,V){return String.fromCharCode.apply(null,U.slice(H,H+V))}function u(U,H){var V,I;for(V=0,d=1;(I=U[H])&128;)V=(V<<7)+(I&127),++d,++H;return(V<<7)+I}function f(U,H,V,I){var W=V[I];switch(d=1,W&128||(W=g,d=0),g=W,W&240){case 192:case 208:U.ev.push({t:H,m:[W,V[I+d]]}),d+=1;break;case 240:switch(W){case 240:case 247:var j=u(V,I+1);h=1+d;var m=Array.from(V.slice(I+h,I+h+j));m.unshift(240),U.ev.push({t:H,m}),d+=j+1;break;case 255:var j=u(V,I+2);switch(h=2+d,d=j+d+2,V[I+1]){case 2:U.copyright+=c(V,I+h,d-3);break;case 1:case 3:case 4:case 9:U.text=c(V,I+h,d-h);break;case 47:return 1;case 81:var O=Math.floor(6e7/o(V,I+3));U.ev.push({t:H,m:[65361,O]});break}break}break;default:U.ev.push({t:H,m:[W,V[I+d],V[I+d+1]]}),d+=2}return 0}this.stopMIDI();var l=new Uint8Array(s),d=0,h=0,g=144,w=0,x=l.slice(0,4);if(x.toString()=="77,84,104,100"){var v=a(l,4);i(l,8);var M=i(l,10);this.maxTick=0;var k=i(l,12)*4;w=v+8,this.song={copyright:"",text:"",tempo:120,timebase:k,ev:[]};for(var F=0;F<M;++F){if(x=l.slice(w,w+4),v=a(l,w+4),x.toString()=="77,84,114,107"){var A=0,q=0;for(this.notetab.length=0;;){A+=u(l,w+8+q),q+=d;var Y=f(this.song,A,l,w+8+q);if(q+=d,Y)break}A>this.maxTick&&(this.maxTick=A)}w+=v+8}this.song.ev.sort(function(U,H){return U.t-H.t}),this.reset(),this.locateMIDI(0)}},setQuality:function(s){var i;for(s!=null&&(this.quality=s),i=0;i<128;++i)this.setTimbre(0,i,this.program0[i]);for(i=0;i<this.drummap0.length;++i)this.setTimbre(1,i+35,this.drummap0[i]);if(this.quality){for(i=0;i<this.program1.length;++i)this.setTimbre(0,i,this.program1[i]);for(i=0;i<this.drummap.length;++i)this.drummap1[i]&&this.setTimbre(1,i+35,this.drummap1[i])}},setTimbre:function(s,i,o){var a={g:0,w:"sine",t:1,f:0,v:.5,a:0,h:.01,d:.01,s:0,r:.05,p:1,q:1,k:0};function c(u){for(i=0;i<u.length;++i)for(r in a)(!u[i].hasOwnProperty(r)||typeof u[i][r]>"u")&&(u[i][r]=a[r]);return u}s&&i>=35&&i<=81&&(this.drummap[i-35].p=c(o)),s==0&&i>=0&&i<=127&&(this.program[i].p=c(o))},_pruneNote:function(s){for(var i=s.o.length-1;i>=0;--i)s.o[i].frequency&&this.chmod[s.ch].disconnect(s.o[i].detune),s.o[i].disconnect(),s.o[i].frequency?s.o[i].frequency.cancelScheduledValues(0):s.o[i].playbackRate.cancelScheduledValues(0),s.o[i].stop(0);for(var i=s.g.length-1;i>=0;--i)s.g[i].disconnect(),s.g[i].gain.cancelScheduledValues(0)},_limitVoices:function(s,i){this.notetab.sort(function(c,u){return c.f!=u.f?c.f-u.f:c.e!=u.e?u.e-c.e:u.t-c.t});for(var o=this.notetab.length-1;o>=0;--o){var a=this.notetab[o];(this.actx.currentTime>a.e||o>=this.voices-1)&&(this._pruneNote(a),this.notetab.splice(o,1))}},_note:function(s,i,o,a,c){var u=[],f=[],l=[],d=[],h=[],g,w,x,v,M=440*Math.pow(2,(o-69)/12);for(this._limitVoices(i,o),g=0;g<c.length;++g){v=c[g];var k=s+v.a+v.h;switch(v.g==0?(w=this.chvol[i],x=a*a/16384,d[g]=M*v.t+v.f):v.g>10?(w=f[v.g-11].gain,x=1,d[g]=d[v.g-11]*v.t+v.f):u[v.g-1].frequency?(w=u[v.g-1].frequency,x=d[v.g-1],d[g]=d[v.g-1]*v.t+v.f):(w=u[v.g-1].playbackRate,x=d[v.g-1]/440,d[g]=d[v.g-1]*v.t+v.f),v.w[0]){case"n":u[g]=this.actx.createBufferSource(),u[g].buffer=this.noiseBuf[v.w],u[g].loop=!0,u[g].playbackRate.value=d[g]/440,v.p!=1&&this._setParamTarget(u[g].playbackRate,d[g]/440*v.p,s,v.q);break;default:u[g]=this.actx.createOscillator(),u[g].frequency.value=d[g],v.p!=1&&this._setParamTarget(u[g].frequency,d[g]*v.p,s,v.q),v.w[0]=="w"?u[g].setPeriodicWave(this.wave[v.w]):u[g].type=v.w,this.chmod[i].connect(u[g].detune),u[g].detune.value=this.bend[i];break}f[g]=this.actx.createGain(),h[g]=v.r,u[g].connect(f[g]),f[g].connect(w),l[g]=x*v.v,v.k&&(l[g]*=Math.pow(2,(o-60)/12*v.k)),v.a?(f[g].gain.value=0,f[g].gain.setValueAtTime(0,s),f[g].gain.linearRampToValueAtTime(l[g],s+v.a)):f[g].gain.setValueAtTime(l[g],s),this._setParamTarget(f[g].gain,v.s*l[g],k,v.d),u[g].start(s),this.rhythm[i]&&u[g].stop(s+c[0].d*this.releaseRatio)}this.rhythm[i]||this.notetab.push({t:s,e:99999,ch:i,n:o,o:u,g:f,t2:s+v.a,v:l,r:h,f:0})},_setParamTarget:function(s,i,o,a){a!=0?s.setTargetAtTime(i,o,a):s.setValueAtTime(i,o)},_releaseNote:function(s,i){if(s.ch!=9)for(var o=s.g.length-1;o>=0;--o)s.g[o].gain.cancelScheduledValues(i),i==s.t2?s.g[o].gain.setValueAtTime(s.v[o],i):i<s.t2&&s.g[o].gain.setValueAtTime(s.v[o]*(i-s.t)/(s.t2-s.t),i),this._setParamTarget(s.g[o].gain,0,i,s.r[o]);s.e=i+s.r[0]*this.releaseRatio,s.f=1},setModulation:function(s,i,o){this.chmod[s].gain.setValueAtTime(i*100/127,this._tsConv(o))},setChVol:function(s,i,o){this.vol[s]=3*i*i/(127*127),this.chvol[s].gain.setValueAtTime(this.vol[s]*this.ex[s],this._tsConv(o))},setPan:function(s,i,o){this.chpan[s]&&this.chpan[s].pan.setValueAtTime((i-64)/64,this._tsConv(o))},setExpression:function(s,i,o){this.ex[s]=i*i/(127*127),this.chvol[s].gain.setValueAtTime(this.vol[s]*this.ex[s],this._tsConv(o))},setSustain:function(s,i,o){if(this.sustain[s]=i,o=this._tsConv(o),i<64)for(var a=this.notetab.length-1;a>=0;--a){var c=this.notetab[a];o>=c.t&&c.ch==s&&c.f==1&&this._releaseNote(c,o)}},allSoundOff:function(s){for(var i=this.notetab.length-1;i>=0;--i){var o=this.notetab[i];o.ch==s&&(this._pruneNote(o),this.notetab.splice(i,1))}},resetAllControllers:function(s){this.bend[s]=0,this.ex[s]=1,this.rpnidx[s]=16383,this.sustain[s]=0,this.chvol[s]&&(this.chvol[s].gain.value=this.vol[s]*this.ex[s],this.chmod[s].gain.value=0)},setBendRange:function(s,i){this.brange[s]=i},setProgram:function(s,i){this.debug&&console.log("Pg("+s+")="+i),this.pg[s]=i},setBend:function(s,i,o){o=this._tsConv(o);var a=this.brange[s]*100/127;this.bend[s]=(i-8192)*a/8192;for(var c=this.notetab.length-1;c>=0;--c){var u=this.notetab[c];if(u.ch==s)for(var f=u.o.length-1;f>=0;--f)u.o[f].frequency&&u.o[f].detune.setValueAtTime(this.bend[s],o)}},noteOn:function(s,i,o,a){if(o==0){this.noteOff(s,i,a);return}if(a=this._tsConv(a),this.rhythm[s]){i>=35&&i<=81&&this._note(a,s,i,o,this.drummap[i-35].p);return}this._note(a,s,i,o,this.program[this.pg[s]].p)},noteOff:function(s,i,o){if(!this.rhythm[s]){o=this._tsConv(o);for(var a=this.notetab.length-1;a>=0;--a){var c=this.notetab[a];o>=c.t&&c.ch==s&&c.n==i&&c.f==0&&(c.f=1,this.sustain[s]<64&&this._releaseNote(c,o))}}},_tsConv:function(s){return s==null||s<=0?(s=0,this.actx&&(s=this.actx.currentTime)):this.tsmode&&(s=s*.001-this.tsdiff),s},setTsMode:function(s){this.tsmode=s},send:function(s,i){var o=s[0]&15,a=s[0]&-16;if(!(a<128||a>=256))switch(a){case 176:switch(s[1]){case 1:this.setModulation(o,s[2],i);break;case 7:this.setChVol(o,s[2],i);break;case 10:this.setPan(o,s[2],i);break;case 11:this.setExpression(o,s[2],i);break;case 64:this.setSustain(o,s[2],i);break;case 98:case 98:this.rpnidx[o]=16383;break;case 100:this.rpnidx[o]=this.rpnidx[o]&896|s[2];break;case 101:this.rpnidx[o]=this.rpnidx[o]&127|s[2]<<7;break;case 6:this.rpnidx[o]==0&&(this.brange[o]=(s[2]<<7)+(this.brange[o]&127));break;case 38:this.rpnidx[o]==0&&(this.brange[o]=this.brange[o]&896|s[2]);break;case 120:case 123:case 124:case 125:case 126:case 127:this.allSoundOff(o);break;case 121:this.resetAllControllers(o);break}break;case 192:this.setProgram(o,s[1]);break;case 224:this.setBend(o,s[1]+(s[2]<<7),i);break;case 144:this.noteOn(o,s[1],s[2],i);break;case 128:this.noteOff(o,s[1],i);break;case 240:if(s[0]!=254&&this.debug){for(var c=[],u=0;u<s.length;++u)c.push(s[u].toString(16));console.log(c)}if(s[1]==65&&s[2]==16&&s[3]==66&&s[4]==18&&s[5]==64&&(s[6]&240)==16&&s[7]==21){var o=[9,0,1,2,3,4,5,6,7,8,10,11,12,13,14,15][s[6]&15];this.rhythm[o]=s[8]}break}},_createWave:function(s){for(var i=new Float32Array(s.length),o=new Float32Array(s.length),a=1;a<s.length;++a)i[a]=s[a];return this.actx.createPeriodicWave(o,i)},getAudioContext:function(){return this.actx},setAudioContext:function(s,i){this.audioContext=this.actx=s,this.dest=i,i||(this.dest=s.destination),this.tsdiff=performance.now()*.001-this.actx.currentTime,this.out=this.actx.createGain(),this.comp=this.actx.createDynamicsCompressor();var o=this.actx.sampleRate*.5|0;this.convBuf=this.actx.createBuffer(2,o,this.actx.sampleRate),this.noiseBuf={},this.noiseBuf.n0=this.actx.createBuffer(1,o,this.actx.sampleRate),this.noiseBuf.n1=this.actx.createBuffer(1,o,this.actx.sampleRate);for(var a=this.convBuf.getChannelData(0),c=this.convBuf.getChannelData(1),u=this.noiseBuf.n0.getChannelData(0),f=this.noiseBuf.n1.getChannelData(0),l=0;l<o;++l)l/o<Math.random()&&(a[l]=Math.exp(-3*l/o)*(Math.random()-.5)*.5,c[l]=Math.exp(-3*l/o)*(Math.random()-.5)*.5),u[l]=Math.random()*2-1;for(var d=0;d<64;++d){var h=Math.random()*10+1,g=Math.random()*10+1;for(l=0;l<o;++l){var w=Math.sin(l/o*2*Math.PI*440*h)*Math.sin(l/o*2*Math.PI*440*g);f[l]+=w/8}}for(this.useReverb&&(this.conv=this.actx.createConvolver(),this.conv.buffer=this.convBuf,this.rev=this.actx.createGain(),this.rev.gain.value=this.reverbLev,this.out.connect(this.conv),this.conv.connect(this.rev),this.rev.connect(this.comp)),this.setMasterVol(),this.out.connect(this.comp),this.comp.connect(this.dest),this.chvol=[],this.chmod=[],this.chpan=[],this.wave={w9999:this._createWave("w9999")},this.lfo=this.actx.createOscillator(),this.lfo.frequency.value=5,this.lfo.start(0),l=0;l<16;++l)this.chvol[l]=this.actx.createGain(),this.actx.createStereoPanner?(this.chpan[l]=this.actx.createStereoPanner(),this.chvol[l].connect(this.chpan[l]),this.chpan[l].connect(this.out)):(this.chpan[l]=null,this.chvol[l].connect(this.out)),this.chmod[l]=this.actx.createGain(),this.lfo.connect(this.chmod[l]),this.pg[l]=0,this.resetAllControllers(l);this.setReverbLev(),this.reset(),this.send([144,60,1]),this.send([144,60,0])}};for(var r in this.sy.properties)this[r]=this.sy.properties[r].value;this.setQuality(1),n&&(n.useReverb!=null&&(this.useReverb=n.useReverb),n.quality!=null&&this.setQuality(n.quality),n.voices!=null&&this.setVoices(n.voices)),this.ready()}t.exports=e}(os)),os.exports}var as,go;function Yg(){if(go)return as;go=1;var t=Jg();as=e;function e(n,r){var s=0,i=127,o=35,a=81,c=new t({useReverb:1,quality:1,voices:32});n&&c.setAudioContext(n,r);for(var u=i-s+1,f=a-o+1,l=[],d=0;d<u;d++)l.push(c.getTimbreName(0,d+s));for(var h=0;h<f;h++)l.push(c.getTimbreName(1,h+o));this._synth=c,this.names=l,this.setQuality=function(M){c.setQuality(M?1:0)},this.getCurrentTime=function(){return c.actx.currentTime},this.play=function(M,k,F,A,q,Y,U){if(M=M||0,M<0||M>i+f)throw"Invalid instrument";k=k||60,A=A||0,isNaN(F)&&(F=.5),isNaN(q)&&(q=.5),A<0&&(A=0),g(M,k,F,A,q,Y,U)};function g(M,k,F,A,q,Y,U){var H=M>=u;Y=Y|0,H?(Y=9,k=M+o-u):(M-=s,c.setProgram(Y,M));var V=c.actx.currentTime,I=127*F|0,W=c.program[c.pg[Y]].p;k>127&&(w(W,"f",k),w(W,"t",0)),U&&w(W,"a",U),c.noteOn(Y,k,I,V+A),c.noteOff(Y,k,V+A+q),k>127&&(v(W,"f"),v(W,"t")),U&&v(W,"a")}function w(M,k,F){for(var A=x[k]||[0,0,0,0,0],q=0;q<M.length;q++){var Y=M[q];Y.g===0&&(A[q]=Y[k],Y[k]=F)}x[k]=A}var x={};function v(M,k){for(var F=x[k],A=0;A<M.length;A++){var q=M[A];q.g===0&&(q[k]=F[A])}}}return as}var Zg=Yg();const Qg=Sr(Zg);function _o(t){return typeof t=="object"&&typeof t!=null&&Object.getPrototypeOf(t)==Object.prototype}function e_(t,e,n,r,s){let i=e,o=[...t];for(;;){let a=o.shift();if(!o.length){typeof s=="function"&&(r=s(r,a,e,t,i,n));const u=Array.isArray(n);if(_o(e)&&u&&typeof a>"u"&&typeof n[0]=="string"){delete e[n[0]];return}if(u||typeof n=="number"){if(typeof a>"u")throw new Error("cant treat top level as a seq");a=a;let[f,l]=Array.isArray(n)?n:[n,n+1];const d=Array.isArray(n)&&n.length==0;if(!d&&(f==null||l==null))throw new RangeError("it's all or nothing, no half measures");const h=typeof r>"u";let x=h?"del":d&&!h?"add":f===l&&!h?"ins":"replace";typeof e[a]>"u"&&(typeof r=="string"?e[a]="":e[a]=[]);let v=e[a];if(Array.isArray(v))switch(x){case"add":{Array.isArray(r)?v.push(...r):v.push(r);return}case"replace":case"ins":{Array.isArray(r)?v.splice(f,l-f,...r):v.splice(f,l-f,r);return}case"del":{v.splice(f,l-f);return}default:throw new Error("i don't know what happened")}if(typeof v=="string")switch(x){case"add":{e[a]=v+r;return}case"replace":case"ins":{e[a]=v.slice(0,f)+(typeof r=="string"?r:r.join(""))+v.slice(l);return}case"del":{e[a]=v.slice(0,f)+v.slice(l);return}default:throw new Error("i don't know what happened")}throw _o(v)&&u&&typeof n[0]=="string"&&delete v[n[0]],new Error("not implemented")}if(typeof a>"u"){if(typeof n!="string")throw new Error(`can't index top-level map with ${n}`);typeof r>"u"?delete e[n]:e[n]=r;return}if(typeof e[a]>"u"&&(e[a]={}),u){let[f,l]=n;f!=null&&l!=null&&(typeof r>"u"&&f!=null&&l!=null?delete e[a][f||l]:e[a][f||l]=r)}else typeof r>"u"?delete e[a][n]:e[a][n]=r;return}if(typeof a>"u")throw new Error("cant treat top level as a seq");a=a;let c=o[0];if(typeof e[a]>"u")if(typeof c=="string")e[a]={};else if(typeof c=="number")e[a]=[];else throw new Error(`can't go down this road ${e}.${a}.${c}`);e=e[a]}}var t_=class extends Error{};function n_(t){let e=t.path.slice(0,-1),n=t.path[t.path.length-1];switch(t.action){case"conflict":case"inc":case"mark":case"unmark":throw new t_(`can't handle this: ${t.action}`);case"del":return typeof n=="string"?[e,n]:[e,[n,n+(t.length||1)]];case"insert":return[e,[n,n],t.values];case"splice":return[e,[n,n],[t.value]];case"put":return[e,n,t.value]}}function r_(t){return js(e=>{for(let n of t){const[r,s,i]=n_(n);e_(r,e,s,i)}})}function s_({initialValue:t,url:e,repo:n}){let r=Lu();const s=_a(e)?n.find(e):n.create(t);let[i]=ju(async()=>{await s.whenReady();let[a,c]=_i(s.docSync());function u(f){c(r_(f.patches))}return s.on("change",u),Uu(r,()=>Qt(()=>s.off("change",u))),a},{initialValue:s.docSync()??t}),o=[];return ls(async()=>{if(await s.whenReady(),s){let a;for(;a=o.shift();)s.change(a)}else o=[]}),[i,a=>{s.isReady()?s.change(a):o.push(a)},s.url]}const Ze=(t,e)=>new Promise(n=>{const r={x:t.clientX,y:t.clientY},s=performance.now();let i={x:0,y:0};function o(u){const f={x:u.clientX-r.x,y:u.clientY-r.y},l={x:f.x-i.x,y:f.y-i.y};return i=f,{delta:{x:u.clientX-r.x,y:u.clientY-r.y},movement:l,event:u,time:performance.now()-s}}const a=u=>{e?.(o(u))},c=u=>{window.removeEventListener("pointermove",a),window.removeEventListener("pointerup",c);const f=o(u);e?.(f),n(f)};window.addEventListener("pointermove",a),window.addEventListener("pointerup",c)}),br=[1,0,1,0,1,1,0,1,0,1,0,1].reverse(),se=20,Z=60,Kn=2,ht=4,i_=new Th({network:[new qg(void 0)],storage:new zg}),o_=`${document.location.hash.substring(1)}`,[Qe,ge,a_]=Et(()=>s_({repo:i_,url:o_,initialValue:{notes:[],instrument:24}}));document.location.hash=a_;let $t,cs,Ot=new Set;const[Ae,pn]=be("note"),[c_,Ls]=be(0),[u_,l_]=be(),[he,bu]=be({x:Z,y:6*se*12}),[ce,Us]=be(1),[ve,We]=be([]),[gt,Ns]=be(),[vr,Hs]=be(),[Fs,f_]=be(),[pi,yi]=be(!1),[po,yo]=_i([]),[wi,vu]=be(0),[Me,qs]=_i({time:0,duration:4}),[pt,d_,h_]=Et(()=>[Lr(ve,(t,e)=>!!e.find(At(t))),Lr(()=>po,(t,e)=>!!e.find(At(t))),Lr(()=>po,(t,e)=>!!e.find(n=>n.pitch===t))]);function wo(t){return{x:Math.floor(t.x/Z/ce())*ce(),y:Math.floor(t.y/se)}}function At(...t){return({id:e})=>!!t.find(n=>n.id===e)}function g_(t){We(Qe().notes.filter(e=>{const n=e.time,r=e.time+e.duration,s=n<t.end.x&&r>t.start.x,i=-e.pitch>=t.start.y&&-e.pitch<t.end.y;return s&&i}))}function __(){$t?Ls($t.currentTime*ht-wi()):$t=new AudioContext,yi(!0)}function xu(){pi()?yi(!1):__()}function Jt(t,e=0){cs||(cs=new Qg),t.velocity!==0&&(cs.play(Qe().instrument,t.pitch,t.velocity,e,t.duration/ht,0,.05),setTimeout(()=>{yo(js(n=>n.push({...t}))),setTimeout(()=>{yo(js(n=>{n.splice(n.findIndex(At(t)),1)}))},t.duration/ht*1e3)},e*1e3))}async function p_(t){const e={x:t.layerX-he().x,y:t.layerY-he().y},n={id:Mn(),active:!0,duration:ce(),pitch:Math.floor(-e.y/se)+1,time:Math.floor(e.x/Z/ce())*ce(),velocity:1};ge(o=>{o.notes.push(n)});const r=n.time,s=n.duration,i=e.x-r*Z;We([n]),await Ze(t,({delta:o})=>{const a=Math.floor((i+o.x)/Z/ce())*ce();a<0?ge(c=>{const u=c.notes.find(At(n));u&&(u.time=r+a,u.duration=1-a)}):a>0?ge(c=>{const u=c.notes.find(At(n));u&&(u.duration=s+a)}):ge(c=>{const u=c.notes.find(At(n));u&&(u.time=r,u.duration=ce())}),nr(n)}),We([]),Zt(n)}async function y_(t){const e={x:t.clientX-he().x,y:t.clientY-he().y},n=wo(e);Ns({start:n,end:{x:n.x+ce(),y:n.y}}),Hs(n),await Ze(t,({delta:r})=>{const s=wo({x:e.x+r.x,y:e.y+r.y+1}),i={start:{x:r.x<0?s.x:n.x,y:r.y<0?s.y:n.y},end:{x:(r.x>0?s.x:n.x)+ce(),y:(r.y>0?s.y:n.y)+1}};g_(i),Ns(i),Hs(s)})}async function w_(t){const e={...he()};await Ze(t,({delta:n})=>{bu({x:e.x+n.x,y:e.y+n.y})})}function Su(){let t=1/0;ve().forEach(e=>{e.time<t&&(t=e.time)}),f_(ve().map(e=>({...e,id:Mn(),time:e.time-t})))}function Eu(t,e){const n=t.map(r=>({...r,time:r.time+e.x,id:Mn()})).filter(r=>!Qe().notes.find(({pitch:s,time:i})=>r.pitch===s&&r.time===i));ge(r=>r.notes.push(...n)),Zt(...n)}function ku(t,{id:e,time:n,pitch:r}){if(!t.find(s=>s.id===e))return t.find(s=>s.pitch===r&&e!==s.id&&s.time<n&&s.time+s.duration>n)}function Au(t,{id:e,time:n,duration:r,pitch:s}){if(!t.find(i=>i.id===e))return t.find(i=>i.pitch===s&&e!==i.id&&i.time>=n&&i.time<=n+r)}function Zt(...t){t.sort((e,n)=>e.time<n.time?-1:1),ge(e=>{for(let n=e.notes.length-1;n>=0;n--){const r=e.notes[n];ku(t,r)&&e.notes.splice(n,1)}}),ge(e=>e.notes.forEach((n,r)=>{const s=Au(t,n);s&&(e.notes[r].duration=s.time-n.time)})),ge(e=>{for(let n=e.notes.length-1;n>=0;n--)e.notes[n].duration===0&&e.notes.splice(n,1)}),t.forEach((e,n)=>{for(;n+1<t.length;){const r=t[n+1];if(r.pitch!==e.pitch){n++;continue}r.time<e.time+e.duration&&ge(s=>{s.notes.forEach(i=>{i.id===e.id&&(i.duration=r.time-e.time)})});break}}),ge(e=>{e.notes.forEach(n=>{delete n._duration,delete n._remove})})}function nr(...t){t.sort((e,n)=>e.time<n.time?-1:1),zs(()=>{ge(e=>e.notes.forEach(n=>{ku(t,n)?n._remove=!0:delete n._remove})),ge(e=>e.notes.forEach((n,r)=>{const s=Au(t,n);s?e.notes[r]._duration=s.time-n.time:delete e.notes[r]._duration})),t.forEach((e,n)=>{const r=e.time+e.duration;for(;n+1<t.length;){if(t[n+1].pitch!==e.pitch){n++;continue}if(t[n+1].time<=r){ge(s=>{s.notes.forEach(i=>{i.id===e.id&&(i._duration=t[n+1].time-e.time)})});break}ge(s=>{s.notes.forEach(i=>{i.id===e.id&&delete i._duration})});break}})})}function Tn(t,e){return(t%e+e)%e}var m_=ie('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><path fill=none stroke=currentColor stroke-width=2 d="M18 12.4H6M11.4 7L6 12.4l5.4 5.4">');const b_=(t={})=>(()=>{var e=m_();return Te(e,t,!0),e})();var v_=ie('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><path fill=none stroke=currentColor stroke-width=2 d="M6 12.4h12M12.6 7l5.4 5.4l-5.4 5.4">');const x_=(t={})=>(()=>{var e=v_();return Te(e,t,!0),e})();var S_=ie('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><path fill=none stroke=currentColor stroke-width=2 d="M4.5 17H1V1h16v3.5M7 7h16v16H7zm8 4v8zm-4 4h8z">');const E_=(t={})=>(()=>{var e=S_();return Te(e,t,!0),e})();var k_=ie('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><path fill=none stroke=currentColor stroke-width=2 d="M13 20c6-1 8-6 8-10m-7 6l-2 4l4 3M0 9l4-3l3 4m2 10c-6-3-7-8-5-14m16 1C16 1 10 1 6 4.006M20 2v5h-5">');const A_=(t={})=>(()=>{var e=k_();return Te(e,t,!0),e})();var C_=ie('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><path fill=none stroke=currentColor stroke-width=2 d="M1 17.998C1 16.894 1.887 16 2.998 16H9v4.002A1.993 1.993 0 0 1 7.002 22H2.998A2 2 0 0 1 1 20.002zm14 0c0-1.104.887-1.998 1.998-1.998H23v4.002A1.993 1.993 0 0 1 21.002 22h-4.004A2 2 0 0 1 15 20.002zM9 16V2h14v13.5M9 6h14">');const T_=(t={})=>(()=>{var e=C_();return Te(e,t,!0),e})();var I_=ie('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><path fill=none stroke=currentColor stroke-width=2 d="M8 1h6zm11.188 18.472L16 22l-3.5-4.5l-3 3.5L7 7l13 6.5l-4.5 1.5zM19 4V1h-3M6 1H3v3m0 10v3h3M19 6v4zM3 12V6z">');const M_=(t={})=>(()=>{var e=I_();return Te(e,t,!0),e})();var O_=ie('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><path fill=none stroke=currentColor stroke-width=2 d="M12 0v24M2 12h10m10 0H12M6 8l-4 4l4 4m12-8l4 4l-4 4">');const R_=(t={})=>(()=>{var e=O_();return Te(e,t,!0),e})();var P_=ie('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><path fill=none stroke=currentColor stroke-width=2 d="M12 18a6 6 0 1 0 0-12a6 6 0 0 0 0 12ZM8 8l3 3m1 11a9.99 9.99 0 0 0 8.307-4.43A9.95 9.95 0 0 0 22 12c0-5.523-4.477-10-10-10S2 6.477 2 12">');const D_=(t={})=>(()=>{var e=P_();return Te(e,t,!0),e})();var $_=ie('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><path fill=none stroke=currentColor stroke-width=2 d="M8.5 5.5L12 2l3.5 3.5M22 12H2m3.5-3.5L2 12l3.5 3.5m13 0L22 12l-3.5-3.5M12 22V2M8.5 18.5L12 22l3.5-3.5">');const B_=(t={})=>(()=>{var e=$_();return Te(e,t,!0),e})();var j_=ie('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><path fill=none stroke=currentColor stroke-width=2 d="M9 15h8zm0-4h10zm0-4h4zm7-6v6h6M6 5H2v18h16v-4m4 0H6V1h11l5 5z">');const L_=(t={})=>(()=>{var e=j_();return Te(e,t,!0),e})();var U_=ie('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><path fill=none stroke=currentColor stroke-width=2 d="M16 3h5v20H3V3h5m0-2h8v5H8z">');const N_=(t={})=>(()=>{var e=U_();return Te(e,t,!0),e})();var H_=ie('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><path fill=none stroke=currentColor stroke-width=2 d="M23 4L8 16zm0 16L8 8zM5 9a3 3 0 1 0 0-6a3 3 0 0 0 0 6Zm0 12a3 3 0 1 0 0-6a3 3 0 0 0 0 6Z">');const F_=(t={})=>(()=>{var e=H_();return Te(e,t,!0),e})();var q_=ie('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><path fill=none stroke=currentColor stroke-width=2 d="M7 21L22 6l-4-4L2 18l3 3h14M6 14l4 4">');const V_=(t={})=>(()=>{var e=q_();return Te(e,t,!0),e})();var z_=ie('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><path fill=none stroke=currentColor stroke-width=2 d="M18 12H6M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2z">');const W_=(t={})=>(()=>{var e=z_();return Te(e,t,!0),e})();var G_=ie('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><path fill=none stroke=currentColor stroke-width=2 d="M2 19h20M2 5h20M2 12h20">');const K_=(t={})=>(()=>{var e=G_();return Te(e,t,!0),e})();var X_=ie('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><path fill=none stroke=currentColor stroke-width=2 d="M4 4h16v16H4z">');const J_=(t={})=>(()=>{var e=X_();return Te(e,t,!0),e})();var Y_=ie('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><path fill=none stroke=currentColor stroke-width=2 d="m3 22l18-10L3 2z">');const Z_=(t={})=>(()=>{var e=Y_();return Te(e,t,!0),e})();var Q_=ie('<svg viewBox="0 0 24 24"width=1.2em height=1.2em><path fill=none stroke=currentColor stroke-width=2 d="M3 21h6V3H3zm12 0h6V3h-6z">');const ep=(t={})=>(()=>{var e=Q_();return Te(e,t,!0),e})();var tp=ie("<button>"),np=ie("<div><span>"),Pr=ie("<svg><rect></svg>",!1,!0),rp=ie("<svg><rect fill=var(--color-piano-white)></svg>",!1,!0),Tt=ie("<svg><g></svg>",!1,!0),sp=ie("<svg><rect x=0></svg>",!1,!0),ip=ie("<svg><rect x=0 opacity=0.8></svg>",!1,!0),op=ie("<svg><rect x=0 y=0 fill=var(--color-piano-black)></svg>",!1,!0),ap=ie("<svg><line x1=0 stroke=var(--color-stroke)></svg>",!1,!0),cp=ie("<svg><rect y=0></svg>",!1,!0),Cu=ie("<svg><line y1=0 stroke=var(--color-stroke) stroke-width=2px></svg>",!1,!0),up=ie("<svg><line y1=0 stroke=var(--color-stroke) stroke-width=1px></svg>",!1,!0),lp=ie("<svg><line y1=0 stroke=var(--color-stroke-secondary)></svg>",!1,!0),Vs=ie("<div>"),fp=ie("<div><div>"),dp=ie("<div><div><button></button><button></button><button></button><button></button><button>"),hp=ie("<div><div><button>"),gp=ie("<div><div></div><div></div><div><button></button><button>"),_p=ie("<div><svg>"),pp=ie("<svg><rect opacity=0.3 fill=var(--color-selection-area)></svg>",!1,!0),yp=ie("<svg><rect opacity=0.8 fill=var(--color-selection-area)></svg>",!1,!0);function yt(t){const[e,n]=be(!1);return(()=>{var r=tp();return r.$$click=s=>{n(!0),t.onClick(s),setTimeout(()=>n(!1),250)},oe(r,()=>t.children),le(s=>{var i=Po(t.class,e()&&Ce.trigger),o=t.style;return i!==s.e&&qe(r,s.e=i),s.t=Mo(r,o,s.t),s},{e:void 0,t:void 0}),r})()}function mo(t){return(()=>{var e=np(),n=e.firstChild;return oe(e,X(yt,{get onClick(){return t.decrement},get children(){return X(b_,{})}}),n),oe(n,()=>t.value),oe(e,X(yt,{get onClick(){return t.increment},get children(){return X(x_,{})}}),null),le(()=>qe(e,Ce.numberButton)),e})()}function wp(t){async function e(i){if(pt(t.note)&&(i.stopPropagation(),i.preventDefault(),ve().sort((o,a)=>o.time<a.time?-1:1),ve().length>0)){const o=ve()[0].time%ce(),a=Object.fromEntries(ve().map(f=>[f.id,{time:f.time,pitch:f.pitch}]));let c=0;const{delta:u}=await Ze(i,({delta:f})=>{let l=Math.floor(f.x/Z/ce())*ce();l===ce()*-1?l=0:l<ce()*-1&&(l=l+ce());const d=c!==l;c=l,ge(h=>{h.notes.forEach(g=>{pt(g)&&(g.time=a[g.id].time+l-o,g.pitch=a[g.id].pitch-Math.floor((f.y+se/2)/se),d&&Jt(g))})}),nr(...ve())});Math.floor((u.x+Z/2)/Z),Zt(...ve())}}async function n(i){i.stopPropagation(),i.preventDefault(),pt(t.note)||We([t.note]);const o=Object.fromEntries(ve().map(a=>[a.id,{...a}]));console.log(o.length),await Ze(i,({delta:a})=>{zs(()=>{const c=Math.floor(a.x/Z/ce())*ce();ge(u=>{u.notes.forEach(f=>{if(!pt(f))return;const l=o[f.id].duration+c;l>ce()?f.duration=l:(f.time=o[f.id].time,f.duration=ce())})}),nr(...ve())})}),Zt(...ve()),ve().length===1&&We([])}async function r(i){i.stopPropagation(),i.preventDefault();const o=t.note.time,a=t.note.pitch;let c=a;We([t.note]),await Ze(i,({delta:u})=>{const f=Math.floor((o+u.x/Z)/ce())*ce(),l=a-Math.floor((u.y+se/2)/se);ge(d=>{const h=d.notes.find(g=>g.id===t.note.id);h&&(h.time=f,h.pitch=l,c!==l&&(Jt(h),c=l))}),nr(t.note)}),We([]),Zt(t.note)}async function s(i){let o=!!ve().find(At(t.note));o||We([t.note]);const a=Object.fromEntries(ve().map(c=>[c.id,{...c}]));await Ze(i,({delta:c})=>{ge(u=>{u.notes.forEach(f=>{f.active||(f.active=!0),f.id in a&&(f.velocity=Math.min(1,Math.max(0,a[f.id].velocity-c.y/100)))})})}),o||We([])}return(()=>{var i=Pr();return i.$$pointerdown=async o=>{switch(Ae()){case"select":return await e(o);case"stretch":return n(o);case"note":return r(o);case"velocity":return s(o)}},i.$$dblclick=()=>{Ae()==="note"&&ge(o=>{const a=o.notes.findIndex(At(t.note));a!==-1&&o.notes.splice(a,1)})},J(i,"height",se-Kn*2),le(o=>{var a=Po(Ce.note,(pt(t.note)||d_(t.note))&&Ce.selected),c=t.note.time*Z+Kn,u=-t.note.pitch*se+Kn,f=(t.note._duration??t.note.duration)*Z-Kn*2,l=!t.note._remove&&t.note.active?t.note.velocity*.75+.25:.25;return a!==o.e&&J(i,"class",o.e=a),c!==o.t&&J(i,"x",o.t=c),u!==o.a&&J(i,"y",o.a=u),f!==o.o&&J(i,"width",o.o=f),l!==o.i&&J(i,"opacity",o.i=l),o},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),i})()}function mp(){const t=$n();return[(()=>{var e=rp();return J(e,"width",Z),le(()=>J(e,"height",t().height)),e})(),(()=>{var e=Tt();return oe(e,X(Lt,{get each(){return new Array(Math.floor(t().height/se)+2)},children:(n,r)=>(()=>{var s=sp();return J(s,"y",r*se),J(s,"width",Z),J(s,"height",se),le(i=>(i=br[Tn(r+Math.floor(-he().y/se),br.length)]?"none":"var(--color-piano-black)")!=null?s.style.setProperty("fill",i):s.style.removeProperty("fill")),s})()})),le(n=>(n=`translateY(${Tn(-he().y,se)*-1}px)`)!=null?e.style.setProperty("transform",n):e.style.removeProperty("transform")),e})()]}function bp(){const t=$n();return(()=>{var e=Tt();return oe(e,X(Lt,{get each(){return new Array(Math.floor(t().height/se)+2)},children:(n,r)=>(()=>{var s=ip();return J(s,"y",r*se),J(s,"width",Z),J(s,"height",se),le(i=>(i=h_(-(r+Math.floor(-he().y/se)))?"var(--color-note-selected)":"none")!=null?s.style.setProperty("fill",i):s.style.removeProperty("fill")),s})()})),le(n=>(n=`translateY(${Tn(-he().y,se)*-1}px)`)!=null?e.style.setProperty("transform",n):e.style.removeProperty("transform")),e})()}function vp(t){const e=$n(),[n,r]=be(!1),[s,i]=be(!1);function o(u){u.stopPropagation();const f={x:u.layerX-he().x,y:u.layerY-he().y},l={time:Math.floor(f.x/Z),duration:1};t.setLoop(l);const d=l.time,h=l.duration,g=f.x-d*Z;Ze(u,({delta:w})=>{const x=Math.floor((g+w.x)/Z);x<0?(t.setLoop("time",d+x),t.setLoop("duration",1-x)):x>0?t.setLoop("duration",h+x):(t.setLoop("time",d),t.setLoop("duration",1))})}async function a(u,f){u.stopPropagation(),u.preventDefault(),r(!0);const{width:l,left:d}=u.target.getBoundingClientRect(),h=f.time,g=f.duration;if(u.clientX<d+Z/3){const w=u.layerX-h*Z-he().x;await Ze(u,({delta:x})=>{const v=Math.floor((x.x+w)/Z);if(v>=g)t.setLoop("duration",v-g+2);else{const M=h+v;t.setLoop("time",M),t.setLoop("duration",g-v)}})}else u.layerX>d+l-Z/3?await Ze(u,({delta:w})=>{const x=Math.floor((u.layerX-he().x+w.x)/Z)-h;x>0?t.setLoop("duration",1+x):x<0?(t.setLoop("duration",1-x),t.setLoop("time",h+x)):(t.setLoop("time",h),t.setLoop("duration",1))}):await Ze(u,({delta:w})=>{const x=Math.floor((w.x+Z/2)/Z),v=h+x;t.setLoop("time",v)});r(!1)}let c=!0;return Gt(us(()=>[t.loop.duration,t.loop.time],()=>{if(c){c=!1;return}i(!0),setTimeout(()=>{i(!1)},250)})),[(()=>{var u=op();return u.$$pointerdown=o,J(u,"height",se),le(()=>J(u,"width",e().width)),u})(),X(St,{get when(){return t.loop},children:u=>(()=>{var f=cp();return f.$$pointerdown=l=>a(l,u()),J(f,"height",se),f.style.setProperty("transition","fill 0.25s"),le(l=>{var d=u().time*Z,h=u().duration*Z,g=n()||s()?"var(--color-loop-selected)":"var(--color-loop)",w=`translateX(${he().x}px)`;return d!==l.e&&J(f,"x",l.e=d),h!==l.t&&J(f,"width",l.t=h),g!==l.a&&J(f,"fill",l.a=g),w!==l.o&&((l.o=w)!=null?f.style.setProperty("transform",w):f.style.removeProperty("transform")),l},{e:void 0,t:void 0,a:void 0,o:void 0}),f})()}),(()=>{var u=Pr();return J(u,"height",se),u.style.setProperty("opacity","0.5"),le(f=>{var l=Ce.now,d=Z*ce(),h=`translateX(${he().x+Math.floor(wi()/ce())*Z*ce()}px)`;return l!==f.e&&J(u,"class",f.e=l),d!==f.t&&J(u,"width",f.t=d),h!==f.a&&((f.a=h)!=null?u.style.setProperty("transform",h):u.style.removeProperty("transform")),f},{e:void 0,t:void 0,a:void 0}),u})(),(()=>{var u=ap();return J(u,"y1",se),J(u,"y2",se),le(()=>J(u,"x2",e().width)),u})(),(()=>{var u=Tt();return oe(u,X(Lt,{get each(){return new Array(Math.floor(e().width/Z/8)+2)},children:(f,l)=>(()=>{var d=Cu();return J(d,"y2",se),J(d,"x1",l*Z*8),J(d,"x2",l*Z*8),d})()})),le(f=>(f=`translateX(${he().x%(Z*8)}px)`)!=null?u.style.setProperty("transform",f):u.style.removeProperty("transform")),u})(),(()=>{var u=Tt();return oe(u,X(Lt,{get each(){return new Array(Math.floor(e().width/Z)+2)},children:(f,l)=>(()=>{var d=up();return J(d,"y2",se),J(d,"x1",l*Z),J(d,"x2",l*Z),d})()})),le(f=>(f=`translateX(${he().x%Z}px)`)!=null?u.style.setProperty("transform",f):u.style.removeProperty("transform")),u})()]}function xp(){const t=$n();return[(()=>{var e=Tt();return oe(e,X(Lt,{get each(){return new Array(Math.floor(t().width/Z/ce())+2)},children:(n,r)=>(()=>{var s=lp();return le(i=>{var o=t().height,a=r*ce()*Z,c=r*ce()*Z;return o!==i.e&&J(s,"y2",i.e=o),a!==i.t&&J(s,"x1",i.t=a),c!==i.a&&J(s,"x2",i.a=c),i},{e:void 0,t:void 0,a:void 0}),s})()})),le(n=>(n=`translateX(${he().x%(Z*ce())}px)`)!=null?e.style.setProperty("transform",n):e.style.removeProperty("transform")),e})(),(()=>{var e=Tt();return oe(e,X(Lt,{get each(){return new Array(Math.floor(t().width/Z/8)+2)},children:(n,r)=>(()=>{var s=Cu();return J(s,"x1",r*Z*8),J(s,"x2",r*Z*8),le(()=>J(s,"y2",t().height)),s})()})),le(n=>(n=`translateX(${he().x%(Z*8)}px)`)!=null?e.style.setProperty("transform",n):e.style.removeProperty("transform")),e})()]}function Sp(){const t=$n();return(()=>{var e=Tt();return oe(e,X(Lt,{get each(){return new Array(Math.floor(t().height/se)+2)},children:(n,r)=>(()=>{var s=Pr();return J(s,"y",r*se),J(s,"height",se),s.style.setProperty("pointer-events","none"),le(i=>{var o=t().width,a=br[Tn(r+Math.floor(-he().y/se),br.length)]?"none":"var(--color-piano-underlay)";return o!==i.e&&J(s,"width",i.e=o),a!==i.t&&((i.t=a)!=null?s.style.setProperty("fill",a):s.style.removeProperty("fill")),i},{e:void 0,t:void 0}),s})()})),le(n=>(n=`translateY(${-Tn(-he().y,se)}px)`)!=null?e.style.setProperty("transform",n):e.style.removeProperty("transform")),e})()}function Ep(){const t=()=>gt()===void 0||gt().start.x===gt().end.x&&gt().start.y===gt().end.y;return(()=>{var e=fp(),n=e.firstChild;return`${se}px`!=null?e.style.setProperty("top",`${se}px`):e.style.removeProperty("top"),e.style.setProperty("gap","5px"),oe(n,X(yt,{onClick:()=>{const r=Qe().notes?.filter(i=>i.time>=Me.time&&i.time<Me.time+Me.duration);if(!r)return;const s=r.map(i=>({...i,id:Mn(),time:i.time+Me.duration}));ge(i=>i.notes.push(...s)),qs("duration",i=>i*2),Zt(...s)},get children(){return X(E_,{})}})),oe(e,X(St,{get when(){return Ae()==="select"},get children(){var r=Vs();return oe(r,X(yt,{get class(){return Ae()==="stretch"?Ce.active:void 0},onClick:()=>{const s=gt();if(!s){console.error("Trying to ");return}qs({time:s.start.x,duration:s.end.x-s.start.x+ce()})},get children(){return X(A_,{style:{"margin-top":"3px"}})}})),le(s=>{var i=t()?.5:void 0,o=t()?"none":void 0;return i!==s.e&&((s.e=i)!=null?r.style.setProperty("opacity",i):r.style.removeProperty("opacity")),o!==s.t&&((s.t=o)!=null?r.style.setProperty("pointer-events",o):r.style.removeProperty("pointer-events")),s},{e:void 0,t:void 0}),r}}),null),le(()=>qe(e,Ce.topLeftHud)),e})()}function kp(){return(()=>{var t=dp(),e=t.firstChild,n=e.firstChild,r=n.nextSibling,s=r.nextSibling,i=s.nextSibling,o=i.nextSibling;return n.$$click=()=>pn("note"),oe(n,X(T_,{})),r.$$click=()=>pn("select"),oe(r,X(M_,{})),s.$$click=()=>pn("stretch"),oe(s,X(R_,{})),i.$$click=()=>pn("velocity"),oe(i,X(D_,{})),o.$$click=()=>pn("pan"),oe(o,X(B_,{})),oe(t,X(St,{get when(){return Xe(()=>!!(Ae()==="select"&&Fs()&&vr()))()&&[Fs(),vr()]},children:a=>(()=>{var c=Vs();return c.style.setProperty("display","grid"),`${se*2-2}px`!=null?c.style.setProperty("grid-template-rows",`${se*2-2}px`):c.style.removeProperty("grid-template-rows"),oe(c,X(yt,{get class(){return Ae()==="stretch"?Ce.active:void 0},onClick:()=>Eu(...a()),get children(){return X(L_,{})}})),c})()}),null),oe(t,X(St,{get when(){return Ae()==="select"},get children(){var a=Vs();return oe(a,X(yt,{get class(){return Ae()==="stretch"?Ce.active:void 0},onClick:Su,get children(){return X(N_,{})}}),null),oe(a,X(yt,{onClick:()=>{const c=gt()?.start.x;if(!c){console.error("Attempting to slice without slice-line");return}const u=ve().filter(f=>f.time<gt().start.x).map(f=>({id:Mn(),active:!0,duration:f.duration-(c-f.time),pitch:f.pitch,time:c,velocity:f.velocity}));ge(f=>f.notes.push(...u)),We(f=>[...f,...u]),ge(f=>{f.notes.forEach(l=>{pt(l)&&l.time<c&&(l.duration=c-l.time)})})},get children(){return X(F_,{})}}),null),oe(a,X(yt,{onClick:()=>{ge(c=>{for(let u=c.notes.length-1;u>=0;u--)pt(c.notes[u])&&c.notes.splice(u,1)}),We([])},get children(){return X(V_,{})}}),null),oe(a,X(yt,{onClick:()=>{let c=0;ve().forEach(f=>{f.active||c++});const u=c>ve().length/2;ge(f=>{f.notes.forEach(l=>{pt(l)&&(l.active=u)})})},get children(){return X(W_,{})}}),null),le(c=>{var u=ve().length===0?.5:void 0,f=ve().length===0?"none":void 0;return u!==c.e&&((c.e=u)!=null?a.style.setProperty("opacity",u):a.style.removeProperty("opacity")),f!==c.t&&((c.t=f)!=null?a.style.setProperty("pointer-events",f):a.style.removeProperty("pointer-events")),c},{e:void 0,t:void 0}),a}}),null),le(a=>{var c=Ce.topRightHud,u=Ae()==="note"?Ce.active:void 0,f=Ae()==="select"?Ce.active:void 0,l=Ae()==="stretch"?Ce.active:void 0,d=Ae()==="velocity"?Ce.active:void 0,h=Ae()==="pan"?Ce.active:void 0;return c!==a.e&&qe(t,a.e=c),u!==a.t&&qe(n,a.t=u),f!==a.a&&qe(r,a.a=f),l!==a.o&&qe(s,a.o=l),d!==a.i&&qe(i,a.i=d),h!==a.n&&qe(o,a.n=h),a},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),t})()}function Ap(){return(()=>{var t=hp(),e=t.firstChild,n=e.firstChild;return n.$$click=()=>Us(r=>r/2),oe(n,X(K_,{})),le(()=>qe(t,Ce.bottomLeftHud)),t})()}function Cp(){return(()=>{var t=gp(),e=t.firstChild,n=e.nextSibling,r=n.nextSibling,s=r.firstChild,i=s.nextSibling;return oe(e,X(mo,{get value(){return Xe(()=>ce()<1)()?`1:${1/ce()}`:ce()},decrement:()=>Us(o=>o/2),increment:()=>Us(o=>o*2)})),oe(n,X(mo,{get value(){return Qe().instrument},decrement:()=>{Qe().instrument>0?ge(o=>{o.instrument=o.instrument-1}):ge(o=>{o.instrument=174})},increment:()=>{Qe().instrument>=174?ge(o=>{o.instrument=0}):ge(o=>{o.instrument=o.instrument+1})}})),s.$$click=()=>{vu(Me.time),yi(!1),Ot.clear()},oe(s,X(J_,{})),Io(i,"click",xu,!0),oe(i,(()=>{var o=Xe(()=>!pi());return()=>o()?X(Z_,{}):X(ep,{})})()),le(()=>qe(t,Ce.bottomRightHud)),t})()}const Tu=Nu();function $n(){const t=Hu(Tu);if(!t)throw"PianoContext is undefined.";return t}function Tp(){return Gt(()=>{Ae()!=="select"&&(Hs(),Ns())}),Gt(Co(()=>Qe().notes,t=>{Gt(us(()=>pt(t),e=>e&&Jt({...t,duration:Math.min(1,t.duration)})))})),Gt(us(pi,t=>{if(!t||!$t)return;let e=!0;function n(){if(!e)return;let r=$t.currentTime*ht-c_();if(Me){if(r<Me.time)Ot.clear(),r=Me.time,Ls($t.currentTime*ht-Me.time);else if(r>Me.time+Me.duration){Ot.clear(),Ls($t.currentTime*ht-Me.time),n();return}}vu(r),Qe().notes.forEach(s=>{if(!s.active||Ot.has(s))return;const i=Me.time+Me.duration,o=r+1-i;o>0?s.time>=r&&s.time<i?(Ot.add(s),Jt(s,(s.time-r)/ht)):s.time>=Me.time&&s.time<Me.time+o&&(Ot.add(s),Jt(s,(s.time+i-r)/ht)):s.time>=r&&s.time<r+1&&(Ot.add(s),Jt(s,(s.time-r)/ht))}),requestAnimationFrame(n)}n(),Qt(()=>e=!1)})),ls(()=>{window.addEventListener("keydown",t=>{if(t.code==="Space")xu();else if(Ae()==="select"){if(t.code==="KeyC"&&(t.ctrlKey||t.metaKey))Su();else if(t.code==="KeyV"&&(t.ctrlKey||t.metaKey)){const e=vr(),n=Fs();n&&e&&Eu(n,e)}}})}),(()=>{var t=_p(),e=t.firstChild;return t.style.setProperty("width","100%"),t.style.setProperty("height","100%"),t.style.setProperty("overflow","hidden"),oe(t,X(Ep,{}),e),oe(t,X(kp,{}),e),oe(t,X(Cp,{}),e),oe(t,X(Ap,{}),e),e.$$pointerdown=async n=>{switch(Ae()){case"note":p_(n);break;case"select":y_(n);break;case"pan":w_(n)}},e.addEventListener("wheel",n=>bu(r=>({x:r.x-n.deltaX,y:r.y-n.deltaY*2/3}))),e.$$dblclick=()=>We([]),Oo(n=>{ls(()=>{const r=new ResizeObserver(()=>{l_(n.getBoundingClientRect())});r.observe(n),Qt(()=>r.disconnect())})},e),e.style.setProperty("width","100%"),e.style.setProperty("height","100%"),e.style.setProperty("overflow","hidden"),oe(e,X(St,{get when(){return u_()},children:n=>X(Tu.Provider,{value:n,get children(){return[X(Sp,{}),X(xp,{}),X(St,{get when(){return Xe(()=>Ae()==="select")()&&gt()},children:r=>(()=>{var s=pp();return le(i=>{var o=r().start.x*Z+he().x,a=r().start.y*se+he().y,c=(r().end.x-r().start.x)*Z,u=(r().end.y-r().start.y)*se;return o!==i.e&&J(s,"x",i.e=o),a!==i.t&&J(s,"y",i.t=a),c!==i.a&&J(s,"width",i.a=c),u!==i.o&&J(s,"height",i.o=u),i},{e:void 0,t:void 0,a:void 0,o:void 0}),s})()}),X(St,{get when(){return Xe(()=>Ae()==="select")()&&vr()},children:r=>(()=>{var s=yp();return J(s,"height",se),le(i=>{var o=r().x*Z+he().x,a=r().y*se+he().y,c=Z*ce();return o!==i.e&&J(s,"x",i.e=o),a!==i.t&&J(s,"y",i.t=a),c!==i.a&&J(s,"width",i.a=c),i},{e:void 0,t:void 0,a:void 0}),s})()}),X(St,{get when(){return Qe().notes.length>0},get children(){var r=Tt();return oe(r,X(Ju,{get each(){return Qe().notes},children:s=>X(wp,{note:s})})),le(s=>(s=`translate(${he().x}px, ${he().y}px)`)!=null?r.style.setProperty("transform",s):r.style.removeProperty("transform")),r}}),(()=>{var r=Pr();return r.style.setProperty("opacity","0.075"),le(s=>{var i=Ce.now,o=Z*ce(),a=n().height,c=`translateX(${he().x+Math.floor(wi()/ce())*Z*ce()}px)`;return i!==s.e&&J(r,"class",s.e=i),o!==s.t&&J(r,"width",s.t=o),a!==s.a&&J(r,"height",s.a=a),c!==s.o&&((s.o=c)!=null?r.style.setProperty("transform",c):r.style.removeProperty("transform")),s},{e:void 0,t:void 0,a:void 0,o:void 0}),r})(),X(vp,{loop:Me,setLoop:qs}),X(mp,{}),X(bp,{})]}})})),t})()}To(["click","dblclick","pointerdown"]);nl(()=>X(Tp,{}),document.getElementById("root"));
